!function(t){var e={};function r(i){if(e[i])return e[i].exports;var n=e[i]={i:i,l:!1,exports:{}};return t[i].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=t,r.c=e,r.d=function(t,e,i){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)r.d(i,n,function(e){return t[e]}.bind(null,n));return i},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=51)}([function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=Object.prototype.hasOwnProperty;function n(t){return"function"==typeof t}function s(t){return void 0===t}function a(t){return"[object String]"===Object.prototype.toString.call(t)}e.has=function(t,e){return i.call(t,e)},e.defaultCompare=function(t,e){return t<e?-1:t===e?0:1},e.defaultEquals=function(t,e){return t===e},e.defaultToString=function(t){return null===t?"COLLECTION_NULL":s(t)?"COLLECTION_UNDEFINED":a(t)?"$s"+t:"$o"+t.toString()},e.makeString=function(t,r){if(void 0===r&&(r=","),null===t)return"COLLECTION_NULL";if(s(t))return"COLLECTION_UNDEFINED";if(a(t))return t.toString();var i="{",n=!0;for(var o in t)e.has(t,o)&&(n?n=!1:i+=r,i=i+o+":"+t[o]);return i+"}"},e.isFunction=n,e.isUndefined=s,e.isString=a,e.reverseCompareFunction=function(t){return s(t)||!n(t)?function(t,e){return t<e?1:t===e?0:-1}:function(e,r){return-1*t(e,r)}},e.compareToEquals=function(t){return function(e,r){return 0===t(e,r)}}},function(t,e,r){"use strict";r.r(e);class i{constructor(...t){this.attributes=t;let e=0,r=0;for(const i of t){if(this[i.key])throw new n(i);e%i.sizeOfType!=0&&(e+=i.sizeOfType-e%i.sizeOfType,console.warn("Layout requires padding before "+i.key+" attribute")),this[i.key]={attribute:i,size:i.size,type:i.type,normalized:i.normalized,offset:e},e+=i.sizeInBytes,r=Math.max(r,i.sizeOfType)}e%r!=0&&(e+=r-e%r,console.warn("Layout requires padding at the back")),this.stride=e;for(const e of t)this[e.key].stride=this.stride}}class n{constructor(t){this.message="found duplicate attribute: "+t.key}}class s{constructor(t,e,r,i=!1){this.key=t,this.size=e,this.type=r,this.normalized=!1,this.sizeOfType=function(t){switch(t){case"BYTE":case"UNSIGNED_BYTE":return 1;case"SHORT":case"UNSIGNED_SHORT":return 2;case"FLOAT":return 4}}(r),this.sizeInBytes=this.sizeOfType*e}}i.POSITION=new s("position",3,"FLOAT"),i.NORMAL=new s("normal",3,"FLOAT"),i.TANGENT=new s("tangent",3,"FLOAT"),i.BITANGENT=new s("bitangent",3,"FLOAT"),i.UV=new s("uv",2,"FLOAT"),i.MATERIAL_INDEX=new s("materialIndex",1,"SHORT"),i.MATERIAL_ENABLED=new s("materialEnabled",1,"UNSIGNED_SHORT"),i.AMBIENT=new s("ambient",3,"FLOAT"),i.DIFFUSE=new s("diffuse",3,"FLOAT"),i.SPECULAR=new s("specular",3,"FLOAT"),i.SPECULAR_EXPONENT=new s("specularExponent",3,"FLOAT"),i.EMISSIVE=new s("emissive",3,"FLOAT"),i.TRANSMISSION_FILTER=new s("transmissionFilter",3,"FLOAT"),i.DISSOLVE=new s("dissolve",1,"FLOAT"),i.ILLUMINATION=new s("illumination",1,"UNSIGNED_SHORT"),i.REFRACTION_INDEX=new s("refractionIndex",1,"FLOAT"),i.SHARPNESS=new s("sharpness",1,"FLOAT"),i.MAP_DIFFUSE=new s("mapDiffuse",1,"SHORT"),i.MAP_AMBIENT=new s("mapAmbient",1,"SHORT"),i.MAP_SPECULAR=new s("mapSpecular",1,"SHORT"),i.MAP_SPECULAR_EXPONENT=new s("mapSpecularExponent",1,"SHORT"),i.MAP_DISSOLVE=new s("mapDissolve",1,"SHORT"),i.ANTI_ALIASING=new s("antiAliasing",1,"UNSIGNED_SHORT"),i.MAP_BUMP=new s("mapBump",1,"SHORT"),i.MAP_DISPLACEMENT=new s("mapDisplacement",1,"SHORT"),i.MAP_DECAL=new s("mapDecal",1,"SHORT"),i.MAP_EMISSIVE=new s("mapEmissive",1,"SHORT");class a{constructor(t,e){(e=e||{}).materials=e.materials||[];this.has_materials=!!e.materials,this.materials={},this.submesh={},this.vertices=[],this.vertexNormals=[],this.textures=[],this.indices=[],this.name="";const r=[],i=[],n=[],s={},a=[],o={};let h=-1;s.verts=[],s.norms=[],s.textures=[],s.hashindices={},s.indices=[],s.materialIndices=[],s.index=0;let u=[],l=0,c=0;const d=/^v\s/,f=/^vn\s/,p=/^vt\s/,m=/^f\s/,_=/\s+/,v=/^usemtl/,g=t.split("\n");for(let t=0;t<g.length;t++){const e=g[t].trim();if(!e||e.startsWith("#"))continue;const y=e.split(_);if(y.shift(),d.test(e))r.push(...y);else if(f.test(e))i.push(...y);else if(p.test(e))n.push(y[0]),n.push(y[1]);else if(v.test(e)){const t=y[0];t in o||(0!==l&&u.push({offset:c,numItems:l}),c+=l,l=0,a.push(t),o[t]=a.length-1),h=o[t]}else if(m.test(e)){l++;let t=!1;for(let e=0,a=y.length;e<a;e++){3!==e||t||(e=2,t=!0,l++);const a=y[0]+","+h,o=y[e]+","+h;if(o in s.hashindices)s.indices.push(s.hashindices[o]);else{let t=y[e].split("/"),a=t.length-1;s.verts.push(+r[3*(t[0]-1)+0]),s.verts.push(+r[3*(t[0]-1)+1]),s.verts.push(+r[3*(t[0]-1)+2]),n.length&&(s.textures.push(+n[2*(t[1]-1)+0]),s.textures.push(+n[2*(t[1]-1)+1])),s.norms.push(+i[3*(t[a]-1)+0]),s.norms.push(+i[3*(t[a]-1)+1]),s.norms.push(+i[3*(t[a]-1)+2]),s.materialIndices.push(h),s.hashindices[o]=s.index,s.indices.push(s.index),s.index+=1}3===e&&t&&s.indices.push(s.hashindices[a])}}}u.push({offset:c,numItems:l}),this.vertices=s.verts,this.vertexNormals=s.norms,this.textures=s.textures,this.vertexMaterialIndices=s.materialIndices,this.indices=s.indices,this.submesh=u,this.materialNames=a,this.materialIndices=o,this.materialsByIndex={}}makeBufferData(t){const e=this.vertices.length/3,r=new ArrayBuffer(t.stride*e);r.numItems=e;const n=new DataView(r);for(let r=0,s=0;r<e;r++){s=r*t.stride;for(const e of t.attributes){const a=s+t[e.key].offset;switch(e.key){case i.POSITION.key:n.setFloat32(a,this.vertices[3*r],!0),n.setFloat32(a+4,this.vertices[3*r+1],!0),n.setFloat32(a+8,this.vertices[3*r+2],!0);break;case i.UV.key:n.setFloat32(a,this.textures[2*r],!0),n.setFloat32(a+4,this.vertices[2*r+1],!0);break;case i.NORMAL.key:n.setFloat32(a,this.vertexNormals[3*r],!0),n.setFloat32(a+4,this.vertexNormals[3*r+1],!0),n.setFloat32(a+8,this.vertexNormals[3*r+2],!0);break;case i.MATERIAL_INDEX.key:n.setInt16(a,this.vertexMaterialIndices[r],!0);break;case i.AMBIENT.key:{const t=this.vertexMaterialIndices[r],e=this.materialsByIndex[t];if(!e){console.warn('Material "'+this.materialNames[t]+'" not found in mesh. Did you forget to call addMaterialLibrary(...)?"');break}n.setFloat32(a,e.ambient[0],!0),n.setFloat32(a+4,e.ambient[1],!0),n.setFloat32(a+8,e.ambient[2],!0);break}case i.DIFFUSE.key:{const t=this.vertexMaterialIndices[r],e=this.materialsByIndex[t];if(!e){console.warn('Material "'+this.materialNames[t]+'" not found in mesh. Did you forget to call addMaterialLibrary(...)?"');break}n.setFloat32(a,e.diffuse[0],!0),n.setFloat32(a+4,e.diffuse[1],!0),n.setFloat32(a+8,e.diffuse[2],!0);break}case i.SPECULAR.key:{const t=this.vertexMaterialIndices[r],e=this.materialsByIndex[t];if(!e){console.warn('Material "'+this.materialNames[t]+'" not found in mesh. Did you forget to call addMaterialLibrary(...)?"');break}n.setFloat32(a,e.specular[0],!0),n.setFloat32(a+4,e.specular[1],!0),n.setFloat32(a+8,e.specular[2],!0);break}case i.SPECULAR_EXPONENT.key:{const t=this.vertexMaterialIndices[r],e=this.materialsByIndex[t];if(!e){console.warn('Material "'+this.materialNames[t]+'" not found in mesh. Did you forget to call addMaterialLibrary(...)?"');break}n.setFloat32(a,e.specularExponent,!0);break}case i.EMISSIVE.key:{const t=this.vertexMaterialIndices[r],e=this.materialsByIndex[t];if(!e){console.warn('Material "'+this.materialNames[t]+'" not found in mesh. Did you forget to call addMaterialLibrary(...)?"');break}n.setFloat32(a,e.emissive[0],!0),n.setFloat32(a+4,e.emissive[1],!0),n.setFloat32(a+8,e.emissive[2],!0);break}case i.TRANSMISSION_FILTER.key:{const t=this.vertexMaterialIndices[r],e=this.materialsByIndex[t];if(!e){console.warn('Material "'+this.materialNames[t]+'" not found in mesh. Did you forget to call addMaterialLibrary(...)?"');break}n.setFloat32(a,e.transmissionFilter[0],!0),n.setFloat32(a+4,e.transmissionFilter[1],!0),n.setFloat32(a+8,e.transmissionFilter[2],!0);break}case i.DISSOLVE.key:{const t=this.vertexMaterialIndices[r],e=this.materialsByIndex[t];if(!e){console.warn('Material "'+this.materialNames[t]+'" not found in mesh. Did you forget to call addMaterialLibrary(...)?"');break}n.setFloat32(a,e.dissolve,!0);break}case i.ILLUMINATION.key:{const t=this.vertexMaterialIndices[r],e=this.materialsByIndex[t];if(!e){console.warn('Material "'+this.materialNames[t]+'" not found in mesh. Did you forget to call addMaterialLibrary(...)?"');break}n.setInt16(a,e.illumination,!0);break}case i.REFRACTION_INDEX.key:{const t=this.vertexMaterialIndices[r],e=this.materialsByIndex[t];if(!e){console.warn('Material "'+this.materialNames[t]+'" not found in mesh. Did you forget to call addMaterialLibrary(...)?"');break}n.setFloat32(a,e.refractionIndex,!0);break}case i.SHARPNESS.key:{const t=this.vertexMaterialIndices[r],e=this.materialsByIndex[t];if(!e){console.warn('Material "'+this.materialNames[t]+'" not found in mesh. Did you forget to call addMaterialLibrary(...)?"');break}n.setFloat32(a,e.sharpness,!0);break}case i.ANTI_ALIASING.key:{const t=this.vertexMaterialIndices[r],e=this.materialsByIndex[t];if(!e){console.warn('Material "'+this.materialNames[t]+'" not found in mesh. Did you forget to call addMaterialLibrary(...)?"');break}n.setInt16(a,e.antiAliasing,!0);break}}}}return r}makeIndexBufferData(){const t=new Uint16Array(this.indices);return t.numItems=this.indices.length,t}addMaterialLibrary(t){for(const e in t.materials){if(!(e in this.materialIndices))continue;const r=t.materials[e],i=this.materialIndices[r.name];this.materials[e]=r,this.materialsByIndex[i]=r}}}const o=0,h=.2,u=.8,l=0,c=20,d=1,f=1,p=2;class m{constructor(t){this.name=t,this.illumination=p,this.ambient=[h,h,h],this.mapAmbient=null,this.diffuse=[u,u,u],this.mapDiffuse=null,this.transparency=1,this.mapTransparency=null,this.specular=[l,l,l],this.mapSpecular=null,this.mapSpecularExponent=null,this.specularExponent=c,this.emissive=[o,o,o],this.mapEmissive=null,this.transmissionFilter=[f,f,f],this.dissolve=0,this.mapDissolve=null,this.refractionIndex=d,this.sharpness=0,this.antiAliasing=!1,this.mapBump=null,this.mapDisplacement=null,this.mapDecal=null,this.mapReflections=[],this.isTextureActive=new Array(6),this.textureIds=[]}updateActiveTextures(){0===this.illumination&&(this.emissive[0]=Math.min(this.emissive[0]+this.diffuse[0]+this.ambient[0],1),this.emissive[1]=Math.min(this.emissive[1]+this.diffuse[1]+this.ambient[1],1),this.emissive[2]=Math.min(this.emissive[2]+this.diffuse[2]+this.ambient[2],1),this.mapEmissive=this.mapAmbient||this.mapDiffuse||this.mapEmissive,this.diffuse=[0,0,0],this.ambient=[0,0,0],this.mapDiffuse=null,this.mapAmbient=null),this.isTextureActive[0]=null!=this.mapTransparency,this.isTextureActive[1]=null!=this.mapEmissive,this.isTextureActive[2]=null!=this.mapAmbient,this.isTextureActive[3]=null!=this.mapDiffuse,this.isTextureActive[4]=null!=this.mapSpecular,this.isTextureActive[5]=null!=this.mapSpecularExponent}}class _{constructor(t){this.data=t,this.currentMaterial=null,this.materials=[],this.parse();for(let t in this.materials)this.materials[t].updateActiveTextures()}parse_newmtl(t){let e=t[0];this.currentMaterial=new m(e),this.materials[e]=this.currentMaterial}parseColor(t){if("spectral"==t[0])return void console.error("The MTL parser does not support spectral curve files. You will need to convert the MTL colors to either RGB or CIEXYZ.");if("xyz"==t[0])return void console.warn("TODO: convert XYZ to RGB");if(3==t.length)return t.map(parseFloat);let e=parseFloat(t[0]);return[e,e,e]}parse_Ka(t){this.currentMaterial.ambient=this.parseColor(t)}parse_Kd(t){this.currentMaterial.diffuse=this.parseColor(t)}parse_Ks(t){this.currentMaterial.specular=this.parseColor(t)}parse_Ke(t){this.currentMaterial.emissive=this.parseColor(t)}parse_Tf(t){this.currentMaterial.transmissionFilter=this.parseColor(t)}parse_d(t){this.currentMaterial.transparency=1-parseFloat(t.pop())}parse_Tr(t){this.currentMaterial.transparency=parseFloat(t.pop())}parse_illum(t){this.currentMaterial.illumination=parseInt(t[0])}parse_Ni(t){this.currentMaterial.refractionIndex=parseFloat(t[0])}parse_Ns(t){this.currentMaterial.specularExponent=parseInt(t[0])}parse_sharpness(t){this.currentMaterial.sharpness=parseInt(t[0])}parse_cc(t,e){e.colorCorrection="on"==t[0]}parse_blendu(t,e){e.horizontalBlending="on"==t[0]}parse_blendv(t,e){e.verticalBlending="on"==t[0]}parse_boost(t,e){e.boostMipMapSharpness=parseFloat(t[0])}parse_mm(t,e){e.modifyTextureMap.brightness=parseFloat(t[0]),e.modifyTextureMap.contrast=parseFloat(t[1])}parse_ost(t,e,r){for(;t.length<3;)t.push(r);e.u=parseFloat(t[0]),e.v=parseFloat(t[1]),e.w=parseFloat(t[2])}parse_o(t,e){this.parse_ost(t,e.offset,0)}parse_s(t,e){this.parse_ost(t,e.scale,1)}parse_t(t,e){this.parse_ost(t,e.turbulence,0)}parse_texres(t,e){e.textureResolution=parseFloat(t[0])}parse_clamp(t,e){e.clamp="on"==t[0]}parse_bm(t,e){e.bumpMultiplier=parseFloat(t[0])}parse_imfchan(t,e){e.imfChan=t[0]}parse_type(t,e){e.reflectionType=t[0]}parseOptions(t){let e,r,i={colorCorrection:!1,horizontalBlending:!0,verticalBlending:!0,boostMipMapSharpness:0,modifyTextureMap:{brightness:0,contrast:1},offset:{u:0,v:0,w:0},scale:{u:1,v:1,w:1},turbulence:{u:0,v:0,w:0},clamp:!1,textureResolution:null,bumpMultiplier:1,imfChan:null},n={};for(t.reverse();t.length;){const r=t.pop();r.startsWith("-")?n[e=r.substr(1)]=[]:n[e].push(r)}for(e in n){if(!n.hasOwnProperty(e))continue;r=n[e];let t=this[`parse_${e}`];t&&t.bind(this)(r,i)}return i}parseMap(t){let e,r;return t[0].startsWith("-")?(e=t.pop(),r=t):[e,...r]=t,(r=this.parseOptions(r)).filename=e,r}parse_map_Ka(t){this.currentMaterial.mapAmbient=this.parseMap(t)}parse_map_Kd(t){this.currentMaterial.mapDiffuse=this.parseMap(t)}parse_map_Ks(t){this.currentMaterial.mapSpecular=this.parseMap(t)}parse_map_Ke(t){this.currentMaterial.mapEmissive=this.parseMap(t)}parse_map_Ns(t){this.currentMaterial.mapSpecularExponent=this.parseMap(t)}parse_map_d(t){this.currentMaterial.mapTransparency=this.parseMap(t)}parse_map_Tr(t){this.currentMaterial.mapTransparency=this.parseMap(t)}parse_map_aat(t){this.currentMaterial.antiAliasing="on"==t[0]}parse_map_bump(t){this.currentMaterial.mapBump=this.parseMap(t)}parse_bump(t){this.parse_map_bump(t)}parse_disp(t){this.currentMaterial.mapDisplacement=this.parseMap(t)}parse_decal(t){this.currentMaterial.mapDecal=this.parseMap(t)}parse_refl(t){this.currentMaterial.mapReflections.push(this.parseMap(t))}parse(){let t=this.data.split(/\r?\n/);for(let e of t){if(!(e=e.trim())||e.startsWith("#"))continue;let t,r=e.split(/\s/);[t,...r]=r;let i=this[`parse_${t}`];i?i.bind(this)(r):console.warn(`Don't know how to parse the directive: "${t}"`)}delete this.data,this.currentMaterial=null}}function v(t,e){const r=["mapDiffuse","mapAmbient","mapSpecular","mapDissolve","mapBump","mapDisplacement","mapDecal","mapEmissive"];e.endsWith("/")||(e+="/");let i=[];for(let n in t.materials){if(!t.materials.hasOwnProperty(n))continue;n=t.materials[n];let s={};for(let t of r){let r=n[t];if(!r)continue;let a=e+r.filename;s.hasOwnProperty(r.filename)?r.image=s[r.filename]:(s[r.filename]=new Image,i.push(fetch(a).then(t=>{if(!t.ok)throw new Error;return t.blob()}).then(function(t){s[r.filename].src=URL.createObjectURL(t),r.image=s[r.filename]}).catch(()=>{console.error(`Unable to download texture: ${a}`),s[r.filename].failed=!0})))}}return Promise.all(i)}let g;function y(t){g=window.location.href.substr(0,window.location.href.lastIndexOf("/"));const e=[];for(const r of t){const t=[];if(!r.obj)throw new Error('"obj" attribute of model object not set. The .obj file is required to be set in order to use downloadModels()');let i=r.name;if(!i){let t=r.obj.split("/");i=t[t.length-1].replace(".obj","")}if(t.push(Promise.resolve(i)),t.push(fetch(g+r.obj).then(t=>t.text()).then(t=>new a(t))),r.mtl){let e=r.mtl;"boolean"==typeof e&&(e=r.obj.replace(/\.obj$/,".mtl")),t.push(fetch(g+e).then(t=>t.text()).then(t=>{let i=new _(t);if(!1!==r.downloadMtlTextures){let t=r.mtlTextureRoot;return t||(t=e.substr(0,e.lastIndexOf("/"))),Promise.all([Promise.resolve(i),v(i,g+t)])}return Promise.all(Promise.resolve(i))}).then(t=>t[0]))}e.push(Promise.all(t))}return Promise.all(e).then(t=>{const e={};for(const r of t){const[t,i,n]=r;i.name=t,n&&i.addMaterialLibrary(n),e[t]=i}return e})}function w(t,e,r){void 0===r&&(r={});const i=[];for(const e in t){if(!t.hasOwnProperty(e))continue;const r=t[e];i.push(fetch(r).then(t=>t.text()).then(t=>[e,new a(t)]))}Promise.all(i).then(t=>{for(let[e,i]of t)r[e]=i;return e(r)})}var M=function(t,e,r,i){var n=t.createBuffer(),s=e===t.ARRAY_BUFFER?Float32Array:Uint16Array;return t.bindBuffer(e,n),t.bufferData(e,new s(r),t.STATIC_DRAW),n.itemSize=i,n.numItems=r.length/i,n};function x(t,e){e.normalBuffer=M(t,t.ARRAY_BUFFER,e.vertexNormals,3),e.textureBuffer=M(t,t.ARRAY_BUFFER,e.textures,2),e.vertexBuffer=M(t,t.ARRAY_BUFFER,e.vertices,3),e.indexBuffer=M(t,t.ELEMENT_ARRAY_BUFFER,e.indices,1)}function b(t,e){t.deleteBuffer(e.normalBuffer),t.deleteBuffer(e.textureBuffer),t.deleteBuffer(e.vertexBuffer),t.deleteBuffer(e.indexBuffer)}r.d(e,"Mesh",function(){return a}),r.d(e,"Material",function(){return m}),r.d(e,"MaterialLibrary",function(){return _}),r.d(e,"Layout",function(){return i}),r.d(e,"downloadModels",function(){return y}),r.d(e,"downloadMeshes",function(){return w}),r.d(e,"initMeshBuffers",function(){return x}),r.d(e,"deleteMeshBuffers",function(){return b}),r.d(e,"downloadMtlTextures",function(){return v})},function(t,e,r){"use strict";(function(e){var i=r(16);
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */function n(t,e){if(t===e)return 0;for(var r=t.length,i=e.length,n=0,s=Math.min(r,i);n<s;++n)if(t[n]!==e[n]){r=t[n],i=e[n];break}return r<i?-1:i<r?1:0}function s(t){return e.Buffer&&"function"==typeof e.Buffer.isBuffer?e.Buffer.isBuffer(t):!(null==t||!t._isBuffer)}var a=r(17),o=Object.prototype.hasOwnProperty,h=Array.prototype.slice,u="foo"===function(){}.name;function l(t){return Object.prototype.toString.call(t)}function c(t){return!s(t)&&("function"==typeof e.ArrayBuffer&&("function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(t):!!t&&(t instanceof DataView||!!(t.buffer&&t.buffer instanceof ArrayBuffer))))}var d=t.exports=g,f=/\s*function\s+([^\(\s]*)\s*/;function p(t){if(a.isFunction(t)){if(u)return t.name;var e=t.toString().match(f);return e&&e[1]}}function m(t,e){return"string"==typeof t?t.length<e?t:t.slice(0,e):t}function _(t){if(u||!a.isFunction(t))return a.inspect(t);var e=p(t);return"[Function"+(e?": "+e:"")+"]"}function v(t,e,r,i,n){throw new d.AssertionError({message:r,actual:t,expected:e,operator:i,stackStartFunction:n})}function g(t,e){t||v(t,!0,e,"==",d.ok)}function y(t,e,r,i){if(t===e)return!0;if(s(t)&&s(e))return 0===n(t,e);if(a.isDate(t)&&a.isDate(e))return t.getTime()===e.getTime();if(a.isRegExp(t)&&a.isRegExp(e))return t.source===e.source&&t.global===e.global&&t.multiline===e.multiline&&t.lastIndex===e.lastIndex&&t.ignoreCase===e.ignoreCase;if(null!==t&&"object"==typeof t||null!==e&&"object"==typeof e){if(c(t)&&c(e)&&l(t)===l(e)&&!(t instanceof Float32Array||t instanceof Float64Array))return 0===n(new Uint8Array(t.buffer),new Uint8Array(e.buffer));if(s(t)!==s(e))return!1;var o=(i=i||{actual:[],expected:[]}).actual.indexOf(t);return-1!==o&&o===i.expected.indexOf(e)||(i.actual.push(t),i.expected.push(e),function(t,e,r,i){if(null==t||null==e)return!1;if(a.isPrimitive(t)||a.isPrimitive(e))return t===e;if(r&&Object.getPrototypeOf(t)!==Object.getPrototypeOf(e))return!1;var n=w(t),s=w(e);if(n&&!s||!n&&s)return!1;if(n)return t=h.call(t),e=h.call(e),y(t,e,r);var o,u,l=b(t),c=b(e);if(l.length!==c.length)return!1;for(l.sort(),c.sort(),u=l.length-1;u>=0;u--)if(l[u]!==c[u])return!1;for(u=l.length-1;u>=0;u--)if(o=l[u],!y(t[o],e[o],r,i))return!1;return!0}(t,e,r,i))}return r?t===e:t==e}function w(t){return"[object Arguments]"==Object.prototype.toString.call(t)}function M(t,e){if(!t||!e)return!1;if("[object RegExp]"==Object.prototype.toString.call(e))return e.test(t);try{if(t instanceof e)return!0}catch(t){}return!Error.isPrototypeOf(e)&&!0===e.call({},t)}function x(t,e,r,i){var n;if("function"!=typeof e)throw new TypeError('"block" argument must be a function');"string"==typeof r&&(i=r,r=null),n=function(t){var e;try{t()}catch(t){e=t}return e}(e),i=(r&&r.name?" ("+r.name+").":".")+(i?" "+i:"."),t&&!n&&v(n,r,"Missing expected exception"+i);var s="string"==typeof i,o=!t&&n&&!r;if((!t&&a.isError(n)&&s&&M(n,r)||o)&&v(n,r,"Got unwanted exception"+i),t&&n&&r&&!M(n,r)||!t&&n)throw n}d.AssertionError=function(t){var e;this.name="AssertionError",this.actual=t.actual,this.expected=t.expected,this.operator=t.operator,t.message?(this.message=t.message,this.generatedMessage=!1):(this.message=m(_((e=this).actual),128)+" "+e.operator+" "+m(_(e.expected),128),this.generatedMessage=!0);var r=t.stackStartFunction||v;if(Error.captureStackTrace)Error.captureStackTrace(this,r);else{var i=new Error;if(i.stack){var n=i.stack,s=p(r),a=n.indexOf("\n"+s);if(a>=0){var o=n.indexOf("\n",a+1);n=n.substring(o+1)}this.stack=n}}},a.inherits(d.AssertionError,Error),d.fail=v,d.ok=g,d.equal=function(t,e,r){t!=e&&v(t,e,r,"==",d.equal)},d.notEqual=function(t,e,r){t==e&&v(t,e,r,"!=",d.notEqual)},d.deepEqual=function(t,e,r){y(t,e,!1)||v(t,e,r,"deepEqual",d.deepEqual)},d.deepStrictEqual=function(t,e,r){y(t,e,!0)||v(t,e,r,"deepStrictEqual",d.deepStrictEqual)},d.notDeepEqual=function(t,e,r){y(t,e,!1)&&v(t,e,r,"notDeepEqual",d.notDeepEqual)},d.notDeepStrictEqual=function t(e,r,i){y(e,r,!0)&&v(e,r,i,"notDeepStrictEqual",t)},d.strictEqual=function(t,e,r){t!==e&&v(t,e,r,"===",d.strictEqual)},d.notStrictEqual=function(t,e,r){t===e&&v(t,e,r,"!==",d.notStrictEqual)},d.throws=function(t,e,r){x(!0,t,e,r)},d.doesNotThrow=function(t,e,r){x(!1,t,e,r)},d.ifError=function(t){if(t)throw t},d.strict=i(function t(e,r){e||v(e,!0,r,"==",t)},d,{equal:d.strictEqual,deepEqual:d.deepStrictEqual,notEqual:d.notStrictEqual,notDeepEqual:d.notDeepStrictEqual}),d.strict.strict=d.strict;var b=Object.keys||function(t){var e=[];for(var r in t)o.call(t,r)&&e.push(r);return e}}).call(this,r(15))},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(0),n=function(){function t(t){this.table={},this.nElements=0,this.toStr=t||i.defaultToString}return t.prototype.getValue=function(t){var e=this.table["$"+this.toStr(t)];if(!i.isUndefined(e))return e.value},t.prototype.setValue=function(t,e){if(!i.isUndefined(t)&&!i.isUndefined(e)){var r,n="$"+this.toStr(t),s=this.table[n];return i.isUndefined(s)?(this.nElements++,r=void 0):r=s.value,this.table[n]={key:t,value:e},r}},t.prototype.remove=function(t){var e="$"+this.toStr(t),r=this.table[e];if(!i.isUndefined(r))return delete this.table[e],this.nElements--,r.value},t.prototype.keys=function(){var t=[];for(var e in this.table)if(i.has(this.table,e)){var r=this.table[e];t.push(r.key)}return t},t.prototype.values=function(){var t=[];for(var e in this.table)if(i.has(this.table,e)){var r=this.table[e];t.push(r.value)}return t},t.prototype.forEach=function(t){for(var e in this.table)if(i.has(this.table,e)){var r=this.table[e];if(!1===t(r.key,r.value))return}},t.prototype.containsKey=function(t){return!i.isUndefined(this.getValue(t))},t.prototype.clear=function(){this.table={},this.nElements=0},t.prototype.size=function(){return this.nElements},t.prototype.isEmpty=function(){return this.nElements<=0},t.prototype.toString=function(){var t="{";return this.forEach(function(e,r){t+="\n\t"+e+" : "+r}),t+"\n}"},t}();e.default=n},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(0);function n(t,e,r){for(var n=r||i.defaultEquals,s=t.length,a=0;a<s;a++)if(n(t[a],e))return a;return-1}e.indexOf=n,e.lastIndexOf=function(t,e,r){for(var n=r||i.defaultEquals,s=t.length-1;s>=0;s--)if(n(t[s],e))return s;return-1},e.contains=function(t,e,r){return n(t,e,r)>=0},e.remove=function(t,e,r){var i=n(t,e,r);return!(i<0||(t.splice(i,1),0))},e.frequency=function(t,e,r){for(var n=r||i.defaultEquals,s=t.length,a=0,o=0;o<s;o++)n(t[o],e)&&a++;return a},e.equals=function(t,e,r){var n=r||i.defaultEquals;if(t.length!==e.length)return!1;for(var s=t.length,a=0;a<s;a++)if(!n(t[a],e[a]))return!1;return!0},e.copy=function(t){return t.concat()},e.swap=function(t,e,r){if(e<0||e>=t.length||r<0||r>=t.length)return!1;var i=t[e];return t[e]=t[r],t[r]=i,!0},e.toString=function(t){return"["+t.toString()+"]"},e.forEach=function(t,e){for(var r=0,i=t;r<i.length;r++)if(!1===e(i[r]))return}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(0),n=r(4),s=function(){function t(){this.firstNode=null,this.lastNode=null,this.nElements=0}return t.prototype.add=function(t,e){if(i.isUndefined(e)&&(e=this.nElements),e<0||e>this.nElements||i.isUndefined(t))return!1;var r=this.createNode(t);if(0===this.nElements||null===this.lastNode)this.firstNode=r,this.lastNode=r;else if(e===this.nElements)this.lastNode.next=r,this.lastNode=r;else if(0===e)r.next=this.firstNode,this.firstNode=r;else{var n=this.nodeAtIndex(e-1);if(null==n)return!1;r.next=n.next,n.next=r}return this.nElements++,!0},t.prototype.first=function(){if(null!==this.firstNode)return this.firstNode.element},t.prototype.last=function(){if(null!==this.lastNode)return this.lastNode.element},t.prototype.elementAtIndex=function(t){var e=this.nodeAtIndex(t);if(null!==e)return e.element},t.prototype.indexOf=function(t,e){var r=e||i.defaultEquals;if(i.isUndefined(t))return-1;for(var n=this.firstNode,s=0;null!==n;){if(r(n.element,t))return s;s++,n=n.next}return-1},t.prototype.contains=function(t,e){return this.indexOf(t,e)>=0},t.prototype.remove=function(t,e){var r=e||i.defaultEquals;if(this.nElements<1||i.isUndefined(t))return!1;for(var n=null,s=this.firstNode;null!==s;){if(r(s.element,t))return null==n?(this.firstNode=s.next,s===this.lastNode&&(this.lastNode=null)):s===this.lastNode?(this.lastNode=n,n.next=s.next,s.next=null):(n.next=s.next,s.next=null),this.nElements--,!0;n=s,s=s.next}return!1},t.prototype.clear=function(){this.firstNode=null,this.lastNode=null,this.nElements=0},t.prototype.equals=function(e,r){var n=r||i.defaultEquals;return e instanceof t&&(this.size()===e.size()&&this.equalsAux(this.firstNode,e.firstNode,n))},t.prototype.equalsAux=function(t,e,r){for(;null!==t&&null!==e;){if(!r(t.element,e.element))return!1;t=t.next,e=e.next}return!0},t.prototype.removeElementAtIndex=function(t){if(!(t<0||t>=this.nElements||null===this.firstNode||null===this.lastNode)){var e;if(1===this.nElements)e=this.firstNode.element,this.firstNode=null,this.lastNode=null;else{var r=this.nodeAtIndex(t-1);null===r?(e=this.firstNode.element,this.firstNode=this.firstNode.next):r.next===this.lastNode&&(e=this.lastNode.element,this.lastNode=r),null!==r&&null!==r.next&&(e=r.next.element,r.next=r.next.next)}return this.nElements--,e}},t.prototype.forEach=function(t){for(var e=this.firstNode;null!==e&&!1!==t(e.element);)e=e.next},t.prototype.reverse=function(){for(var t=null,e=this.firstNode,r=null;null!==e;)r=e.next,e.next=t,t=e,e=r;r=this.firstNode,this.firstNode=this.lastNode,this.lastNode=r},t.prototype.toArray=function(){for(var t=[],e=this.firstNode;null!==e;)t.push(e.element),e=e.next;return t},t.prototype.size=function(){return this.nElements},t.prototype.isEmpty=function(){return this.nElements<=0},t.prototype.toString=function(){return n.toString(this.toArray())},t.prototype.nodeAtIndex=function(t){if(t<0||t>=this.nElements)return null;if(t===this.nElements-1)return this.lastNode;for(var e=this.firstNode,r=0;r<t&&null!=e;r++)e=e.next;return e},t.prototype.createNode=function(t){return{element:t,next:null}},t}();e.default=s},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(4);e.arrays=i;var n=r(22);e.Bag=n.default;var s=r(23);e.BSTree=s.default;var a=r(8);e.BSTreeKV=a.default;var o=r(3);e.Dictionary=o.default;var h=r(10);e.Heap=h.default;var u=r(24);e.LinkedDictionary=u.default;var l=r(5);e.LinkedList=l.default;var c=r(25);e.MultiDictionary=c.default;var d=r(11);e.FactoryDictionary=d.default;var f=r(11);e.DefaultDictionary=f.default;var p=r(9);e.Queue=p.default;var m=r(26);e.PriorityQueue=m.default;var _=r(7);e.Set=_.default;var v=r(27);e.Stack=v.default;var g=r(28);e.MultiRootTree=g.default;var y=r(0);e.util=y},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(0),n=r(4),s=r(3),a=function(){function t(t){this.dictionary=new s.default(t)}return t.prototype.contains=function(t){return this.dictionary.containsKey(t)},t.prototype.add=function(t){return!this.contains(t)&&!i.isUndefined(t)&&(this.dictionary.setValue(t,t),!0)},t.prototype.intersection=function(t){var e=this;this.forEach(function(r){return t.contains(r)||e.remove(r),!0})},t.prototype.union=function(t){var e=this;t.forEach(function(t){return e.add(t),!0})},t.prototype.difference=function(t){var e=this;t.forEach(function(t){return e.remove(t),!0})},t.prototype.isSubsetOf=function(t){if(this.size()>t.size())return!1;var e=!0;return this.forEach(function(r){return!!t.contains(r)||(e=!1,!1)}),e},t.prototype.remove=function(t){return!!this.contains(t)&&(this.dictionary.remove(t),!0)},t.prototype.forEach=function(t){this.dictionary.forEach(function(e,r){return t(r)})},t.prototype.toArray=function(){return this.dictionary.values()},t.prototype.isEmpty=function(){return this.dictionary.isEmpty()},t.prototype.size=function(){return this.dictionary.size()},t.prototype.clear=function(){this.dictionary.clear()},t.prototype.toString=function(){return n.toString(this.toArray())},t}();e.default=a},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(0),n=r(9),s=function(){function t(t){this.root=null,this.compare=t||i.defaultCompare,this.nElements=0}return t.prototype.add=function(t){return!i.isUndefined(t)&&(null!==this.insertNode(this.createNode(t))&&(this.nElements++,!0))},t.prototype.clear=function(){this.root=null,this.nElements=0},t.prototype.isEmpty=function(){return 0===this.nElements},t.prototype.size=function(){return this.nElements},t.prototype.contains=function(t){return!i.isUndefined(t)&&null!==this.searchNode(this.root,t)},t.prototype.search=function(t){var e=this.searchNode(this.root,t);if(null!==e)return e.element},t.prototype.remove=function(t){var e=this.searchNode(this.root,t);return null!==e&&(this.removeNode(e),this.nElements--,!0)},t.prototype.inorderTraversal=function(t){this.inorderTraversalAux(this.root,t,{stop:!1})},t.prototype.preorderTraversal=function(t){this.preorderTraversalAux(this.root,t,{stop:!1})},t.prototype.postorderTraversal=function(t){this.postorderTraversalAux(this.root,t,{stop:!1})},t.prototype.levelTraversal=function(t){this.levelTraversalAux(this.root,t)},t.prototype.minimum=function(){if(!this.isEmpty()&&null!==this.root)return this.minimumAux(this.root).element},t.prototype.maximum=function(){if(!this.isEmpty()&&null!==this.root)return this.maximumAux(this.root).element},t.prototype.forEach=function(t){this.inorderTraversal(t)},t.prototype.toArray=function(){var t=[];return this.inorderTraversal(function(e){return t.push(e),!0}),t},t.prototype.height=function(){return this.heightAux(this.root)},t.prototype.searchNode=function(t,e){for(var r=1;null!==t&&0!==r;)(r=this.compare(e,t.element))<0?t=t.leftCh:r>0&&(t=t.rightCh);return t},t.prototype.transplant=function(t,e){null===t.parent?this.root=e:t===t.parent.leftCh?t.parent.leftCh=e:t.parent.rightCh=e,null!==e&&(e.parent=t.parent)},t.prototype.removeNode=function(t){if(null===t.leftCh)this.transplant(t,t.rightCh);else if(null===t.rightCh)this.transplant(t,t.leftCh);else{var e=this.minimumAux(t.rightCh);e.parent!==t&&(this.transplant(e,e.rightCh),e.rightCh=t.rightCh,e.rightCh.parent=e),this.transplant(t,e),e.leftCh=t.leftCh,e.leftCh.parent=e}},t.prototype.inorderTraversalAux=function(t,e,r){null===t||r.stop||(this.inorderTraversalAux(t.leftCh,e,r),r.stop||(r.stop=!1===e(t.element),r.stop||this.inorderTraversalAux(t.rightCh,e,r)))},t.prototype.levelTraversalAux=function(t,e){var r=new n.default;for(null!==t&&r.enqueue(t),t=r.dequeue()||null;null!=t;){if(!1===e(t.element))return;null!==t.leftCh&&r.enqueue(t.leftCh),null!==t.rightCh&&r.enqueue(t.rightCh),t=r.dequeue()||null}},t.prototype.preorderTraversalAux=function(t,e,r){null===t||r.stop||(r.stop=!1===e(t.element),r.stop||(this.preorderTraversalAux(t.leftCh,e,r),r.stop||this.preorderTraversalAux(t.rightCh,e,r)))},t.prototype.postorderTraversalAux=function(t,e,r){null===t||r.stop||(this.postorderTraversalAux(t.leftCh,e,r),r.stop||(this.postorderTraversalAux(t.rightCh,e,r),r.stop||(r.stop=!1===e(t.element))))},t.prototype.minimumAux=function(t){for(;null!=t&&null!==t.leftCh;)t=t.leftCh;return t},t.prototype.maximumAux=function(t){for(;null!=t&&null!==t.rightCh;)t=t.rightCh;return t},t.prototype.heightAux=function(t){return null===t?-1:Math.max(this.heightAux(t.leftCh),this.heightAux(t.rightCh))+1},t.prototype.insertNode=function(t){for(var e=null,r=this.root;null!==r;){var i=this.compare(t.element,r.element);if(0===i)return null;i<0?(e=r,r=r.leftCh):(e=r,r=r.rightCh)}return t.parent=e,null===e?this.root=t:this.compare(t.element,e.element)<0?e.leftCh=t:e.rightCh=t,t},t.prototype.createNode=function(t){return{element:t,leftCh:null,rightCh:null,parent:null}},t}();e.default=s},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(5),n=function(){function t(){this.list=new i.default}return t.prototype.enqueue=function(t){return this.list.add(t)},t.prototype.add=function(t){return this.list.add(t)},t.prototype.dequeue=function(){if(0!==this.list.size()){var t=this.list.first();return this.list.removeElementAtIndex(0),t}},t.prototype.peek=function(){if(0!==this.list.size())return this.list.first()},t.prototype.size=function(){return this.list.size()},t.prototype.contains=function(t,e){return this.list.contains(t,e)},t.prototype.isEmpty=function(){return this.list.size()<=0},t.prototype.clear=function(){this.list.clear()},t.prototype.forEach=function(t){this.list.forEach(t)},t}();e.default=n},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(0),n=r(4),s=function(){function t(t){this.data=[],this.compare=t||i.defaultCompare}return t.prototype.leftChildIndex=function(t){return 2*t+1},t.prototype.rightChildIndex=function(t){return 2*t+2},t.prototype.parentIndex=function(t){return Math.floor((t-1)/2)},t.prototype.minIndex=function(t,e){return e>=this.data.length?t>=this.data.length?-1:t:this.compare(this.data[t],this.data[e])<=0?t:e},t.prototype.siftUp=function(t){for(var e=this.parentIndex(t);t>0&&this.compare(this.data[e],this.data[t])>0;)n.swap(this.data,e,t),t=e,e=this.parentIndex(t)},t.prototype.siftDown=function(t){for(var e=this.minIndex(this.leftChildIndex(t),this.rightChildIndex(t));e>=0&&this.compare(this.data[t],this.data[e])>0;)n.swap(this.data,e,t),t=e,e=this.minIndex(this.leftChildIndex(t),this.rightChildIndex(t))},t.prototype.peek=function(){return this.data.length>0?this.data[0]:void 0},t.prototype.add=function(t){return!i.isUndefined(t)&&(this.data.push(t),this.siftUp(this.data.length-1),!0)},t.prototype.removeRoot=function(){if(this.data.length>0){var t=this.data[0];return this.data[0]=this.data[this.data.length-1],this.data.splice(this.data.length-1,1),this.data.length>0&&this.siftDown(0),t}},t.prototype.contains=function(t){var e=i.compareToEquals(this.compare);return n.contains(this.data,t,e)},t.prototype.size=function(){return this.data.length},t.prototype.isEmpty=function(){return this.data.length<=0},t.prototype.clear=function(){this.data.length=0},t.prototype.forEach=function(t){n.forEach(this.data,t)},t}();e.default=s},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var s=r(3),a=r(0),o=function(t){function e(e,r){var i=t.call(this,r)||this;return i.defaultFactoryFunction=e,i}return n(e,t),e.prototype.setDefault=function(e,r){var i=t.prototype.getValue.call(this,e);return a.isUndefined(i)?(this.setValue(e,r),r):i},e.prototype.getValue=function(t){return this.setDefault(t,this.defaultFactoryFunction())},e}(s.default);e.default=o},,,,function(t,e){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(t){"object"==typeof window&&(r=window)}t.exports=r},function(t,e,r){"use strict";
/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var i=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable;t.exports=function(){try{if(!Object.assign)return!1;var t=new String("abc");if(t[5]="de","5"===Object.getOwnPropertyNames(t)[0])return!1;for(var e={},r=0;r<10;r++)e["_"+String.fromCharCode(r)]=r;if("0123456789"!==Object.getOwnPropertyNames(e).map(function(t){return e[t]}).join(""))return!1;var i={};return"abcdefghijklmnopqrst".split("").forEach(function(t){i[t]=t}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},i)).join("")}catch(t){return!1}}()?Object.assign:function(t,e){for(var r,a,o=function(t){if(null==t)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}(t),h=1;h<arguments.length;h++){for(var u in r=Object(arguments[h]))n.call(r,u)&&(o[u]=r[u]);if(i){a=i(r);for(var l=0;l<a.length;l++)s.call(r,a[l])&&(o[a[l]]=r[a[l]])}}return o}},function(t,e,r){(function(t){var i=Object.getOwnPropertyDescriptors||function(t){for(var e=Object.keys(t),r={},i=0;i<e.length;i++)r[e[i]]=Object.getOwnPropertyDescriptor(t,e[i]);return r},n=/%[sdj%]/g;e.format=function(t){if(!v(t)){for(var e=[],r=0;r<arguments.length;r++)e.push(o(arguments[r]));return e.join(" ")}r=1;for(var i=arguments,s=i.length,a=String(t).replace(n,function(t){if("%%"===t)return"%";if(r>=s)return t;switch(t){case"%s":return String(i[r++]);case"%d":return Number(i[r++]);case"%j":try{return JSON.stringify(i[r++])}catch(t){return"[Circular]"}default:return t}}),h=i[r];r<s;h=i[++r])m(h)||!w(h)?a+=" "+h:a+=" "+o(h);return a},e.deprecate=function(r,i){if(void 0!==t&&!0===t.noDeprecation)return r;if(void 0===t)return function(){return e.deprecate(r,i).apply(this,arguments)};var n=!1;return function(){if(!n){if(t.throwDeprecation)throw new Error(i);t.traceDeprecation?console.trace(i):console.error(i),n=!0}return r.apply(this,arguments)}};var s,a={};function o(t,r){var i={seen:[],stylize:u};return arguments.length>=3&&(i.depth=arguments[2]),arguments.length>=4&&(i.colors=arguments[3]),p(r)?i.showHidden=r:r&&e._extend(i,r),g(i.showHidden)&&(i.showHidden=!1),g(i.depth)&&(i.depth=2),g(i.colors)&&(i.colors=!1),g(i.customInspect)&&(i.customInspect=!0),i.colors&&(i.stylize=h),l(i,t,i.depth)}function h(t,e){var r=o.styles[e];return r?"["+o.colors[r][0]+"m"+t+"["+o.colors[r][1]+"m":t}function u(t,e){return t}function l(t,r,i){if(t.customInspect&&r&&b(r.inspect)&&r.inspect!==e.inspect&&(!r.constructor||r.constructor.prototype!==r)){var n=r.inspect(i,t);return v(n)||(n=l(t,n,i)),n}var s=function(t,e){if(g(e))return t.stylize("undefined","undefined");if(v(e)){var r="'"+JSON.stringify(e).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return t.stylize(r,"string")}if(_(e))return t.stylize(""+e,"number");if(p(e))return t.stylize(""+e,"boolean");if(m(e))return t.stylize("null","null")}(t,r);if(s)return s;var a=Object.keys(r),o=function(t){var e={};return t.forEach(function(t,r){e[t]=!0}),e}(a);if(t.showHidden&&(a=Object.getOwnPropertyNames(r)),x(r)&&(a.indexOf("message")>=0||a.indexOf("description")>=0))return c(r);if(0===a.length){if(b(r)){var h=r.name?": "+r.name:"";return t.stylize("[Function"+h+"]","special")}if(y(r))return t.stylize(RegExp.prototype.toString.call(r),"regexp");if(M(r))return t.stylize(Date.prototype.toString.call(r),"date");if(x(r))return c(r)}var u,w="",E=!1,A=["{","}"];(f(r)&&(E=!0,A=["[","]"]),b(r))&&(w=" [Function"+(r.name?": "+r.name:"")+"]");return y(r)&&(w=" "+RegExp.prototype.toString.call(r)),M(r)&&(w=" "+Date.prototype.toUTCString.call(r)),x(r)&&(w=" "+c(r)),0!==a.length||E&&0!=r.length?i<0?y(r)?t.stylize(RegExp.prototype.toString.call(r),"regexp"):t.stylize("[Object]","special"):(t.seen.push(r),u=E?function(t,e,r,i,n){for(var s=[],a=0,o=e.length;a<o;++a)I(e,String(a))?s.push(d(t,e,r,i,String(a),!0)):s.push("");return n.forEach(function(n){n.match(/^\d+$/)||s.push(d(t,e,r,i,n,!0))}),s}(t,r,i,o,a):a.map(function(e){return d(t,r,i,o,e,E)}),t.seen.pop(),function(t,e,r){if(t.reduce(function(t,e){return 0,e.indexOf("\n")>=0&&0,t+e.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60)return r[0]+(""===e?"":e+"\n ")+" "+t.join(",\n  ")+" "+r[1];return r[0]+e+" "+t.join(", ")+" "+r[1]}(u,w,A)):A[0]+w+A[1]}function c(t){return"["+Error.prototype.toString.call(t)+"]"}function d(t,e,r,i,n,s){var a,o,h;if((h=Object.getOwnPropertyDescriptor(e,n)||{value:e[n]}).get?o=h.set?t.stylize("[Getter/Setter]","special"):t.stylize("[Getter]","special"):h.set&&(o=t.stylize("[Setter]","special")),I(i,n)||(a="["+n+"]"),o||(t.seen.indexOf(h.value)<0?(o=m(r)?l(t,h.value,null):l(t,h.value,r-1)).indexOf("\n")>-1&&(o=s?o.split("\n").map(function(t){return"  "+t}).join("\n").substr(2):"\n"+o.split("\n").map(function(t){return"   "+t}).join("\n")):o=t.stylize("[Circular]","special")),g(a)){if(s&&n.match(/^\d+$/))return o;(a=JSON.stringify(""+n)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(a=a.substr(1,a.length-2),a=t.stylize(a,"name")):(a=a.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),a=t.stylize(a,"string"))}return a+": "+o}function f(t){return Array.isArray(t)}function p(t){return"boolean"==typeof t}function m(t){return null===t}function _(t){return"number"==typeof t}function v(t){return"string"==typeof t}function g(t){return void 0===t}function y(t){return w(t)&&"[object RegExp]"===E(t)}function w(t){return"object"==typeof t&&null!==t}function M(t){return w(t)&&"[object Date]"===E(t)}function x(t){return w(t)&&("[object Error]"===E(t)||t instanceof Error)}function b(t){return"function"==typeof t}function E(t){return Object.prototype.toString.call(t)}function A(t){return t<10?"0"+t.toString(10):t.toString(10)}e.debuglog=function(r){if(g(s)&&(s=t.env.NODE_DEBUG||""),r=r.toUpperCase(),!a[r])if(new RegExp("\\b"+r+"\\b","i").test(s)){var i=t.pid;a[r]=function(){var t=e.format.apply(e,arguments);console.error("%s %d: %s",r,i,t)}}else a[r]=function(){};return a[r]},e.inspect=o,o.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},o.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},e.isArray=f,e.isBoolean=p,e.isNull=m,e.isNullOrUndefined=function(t){return null==t},e.isNumber=_,e.isString=v,e.isSymbol=function(t){return"symbol"==typeof t},e.isUndefined=g,e.isRegExp=y,e.isObject=w,e.isDate=M,e.isError=x,e.isFunction=b,e.isPrimitive=function(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||void 0===t},e.isBuffer=r(19);var T=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function I(t,e){return Object.prototype.hasOwnProperty.call(t,e)}e.log=function(){var t,r;console.log("%s - %s",(t=new Date,r=[A(t.getHours()),A(t.getMinutes()),A(t.getSeconds())].join(":"),[t.getDate(),T[t.getMonth()],r].join(" ")),e.format.apply(e,arguments))},e.inherits=r(20),e._extend=function(t,e){if(!e||!w(e))return t;for(var r=Object.keys(e),i=r.length;i--;)t[r[i]]=e[r[i]];return t};var R="undefined"!=typeof Symbol?Symbol("util.promisify.custom"):void 0;function S(t,e){if(!t){var r=new Error("Promise was rejected with a falsy value");r.reason=t,t=r}return e(t)}e.promisify=function(t){if("function"!=typeof t)throw new TypeError('The "original" argument must be of type Function');if(R&&t[R]){var e;if("function"!=typeof(e=t[R]))throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(e,R,{value:e,enumerable:!1,writable:!1,configurable:!0}),e}function e(){for(var e,r,i=new Promise(function(t,i){e=t,r=i}),n=[],s=0;s<arguments.length;s++)n.push(arguments[s]);n.push(function(t,i){t?r(t):e(i)});try{t.apply(this,n)}catch(t){r(t)}return i}return Object.setPrototypeOf(e,Object.getPrototypeOf(t)),R&&Object.defineProperty(e,R,{value:e,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(e,i(t))},e.promisify.custom=R,e.callbackify=function(e){if("function"!=typeof e)throw new TypeError('The "original" argument must be of type Function');function r(){for(var r=[],i=0;i<arguments.length;i++)r.push(arguments[i]);var n=r.pop();if("function"!=typeof n)throw new TypeError("The last argument must be of type Function");var s=this,a=function(){return n.apply(s,arguments)};e.apply(this,r).then(function(e){t.nextTick(a,null,e)},function(e){t.nextTick(S,e,a)})}return Object.setPrototypeOf(r,Object.getPrototypeOf(e)),Object.defineProperties(r,i(e)),r}}).call(this,r(18))},function(t,e){var r,i,n=t.exports={};function s(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function o(t){if(r===setTimeout)return setTimeout(t,0);if((r===s||!r)&&setTimeout)return r=setTimeout,setTimeout(t,0);try{return r(t,0)}catch(e){try{return r.call(null,t,0)}catch(e){return r.call(this,t,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:s}catch(t){r=s}try{i="function"==typeof clearTimeout?clearTimeout:a}catch(t){i=a}}();var h,u=[],l=!1,c=-1;function d(){l&&h&&(l=!1,h.length?u=h.concat(u):c=-1,u.length&&f())}function f(){if(!l){var t=o(d);l=!0;for(var e=u.length;e;){for(h=u,u=[];++c<e;)h&&h[c].run();c=-1,e=u.length}h=null,l=!1,function(t){if(i===clearTimeout)return clearTimeout(t);if((i===a||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(t);try{i(t)}catch(e){try{return i.call(null,t)}catch(e){return i.call(this,t)}}}(t)}}function p(t,e){this.fun=t,this.array=e}function m(){}n.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)e[r-1]=arguments[r];u.push(new p(t,e)),1!==u.length||l||o(f)},p.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=m,n.addListener=m,n.once=m,n.off=m,n.removeListener=m,n.removeAllListeners=m,n.emit=m,n.prependListener=m,n.prependOnceListener=m,n.listeners=function(t){return[]},n.binding=function(t){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(t){throw new Error("process.chdir is not supported")},n.umask=function(){return 0}},function(t,e){t.exports=function(t){return t&&"object"==typeof t&&"function"==typeof t.copy&&"function"==typeof t.fill&&"function"==typeof t.readUInt8}},function(t,e){"function"==typeof Object.create?t.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(t,e){t.super_=e;var r=function(){};r.prototype=e.prototype,t.prototype=new r,t.prototype.constructor=t}},function(t,e,r){"use strict";r.r(e),e.default="#\r\n#  Disks.mtl\r\n#\r\n\r\nnewmtl diskA\r\nillum 1\r\nKd 0.80 0.80 0.80\r\nKa 0.20 0.20 0.20\r\nmap_Kd DiskA.jpg\r\nmap_Ka DiskA.jpg\r\n\r\nnewmtl diskA_side\r\nillum 1\r\nKd 0.80 0.80 0.80\r\nKa 0.20 0.20 0.20\r\nmap_Kd DiskA_side.jpg\r\nmap_Ka DiskA_side.jpg\r\n\r\nnewmtl diskB\r\nillum 1\r\nKd 0.80 0.80 0.80\r\nKa 0.20 0.20 0.20\r\nmap_Kd DiskB.jpg\r\nmap_Ka DiskB.jpg\r\n\r\nnewmtl diskB_side\r\nillum 1\r\nKd 0.80 0.80 0.80\r\nKa 0.20 0.20 0.20\r\nmap_Kd DiskB_side.jpg\r\nmap_Ka DiskB_side.jpg\r\n\r\nnewmtl diskC\r\nillum 1\r\nKd 0.80 0.80 0.80\r\nKa 0.20 0.20 0.20\r\nmap_Kd DiskC.jpg\r\nmap_Ka DiskC.jpg\r\n\r\n\r\nnewmtl diskC_side\r\nillum 1\r\nKd 0.80 0.80 0.80\r\nKa 0.20 0.20 0.20\r\nmap_Kd DiskC_side.jpg\r\nmap_Ka DiskC_side.jpg\r\n\r\nnewmtl diskD\r\nillum 1\r\nKd 0.80 0.80 0.80\r\nKa 0.20 0.20 0.20\r\nKs 0.0 0.0 0.0\r\nmap_Kd DiskD.jpg\r\nmap_Ka DiskD.jpg\r\n\r\nnewmtl diskD_side\r\nillum 1\r\nKd 0.80 0.80 0.80\r\nKa 0.20 0.20 0.20\r\nmap_Kd DiskD_side.jpg\r\nmap_Ka DiskD_side.jpg\r\n\r\nnewmtl diskE\r\nillum 1\r\nKd 0.80 0.80 0.80\r\nKa 0.20 0.20 0.20\r\nmap_Kd DiskE.jpg\r\nmap_Ka DiskE.jpg\r\n\r\nnewmtl diskE_side\r\nillum 1\r\nKd 0.80 0.80 0.80\r\nKa 0.20 0.20 0.20\r\nmap_Kd DiskE_side.jpg\r\nmap_Ka DiskE_side.jpg\r\n\r\nnewmtl flat_black\r\nillum 0\r\nKd 0.00 0.00 0.00\r\nKa 0.00 0.00 0.00\r\n\r\nnewmtl rainbow\r\nillum 1\r\nKd 0.80 0.80 0.80\r\nKa 0.20 0.20 0.20\r\nmap_Kd Rainbow.jpg\r\nmap_Ka Rainbow.jpg\r\n"},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(0),n=r(3),s=r(7),a=function(){function t(t){this.toStrF=t||i.defaultToString,this.dictionary=new n.default(this.toStrF),this.nElements=0}return t.prototype.add=function(t,e){if(void 0===e&&(e=1),i.isUndefined(t)||e<=0)return!1;if(this.contains(t))this.dictionary.getValue(t).copies+=e;else{var r={value:t,copies:e};this.dictionary.setValue(t,r)}return this.nElements+=e,!0},t.prototype.count=function(t){return this.contains(t)?this.dictionary.getValue(t).copies:0},t.prototype.contains=function(t){return this.dictionary.containsKey(t)},t.prototype.remove=function(t,e){if(void 0===e&&(e=1),i.isUndefined(t)||e<=0)return!1;if(this.contains(t)){var r=this.dictionary.getValue(t);return e>r.copies?this.nElements-=r.copies:this.nElements-=e,r.copies-=e,r.copies<=0&&this.dictionary.remove(t),!0}return!1},t.prototype.toArray=function(){for(var t=[],e=0,r=this.dictionary.values();e<r.length;e++)for(var i=r[e],n=i.value,s=i.copies,a=0;a<s;a++)t.push(n);return t},t.prototype.toSet=function(){for(var t=new s.default(this.toStrF),e=0,r=this.dictionary.values();e<r.length;e++){var i=r[e].value;t.add(i)}return t},t.prototype.forEach=function(t){this.dictionary.forEach(function(e,r){for(var i=r.value,n=r.copies,s=0;s<n;s++)if(!1===t(i))return!1;return!0})},t.prototype.size=function(){return this.nElements},t.prototype.isEmpty=function(){return 0===this.nElements},t.prototype.clear=function(){this.nElements=0,this.dictionary.clear()},t}();e.default=a},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e}(r(8).default);e.default=s},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var s=r(3),a=r(0),o=function(){function t(t,e){this.key=t,this.value=e}return t.prototype.unlink=function(){this.prev.next=this.next,this.next.prev=this.prev},t}(),h=function(){function t(){this.key=null,this.value=null}return t.prototype.unlink=function(){this.prev.next=this.next,this.next.prev=this.prev},t}();var u=function(t){function e(e){var r=t.call(this,e)||this;return r.head=new h,r.tail=new h,r.head.next=r.tail,r.tail.prev=r.head,r}return n(e,t),e.prototype.appendToTail=function(t){var e=this.tail.prev;e.next=t,t.prev=e,t.next=this.tail,this.tail.prev=t},e.prototype.getLinkedDictionaryPair=function(t){if(!a.isUndefined(t)){var e="$"+this.toStr(t);return this.table[e]}},e.prototype.getValue=function(t){var e=this.getLinkedDictionaryPair(t);if(!a.isUndefined(e))return e.value},e.prototype.remove=function(e){var r=this.getLinkedDictionaryPair(e);if(!a.isUndefined(r))return t.prototype.remove.call(this,e),r.unlink(),r.value},e.prototype.clear=function(){t.prototype.clear.call(this),this.head.next=this.tail,this.tail.prev=this.head},e.prototype.replace=function(t,e){var r="$"+this.toStr(e.key);e.next=t.next,e.prev=t.prev,this.remove(t.key),e.prev.next=e,e.next.prev=e,this.table[r]=e,++this.nElements},e.prototype.setValue=function(t,e){if(!a.isUndefined(t)&&!a.isUndefined(e)){var r=this.getLinkedDictionaryPair(t),i=new o(t,e),n="$"+this.toStr(t);return a.isUndefined(r)?(this.appendToTail(i),this.table[n]=i,void++this.nElements):(this.replace(r,i),r.value)}},e.prototype.keys=function(){var t=[];return this.forEach(function(e,r){t.push(e)}),t},e.prototype.values=function(){var t=[];return this.forEach(function(e,r){t.push(r)}),t},e.prototype.forEach=function(t){for(var e=this.head.next;null!==e.next;){if(!1===t(e.key,e.value))return;e=e.next}},e}(s.default);e.default=u},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(0),n=r(3),s=r(4),a=function(){function t(t,e,r){void 0===r&&(r=!1),this.dict=new n.default(t),this.equalsF=e||i.defaultEquals,this.allowDuplicate=r}return t.prototype.getValue=function(t){var e=this.dict.getValue(t);return i.isUndefined(e)?[]:s.copy(e)},t.prototype.setValue=function(t,e){if(i.isUndefined(t)||i.isUndefined(e))return!1;var r=this.dict.getValue(t);return i.isUndefined(r)?(this.dict.setValue(t,[e]),!0):!(!this.allowDuplicate&&s.contains(r,e,this.equalsF))&&(r.push(e),!0)},t.prototype.remove=function(t,e){if(i.isUndefined(e)){var r=this.dict.remove(t);return!i.isUndefined(r)}var n=this.dict.getValue(t);return!(i.isUndefined(n)||!s.remove(n,e,this.equalsF))&&(0===n.length&&this.dict.remove(t),!0)},t.prototype.keys=function(){return this.dict.keys()},t.prototype.values=function(){for(var t=[],e=0,r=this.dict.values();e<r.length;e++)for(var i=0,n=r[e];i<n.length;i++){var s=n[i];t.push(s)}return t},t.prototype.containsKey=function(t){return this.dict.containsKey(t)},t.prototype.clear=function(){this.dict.clear()},t.prototype.size=function(){return this.dict.size()},t.prototype.isEmpty=function(){return this.dict.isEmpty()},t}();e.default=a},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(0),n=r(10),s=function(){function t(t){this.heap=new n.default(i.reverseCompareFunction(t))}return t.prototype.enqueue=function(t){return this.heap.add(t)},t.prototype.add=function(t){return this.heap.add(t)},t.prototype.dequeue=function(){if(0!==this.heap.size()){var t=this.heap.peek();return this.heap.removeRoot(),t}},t.prototype.peek=function(){return this.heap.peek()},t.prototype.contains=function(t){return this.heap.contains(t)},t.prototype.isEmpty=function(){return this.heap.isEmpty()},t.prototype.size=function(){return this.heap.size()},t.prototype.clear=function(){this.heap.clear()},t.prototype.forEach=function(t){this.heap.forEach(t)},t}();e.default=s},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(5),n=function(){function t(){this.list=new i.default}return t.prototype.push=function(t){return this.list.add(t,0)},t.prototype.add=function(t){return this.list.add(t,0)},t.prototype.pop=function(){return this.list.removeElementAtIndex(0)},t.prototype.peek=function(){return this.list.first()},t.prototype.size=function(){return this.list.size()},t.prototype.contains=function(t,e){return this.list.contains(t,e)},t.prototype.isEmpty=function(){return this.list.isEmpty()},t.prototype.clear=function(){this.list.clear()},t.prototype.forEach=function(t){this.list.forEach(t)},t}();e.default=n},function(t,e,r){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t.BEFORE=0]="BEFORE",t[t.AFTER=1]="AFTER",t[t.INSIDE_AT_END=2]="INSIDE_AT_END",t[t.INSIDE_AT_START=3]="INSIDE_AT_START"}(i||(i={}));var n=function(){function t(t,e){void 0===t&&(t=[]),void 0===e&&(e={}),this.rootIds=t,this.nodes=e,this.initRootIds(),this.initNodes()}return t.prototype.initRootIds=function(){for(var t=0,e=this.rootIds;t<e.length;t++){var r=e[t];this.createEmptyNodeIfNotExist(r)}},t.prototype.initNodes=function(){for(var t in this.nodes)if(this.nodes.hasOwnProperty(t))for(var e=0,r=this.nodes[t];e<r.length;e++){var i=r[e];this.createEmptyNodeIfNotExist(i)}},t.prototype.createEmptyNodeIfNotExist=function(t){this.nodes[t]||(this.nodes[t]=[])},t.prototype.getRootIds=function(){return this.rootIds.slice()},t.prototype.getNodes=function(){var t={};for(var e in this.nodes)this.nodes.hasOwnProperty(e)&&(t[e]=this.nodes[e].slice());return t},t.prototype.getObject=function(){return{rootIds:this.getRootIds(),nodes:this.getNodes()}},t.prototype.toObject=function(){return this.getObject()},t.prototype.flatten=function(){for(var t=this,e=[],r=0;r<this.rootIds.length;r++){var i=this.rootIds[r];e.push({id:i,level:0,hasParent:!1,childrenCount:0}),h(i,this.nodes,e,0)}for(var n=0,s=e;n<s.length;n++){var a=s[n];a.childrenCount=o(a.id)}return e;function o(e){return t.nodes[e]?t.nodes[e].length:0}function h(t,e,r,i){if(void 0===i&&(i=0),t&&e&&r&&e[t]){i++;for(var n=e[t],s=0;s<n.length;s++){var a=n[s];r.push({id:a,level:i,hasParent:!0}),h(a,e,r,i)}i--}}},t.prototype.moveIdBeforeId=function(t,e){return this.moveId(t,e,i.BEFORE)},t.prototype.moveIdAfterId=function(t,e){return this.moveId(t,e,i.AFTER)},t.prototype.moveIdIntoId=function(t,e,r){return void 0===r&&(r=!0),r?this.moveId(t,e,i.INSIDE_AT_START):this.moveId(t,e,i.INSIDE_AT_END)},t.prototype.swapRootIdWithRootId=function(t,e){var r=this.findRootId(t),i=this.findRootId(e);this.swapRootPositionWithRootPosition(r,i)},t.prototype.swapRootPositionWithRootPosition=function(t,e){var r=this.rootIds[e];this.rootIds[e]=this.rootIds[t],this.rootIds[t]=r},t.prototype.deleteId=function(t){this.rootDeleteId(t),this.nodeAndSubNodesDelete(t),this.nodeRefrencesDelete(t)},t.prototype.insertIdBeforeId=function(t,e){var r=this.findRootId(t);for(var i in r>-1&&this.insertIdIntoRoot(e,r),this.nodes)if(this.nodes.hasOwnProperty(i)){var n=this.findNodeId(i,t);n>-1&&this.insertIdIntoNode(i,e,n)}},t.prototype.insertIdAfterId=function(t,e){var r=this.findRootId(t);for(var i in r>-1&&this.insertIdIntoRoot(e,r+1),this.nodes)if(this.nodes.hasOwnProperty(i)){var n=this.findNodeId(i,t);n>-1&&this.insertIdIntoNode(i,e,n+1)}},t.prototype.insertIdIntoId=function(t,e){this.nodeInsertAtEnd(t,e),this.nodes[e]=[]},t.prototype.insertIdIntoRoot=function(t,e){if(void 0===e)this.rootInsertAtEnd(t);else if(e<0){var r=this.rootIds.length;this.rootIds.splice(e+r+1,0,t)}else this.rootIds.splice(e,0,t);this.nodes[t]=this.nodes[t]||[]},t.prototype.insertIdIntoNode=function(t,e,r){if(this.nodes[t]=this.nodes[t]||[],this.nodes[e]=this.nodes[e]||[],void 0===r)this.nodeInsertAtEnd(t,e);else if(r<0){var i=this.nodes[t].length;this.nodes[t].splice(r+i+1,0,e)}else this.nodes[t].splice(r,0,e)},t.prototype.moveId=function(t,e,r){var n=t,s=this.findRootId(n);for(var a in this.nodes[e]&&e,this.nodes)if(this.nodes.hasOwnProperty(a)){this.findNodeId(a,e);break}var o=e,h=this.findRootId(o);for(var a in this.nodes[e]&&e,this.nodes)if(this.nodes.hasOwnProperty(a)){this.findNodeId(a,e);break}if(s>-1)if(h>-1)switch(this.rootDelete(s),h>s&&h--,r){case i.BEFORE:this.insertIdIntoRoot(n,h);break;case i.AFTER:this.insertIdIntoRoot(n,h+1);break;case i.INSIDE_AT_START:this.nodeInsertAtStart(o,n);break;case i.INSIDE_AT_END:this.nodeInsertAtEnd(o,n)}else for(var a in this.rootDelete(s),this.nodes){if(this.nodes.hasOwnProperty(a))if((u=this.findNodeId(a,o))>-1){switch(r){case i.BEFORE:this.insertIdIntoNode(a,n,u);break;case i.AFTER:this.insertIdIntoNode(a,n,u+1);break;case i.INSIDE_AT_START:this.nodeInsertAtStart(o,n);break;case i.INSIDE_AT_END:this.nodeInsertAtEnd(o,n)}break}}else if(h>-1){for(var a in this.nodes){if(this.nodes.hasOwnProperty(a))if((u=this.findNodeId(a,n))>-1){this.nodeDeleteAtIndex(a,u);break}}switch(r){case i.BEFORE:this.insertIdIntoRoot(n,h);break;case i.AFTER:this.insertIdIntoRoot(n,h+1);break;case i.INSIDE_AT_START:this.nodeInsertAtStart(o,n);break;case i.INSIDE_AT_END:this.nodeInsertAtEnd(o,n)}}else{for(var a in this.nodes){if(this.nodes.hasOwnProperty(a))if((u=this.findNodeId(a,n))>-1){this.nodeDeleteAtIndex(a,u);break}}for(var a in this.nodes){var u;if(this.nodes.hasOwnProperty(a))if((u=this.findNodeId(a,o))>-1){switch(r){case i.BEFORE:this.insertIdIntoNode(a,n,u);break;case i.AFTER:this.insertIdIntoNode(a,n,u+1);break;case i.INSIDE_AT_START:this.nodeInsertAtStart(o,n);break;case i.INSIDE_AT_END:this.nodeInsertAtEnd(o,n)}break}}}},t.prototype.swapArrayElements=function(t,e,r){var i=t[e];return t[e]=t[r],t[r]=i,t},t.prototype.rootDeleteId=function(t){var e=this.findRootId(t);e>-1&&this.rootDelete(e)},t.prototype.nodeAndSubNodesDelete=function(t){for(var e=[],r=0;r<this.nodes[t].length;r++){var i=this.nodes[t][r];this.nodeAndSubNodesDelete(i),e.push(t)}this.nodeDelete(t);for(r=0;r<e.length;r++)this.nodeDelete(e[r])},t.prototype.nodeRefrencesDelete=function(t){for(var e in this.nodes)if(this.nodes.hasOwnProperty(e))for(var r=0;r<this.nodes[e].length;r++){this.nodes[e][r]===t&&this.nodeDeleteAtIndex(e,r)}},t.prototype.nodeDelete=function(t){delete this.nodes[t]},t.prototype.findRootId=function(t){return this.rootIds.indexOf(t)},t.prototype.findNodeId=function(t,e){return this.nodes[t].indexOf(e)},t.prototype.findNode=function(t){return this.nodes[t]},t.prototype.nodeInsertAtStart=function(t,e){this.nodes[t].unshift(e)},t.prototype.nodeInsertAtEnd=function(t,e){this.nodes[t].push(e)},t.prototype.rootDelete=function(t){this.rootIds.splice(t,1)},t.prototype.nodeDeleteAtIndex=function(t,e){this.nodes[t].splice(e,1)},t.prototype.rootInsertAtStart=function(t){this.rootIds.unshift(t)},t.prototype.rootInsertAtEnd=function(t){this.rootIds.push(t)},t}();e.default=n},function(t,e,r){"use strict";r.r(e),e.default="#version 300 es\r\n\r\nuniform mat4 model_view_projection_matrix;\r\n\r\nlayout (location = 0) in vec3 a_vertex;\r\nlayout (location = 1) in vec4 a_color;\r\n\r\nout vec4 color;\r\n\r\nvoid main()\r\n{\r\n\tgl_Position = model_view_projection_matrix * vec4(a_vertex, 1.0);\r\n\t\t\r\n\tcolor = a_color;\r\n}\r\n"},function(t,e,r){"use strict";r.r(e),e.default="#version 300 es\r\nprecision mediump  float;\r\nin vec4 color;\r\n\r\nout vec4 FragColor;\r\n\r\nvoid main()\r\n{    \r\n    FragColor = color;\r\n} "},function(t,e,r){var i={"./Basic.txt":32,"./Dense.txt":33,"./Icy.txt":34,"./Leafy.txt":35,"./Rocky.txt":36,"./Sandy.txt":37,"./Simple.txt":38,"./Small.txt":39,"./Sparse.txt":40,"./Twisted.txt":41};function n(t){var e=s(t);return r(e)}function s(t){if(!r.o(i,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return i[t]}n.keys=function(){return Object.keys(i)},n.resolve=s,t.exports=n,n.id=31},function(t,e,r){"use strict";r.r(e),e.default="DISK version 1\r\n159.835\r\n61\r\n5.61676\t34.6006\t6.55774\t\r\n4.5521\t49.1698\t8.0504\t\r\n6.29182\t17.456\t10.6\t\r\n19.2771\t30.399\t7.7341\t\r\n-5.63964\t-6.61964\t16.2699\t\r\n-34.8144\t-13.928\t13.8063\t\r\n17.7224\t44.1054\t6.06006\t\r\n16.9081\t56.4082\t6.2697\t\r\n-51.3318\t-2.99788\t6\t\r\n-61.6816\t3.18528\t6.0561\t\r\n2.67116\t-44.403\t22.4166\t\r\n-61.7976\t-8.87178\t6.00154\t\r\n20.3596\t-15.7251\t11.2777\t\r\n53.2492\t45.6392\t29.4998\t\r\n28.4818\t20.19\t6.01188\t\r\n-56.16\t-23.3322\t9.51902\t\r\n29.7014\t5.71352\t8.51594\t\r\n-4.05204\t60.2884\t6.00862\t\r\n-73.0756\t12.5486\t8.6916\t\r\n-13.4131\t76.324\t12.5593\t\r\n-73.0176\t-2.86702\t6.72414\t\r\n-72.7376\t-17.5524\t7.96394\t\r\n-69.9778\t-32.1062\t6.84908\t\r\n-21.5382\t-69.3478\t12.3445\t\r\n-43.1694\t-31.9836\t6.08872\t\r\n10.4786\t-94.7314\t28.5138\t\r\n68.47\t106.494\t33.2292\t\r\n-55.834\t-44.7244\t11.8756\t\r\n-90.5932\t35.5246\t20.2006\t\r\n-42.9236\t-77.4838\t10.5364\t\r\n58.784\t-6.65676\t23.0884\t\r\n30.7258\t-49.0178\t6.01498\t\r\n-23.5632\t-87.8066\t6.22514\t\r\n-50.58\t-62.8268\t6\t\r\n35.7504\t-30.2686\t9.89758\t\r\n-48.2148\t94.9572\t26.9168\t\r\n29.0574\t108.357\t6.22754\t\r\n-82.3006\t-74.0996\t27.664\t\r\n31.4576\t120.811\t6.45576\t\r\n106.947\t61.002\t26.3522\t\r\n-71.8658\t55.0002\t6.81826\t\r\n-14.8019\t95.3308\t6.4983\t\r\n-87.6702\t-35.6198\t11.1887\t\r\n39.751\t-56.9514\t6.00168\t\r\n-1.16644\t108.714\t12.6072\t\r\n42.0084\t-44.884\t6.0011\t\r\n-115.571\t-43.2198\t17.7283\t\r\n-10.0822\t-128.608\t11.1144\t\r\n-72.6896\t69.6884\t7.89294\t\r\n39.1888\t-68.9426\t6.0027\t\r\n42.1076\t-80.6828\t6.09486\t\r\n-59.1878\t-102.758\t7.0319\t\r\n-99.9152\t88.4796\t25.1878\t\r\n-117.585\t54.717\t12.919\t\r\n50.7834\t-36.2758\t6.29124\t\r\n53.196\t-63.5894\t8.99256\t\r\n-59.0672\t-116.049\t6.25942\t\r\n-113.225\t21.0036\t6.6893\t\r\n-72.514\t-107.455\t7.09802\t\r\n81.1576\t23.6564\t6.0266\t\r\n69.0202\t-52.9854\t10.0561\t\r\n"},function(t,e,r){"use strict";r.r(e),e.default="DISK version 1\r\n165.194\r\n80\r\n9.3735\t-12.4178\t6.27006\t\r\n-5.8237\t-12.4178\t8.92714\t\r\n5.0642\t4.52748\t11.2146\t\r\n19.732\t-5.17282\t6.3707\t\r\n22.065\t-19.7402\t8.38232\t\r\n-17.638\t4.23342\t11.4895\t\r\n28.4794\t9.0351\t10.3141\t\r\n-6.29568\t40.1366\t26.1626\t\r\n4.94784\t-28.6442\t10.549\t\r\n24.7206\t-40.4148\t12.4621\t\r\n-13.7916\t-27.6006\t8.21952\t\r\n4.66372\t-48.2688\t9.07774\t\r\n26.8472\t28.308\t9.02782\t\r\n47.1316\t64.7116\t32.6456\t\r\n-50.818\t16.9397\t24.0402\t\r\n-40.5108\t48.359\t9.02658\t\r\n-21.3986\t-13.5519\t6.68908\t\r\n-32.476\t-7.04808\t6.15642\t\r\n-55.8476\t46.9372\t6.37608\t\r\n-67.2374\t42.0956\t6\t\r\n-83.7048\t33.276\t12.6806\t\r\n8.68184\t68.5994\t6.00028\t\r\n49.681\t6.022\t11.1004\t\r\n-44.1666\t-13.6611\t7.275\t\r\n52.8536\t23.1696\t6.33832\t\r\n42.1762\t-57.4146\t11.9038\t\r\n-55.1308\t72.4974\t19.194\t\r\n57.6714\t-46.761\t6.90062\t\r\n64.823\t-63.8734\t11.646\t\r\n-100.741\t15.6107\t11.8612\t\r\n-88.7814\t2.32688\t6.0134\t\r\n63.7054\t29.533\t6.24162\t\r\n-117.79\t47.408\t24.2184\t\r\n23.8208\t-59.4158\t6.56036\t\r\n-13.86\t-41.821\t6.00094\t\r\n-32.4076\t61.2196\t6.17392\t\r\n-79.459\t65.7316\t6.0575\t\r\n-93.5314\t65.579\t6.09124\t\r\n-21.4176\t79.6272\t15.2648\t\r\n-72.2516\t53.2548\t6.23396\t\r\n63.8314\t17.0736\t6.21848\t\r\n76.4644\t36.2916\t8.19688\t\r\n-100.014\t-2.4143\t6.17848\t\r\n87.5072\t-10.6446\t30.235\t\r\n59.1468\t-81.9928\t7.3417\t\r\n59.7186\t-34.0134\t6.01032\t\r\n-38.585\t-32.6254\t7.5469\t\r\n-11.1638\t-56.1946\t8.62338\t\r\n52.3938\t-23.3174\t6.9532\t\r\n-81.8676\t80.2284\t8.63802\t\r\n-0.837974\t-66.9508\t6.28702\t\r\n-51\t-25.7744\t6.63284\t\r\n70.4678\t-43.0894\t6.41214\t\r\n-112.734\t1.04732\t7.00452\t\r\n-23.6042\t-70.8294\t10.5844\t\r\n11.723\t80.2176\t6.00944\t\r\n-57.5566\t-14.7871\t6.16222\t\r\n79.2182\t-111.544\t28.3816\t\r\n-120.854\t14.0353\t8.3126\t\r\n12.4704\t113.072\t26.8538\t\r\n113.052\t42.751\t28.9566\t\r\n79.6706\t-52.7318\t6.917\t\r\n46.9244\t-11.5704\t6.0048\t\r\n-88.8798\t-9.70646\t6.02034\t\r\n-103.223\t77.9878\t9.65382\t\r\n-72.4656\t101.067\t14.2232\t\r\n-38.8858\t91.756\t6.00112\t\r\n76.9042\t-77.0266\t6.21356\t\r\n-125.643\t-1.77456\t6.20904\t\r\n-70.665\t-29.2144\t13.3308\t\r\n-69.0064\t-9.50686\t6.44646\t\r\n-133.383\t21.3156\t6.1782\t\r\n52.2258\t121.129\t13.7099\t\r\n-78.9138\t-46.8464\t6.13532\t\r\n-29.1378\t100.896\t7.36164\t\r\n-42.2892\t103.266\t6.0017\t\r\n118.449\t8.2133\t6.00028\t\r\n-125.272\t84.0974\t13.2261\t\r\n82.3376\t-66.0802\t6.0072\t\r\n91.0326\t-76.9536\t7.9151\t\r\n"},function(t,e,r){"use strict";r.r(e),e.default="DISK version 1\r\n185.337\r\n33\r\n-15.2575\t-27.1104\t15.3536\t\r\n3.13284\t-48.2594\t12.6728\t\r\n4.18596\t-1.16633\t17.0677\t\r\n-31.2494\t2.83296\t18.5926\t\r\n-26.5832\t-59.7372\t19.183\t\r\n-43.089\t-32.1832\t12.9365\t\r\n19.1909\t-72.7696\t16.6294\t\r\n-56.5954\t-12.429\t10.9937\t\r\n43.7102\t-65.4534\t8.95818\t\r\n63.061\t-52.0396\t14.5872\t\r\n-67.429\t15.8489\t19.2885\t\r\n91.6198\t-67.4464\t17.8625\t\r\n-54.6148\t-51.919\t9.91846\t\r\n88.0654\t-103.856\t18.7202\t\r\n88.45\t-31.914\t17.811\t\r\n-38.7004\t37.0236\t16.4004\t\r\n-99.8386\t35.38\t18.5512\t\r\n-83.2754\t-50.9554\t18.7583\t\r\n-68.5578\t51.9822\t16.8623\t\r\n-97.4312\t72.2914\t18.4385\t\r\n110.581\t-87.0236\t9.3915\t\r\n-63.609\t86.8988\t18.4033\t\r\n124.515\t-111.124\t18.4469\t\r\n-93.089\t108.786\t18.3131\t\r\n-65.8306\t114.819\t9.60522\t\r\n102.307\t-128.531\t9.76986\t\r\n-126.443\t94.3738\t18.0213\t\r\n58.6206\t-25.0072\t12.8075\t\r\n-44.829\t110.579\t11.82\t\r\n74.4236\t-134.903\t15.1914\t\r\n-75.9216\t136.125\t13.9694\t\r\n135.698\t-86.3152\t8.76592\t\r\n-15.9913\t123.604\t19.8226\t\r\n"},function(t,e,r){"use strict";r.r(e),e.default="DISK version 1\r\n142.571\r\n72\r\n20\t-25.9808\t10\t\r\n0\t-25.9808\t10\t\r\n-10\t-43.3012\t10\t\r\n30\t-43.3012\t10\t\r\n-1.77636e-15\t-60.6218\t10\t\r\n20\t-60.6218\t10\t\r\n-20\t-60.6218\t10\t\r\n-10\t-77.9422\t10\t\r\n-30\t-43.3012\t10\t\r\n10\t-8.66026\t10\t\r\n-30\t-77.9422\t10\t\r\n-40\t-25.9808\t10\t\r\n10\t-77.9422\t10\t\r\n-3.55272e-15\t8.66026\t10\t\r\n-20\t8.66026\t10\t\r\n-50\t-8.66026\t10\t\r\n50\t-43.3012\t10\t\r\n10\t25.9808\t10\t\r\n-20\t-95.2628\t10\t\r\n-40\t8.66026\t10\t\r\n50\t-8.66026\t10\t\r\n60\t-25.9808\t10\t\r\n-30\t25.9808\t10\t\r\n70\t-43.3012\t10\t\r\n-40\t-95.2628\t10\t\r\n30\t25.9808\t10\t\r\n-20\t43.3012\t10\t\r\n-5.32908e-15\t-95.2628\t10\t\r\n80\t-25.9808\t10\t\r\n70\t-8.66026\t10\t\r\n60\t8.66026\t10\t\r\n-50\t-77.9422\t10\t\r\n-7.10542e-15\t43.3012\t10\t\r\n-60\t-25.9808\t10\t\r\n50\t-77.9422\t10\t\r\n20\t43.3012\t10\t\r\n-70\t-8.66026\t10\t\r\n-50\t-43.3012\t10\t\r\n20\t-95.2628\t10\t\r\n-30\t60.6218\t10\t\r\n-70\t-43.3012\t10\t\r\n-80\t-25.9808\t10\t\r\n80\t8.66026\t10\t\r\n10\t60.6218\t10\t\r\n-80\t-60.6218\t10\t\r\n-1.06581e-14\t77.9422\t10\t\r\n-60\t-95.2628\t10\t\r\n-90\t-43.3012\t10\t\r\n90\t-43.3012\t10\t\r\n-50\t-112.583\t10\t\r\n80\t-60.6218\t10\t\r\n100\t-25.9808\t10\t\r\n110\t-43.3012\t10\t\r\n50\t25.9808\t10\t\r\n70\t-77.9422\t10\t\r\n-70\t-77.9422\t10\t\r\n-50\t25.9808\t10\t\r\n40\t43.3012\t10\t\r\n100\t-60.6218\t10\t\r\n60\t43.3012\t10\t\r\n50\t60.6218\t10\t\r\n90\t-77.9422\t10\t\r\n-40\t77.9422\t10\t\r\n-30\t95.2628\t10\t\r\n-10\t95.2628\t10\t\r\n-20\t112.583\t10\t\r\n-90\t-8.66026\t10\t\r\n-110\t-43.3012\t10\t\r\n-40\t112.583\t10\t\r\n-50\t60.6218\t10\t\r\n-70\t-112.583\t10\t\r\n10\t95.2628\t10\t\r\n"},function(t,e,r){"use strict";r.r(e),e.default="DISK version 1\r\n83.7878\r\n53\r\n12.1729\t-21.8372\t6\t\r\n-33.8272\t-21.8372\t40\t\r\n14.4578\t-4.78044\t11.209\t\r\n1.96622\t7.05642\t6\t\r\n-6.72476\t15.3309\t6.00002\t\r\n10.6235\t-33.7582\t6.0214\t\r\n23.8758\t-19.1836\t6\t\r\n4.04784\t20.6188\t6.00038\t\r\n24.6346\t9.40724\t6.2511\t\r\n-6.04012\t27.5524\t6.24066\t\r\n24.1656\t-32.7394\t7.55892\t\r\n16.7584\t-44.0964\t6\t\r\n31.3388\t-9.41176\t6.29576\t\r\n-28.9254\t23.9038\t6.00288\t\r\n-43.3506\t25.761\t8.54152\t\r\n-56.4576\t18.6408\t6.3745\t\r\n28.6728\t-45.5272\t6\t\r\n-16.9657\t33.073\t6.0004\t\r\n-66.1254\t10.9168\t6\t\r\n34.6956\t2.41692\t6\t\r\n20.2152\t28.8984\t12.1638\t\r\n36.5144\t17.1492\t7.92872\t\r\n45.8588\t6.81992\t6.00016\t\r\n12.9631\t-55.4808\t6.00038\t\r\n44.1144\t-5.11088\t6.05748\t\r\n9.41212\t56.3554\t17.342\t\r\n38.2606\t30.968\t6\t\r\n35.7542\t-20.8874\t6\t\r\n37.7984\t-32.7872\t6.07408\t\r\n55.2948\t-0.594784\t6.00042\t\r\n-2.69878\t-55.7076\t6.00204\t\r\n-13.0778\t50.1026\t6.00098\t\r\n-12.8151\t-63.8862\t7.00678\t\r\n-28.6302\t35.9066\t6.0034\t\r\n52.0602\t-19.4846\t10.3662\t\r\n5.27374\t-65.2764\t6.45278\t\r\n-56.913\t31.007\t6\t\r\n-29.272\t52.2296\t10.3323\t\r\n40.6308\t-44.5244\t6.00002\t\r\n-39.9944\t39.91\t6.00002\t\r\n66.436\t3.86402\t6\t\r\n35.5204\t-55.3822\t6.00038\t\r\n-25.4278\t-67.0638\t6\t\r\n49.9074\t20.975\t6\t\r\n50.0972\t32.9798\t6.00622\t\r\n-37.411\t-67.6972\t6.00002\t\r\n47.4806\t-54.3794\t6.00174\t\r\n-68.1398\t22.7592\t6.01242\t\r\n42.3674\t-65.2374\t6\t\r\n-13.4695\t62.4296\t6.33216\t\r\n64.9004\t-8.4465\t6.40594\t\r\n60.8642\t26.7992\t6.40866\t\r\n68.1522\t15.7407\t6\t\r\n"},function(t,e,r){"use strict";r.r(e),e.default="DISK version 1\r\n182.836\r\n27\r\n1.9518\t-40.6093\t18.3474\r\n-9.6741\t-86.4797\t28.9734\r\n-12.1182\t-6.62117\t18.4379\r\n32.8074\t-8.04942\t26.5103\r\n39.1475\t-63.1402\t25.1401\r\n76.8618\t-32.1212\t23.6918\r\n2.47782\t39.0565\t29.5151\r\n77.0942\t14.9734\t23.4034\r\n-47.4266\t18.0442\t24.6326\r\n40.6324\t-119.418\t31.157\r\n53.3178\t56.1073\t24.1079\r\n115.439\t-8.48755\t21.5491\r\n-42.738\t65.1171\t22.6732\r\n-62.4986\t-91.4633\t24.0857\r\n-82.4627\t47.1592\t20.9219\r\n-94.3312\t-7.99792\t29.0165\r\n105.444\t57.9115\t28.0493\r\n-1.48101\t99.4299\t30.9879\r\n152.075\t25.752\t28.5961\r\n79.9736\t-84.951\t21.1468\r\n56.0443\t107.203\t27.0602\r\n25.2908\t142.821\t19.9978\r\n-123.31\t33.9857\t21.9973\r\n-152.009\t-7.76035\t28.6619\r\n-36.645\t-135.682\t27.1367\r\n114.853\t-58.5583\t22.5925\r\n92.1145\t-124.912\t20.6173\r\n"},function(t,e,r){"use strict";r.r(e),e.default="DISK version 1\r\n55.0\r\n3\r\n-20.0\t-15.0\t10.0\r\n-20.0\t15.0\t20.0\r\n20.0\t-15.0\t30.0\r\n"},function(t,e,r){"use strict";r.r(e),e.default="DISK version 1\r\n126.074\r\n73\r\n14.4281\t53.578\t18.9519\t\r\n-10.5268\t53.578\t6.0029\t\r\n-7.74654\t41.6852\t6.21058\t\r\n12.0684\t28.5738\t6.16336\t\r\n-25.3298\t35.0226\t6.01708\t\r\n11.3393\t6.9364\t15.4863\t\r\n-7.67674\t65.3158\t6.07608\t\r\n34.6758\t7.66774\t7.8617\t\r\n40.6\t44.7156\t8.67976\t\r\n-23.234\t58.5242\t7.63312\t\r\n-31.6082\t15.5912\t14.4034\t\r\n52.7078\t17.3423\t12.6018\t\r\n-31.8684\t45.7074\t6.50966\t\r\n11.9397\t78.711\t6.30396\t\r\n38.7462\t59.311\t6.03282\t\r\n-36.803\t57.2026\t6\t\r\n-44.2136\t47.7582\t6.0047\t\r\n63.8106\t42.2432\t14.6622\t\r\n58.2818\t-0.48312\t6.07476\t\r\n9.02358\t-25.4778\t17.0105\t\r\n-51.4758\t38.047\t6.12166\t\r\n68.014\t6.71656\t6.03102\t\r\n-48.6922\t58.908\t6.01082\t\r\n70.574\t22.6738\t6.04294\t\r\n-66.6582\t50.7942\t13.7024\t\r\n82.0696\t29.7554\t7.45878\t\r\n-55.1184\t22.2968\t10.0444\t\r\n51.864\t-10.7112\t6.00008\t\r\n-24.5386\t73.7196\t7.61824\t\r\n-18.9994\t86.8922\t6.67154\t\r\n-12.1627\t-2.94398\t10.0081\t\r\n47.262\t-23.686\t7.76674\t\r\n-41.2544\t68.389\t6.03958\t\r\n64.0396\t-11.3128\t6.19036\t\r\n-56.7438\t67.8204\t6.00008\t\r\n84.4876\t43.0254\t6.0296\t\r\n-35.2452\t-14.3152\t15.7233\t\r\n50.7542\t58.282\t6.01912\t\r\n43.1896\t-36.839\t6.00218\t\r\n75.0862\t-4.17968\t6.95912\t\r\n55.0674\t-35.0396\t6.01106\t\r\n33.2442\t70.145\t6.11834\t\r\n27.9262\t-40.7832\t7.31152\t\r\n64.632\t67.5744\t10.6824\t\r\n-49.7798\t87.898\t15.2508\t\r\n-13.0405\t-18.9321\t6.00402\t\r\n-62.1234\t7.84654\t6.01414\t\r\n-13.331\t-30.9326\t6\t\r\n-15.1348\t99.0474\t6.08314\t\r\n74.7504\t-17.1352\t6.0007\t\r\n80.3722\t57.6234\t7.93952\t\r\n61.8154\t-24.1566\t6.79434\t\r\n4.29834\t-47.998\t6.00004\t\r\n-29.4426\t94.0766\t6.0043\t\r\n13.389\t90.932\t6.00278\t\r\n-7.70822\t-42.4808\t6.84444\t\r\n85.017\t76.625\t11.6215\t\r\n11.1025\t-62.7824\t10.2749\t\r\n39.9562\t80.999\t6.64324\t\r\n69.0094\t-46.7534\t12.1987\t\r\n-68.8036\t70.806\t6.42392\t\r\n27.3104\t80.7178\t6.00578\t\r\n37.5642\t-54.1062\t9.13212\t\r\n-5.23986\t-70.3628\t7.73998\t\r\n41.0426\t94.8944\t7.29458\t\r\n32.5696\t-80.0136\t17.2524\t\r\n-80.174\t65.373\t6.17762\t\r\n9.2846\t-79.01\t6.05422\t\r\n-66.4368\t-3.36654\t6\t\r\n52.0788\t-58.3966\t6.00348\t\r\n-90.046\t52.842\t9.77498\t\r\n93.8132\t61.3468\t6.00782\t\r\n-5.68638\t-91.6144\t13.5162\t\r\n"},function(t,e,r){"use strict";r.r(e),e.default="DISK version 1\r\n201.784\r\n35\r\n8.01372\t-2.98592\t11.8126\t\r\n-42.9056\t-2.98592\t39.1066\t\r\n11.1726\t-42.6034\t27.9306\t\r\n-79.471\t-30.8914\t6.89064\t\r\n-102.206\t-14.2887\t21.261\t\r\n33.4124\t0.0984462\t13.7726\t\r\n-76.2798\t-93.695\t11.3239\t\r\n-58.9744\t-123.403\t23.057\t\r\n16.2623\t-101.968\t31.6514\t\r\n44.3898\t-66.9578\t13.258\t\r\n92.0668\t-77.436\t35.557\t\r\n-30.025\t-111.263\t8.3349\t\r\n-90.1556\t-40.0608\t7.18908\t\r\n-18.0399\t-123.798\t9.00776\t\r\n60.5432\t15.3027\t17.3279\t\r\n62.2418\t54.3102\t21.7164\t\r\n-146.985\t-47.8566\t34.703\t\r\n-105.209\t-99.2242\t18.1291\t\r\n-113.436\t-72.1918\t6.74206\t\r\n-131.364\t5.12146\t13.7672\t\r\n31.3178\t99.4618\t33.0098\t\r\n1.10735\t74.0118\t6.49182\t\r\n115.485\t70.1372\t33.8294\t\r\n72.4256\t84.96\t10.581\t\r\n-37.6044\t59.7678\t23.8706\t\r\n-61.233\t39.3152\t6.99402\t\r\n111.135\t28.77\t7.7659\t\r\n-59.566\t-169.026\t22.5694\t\r\n128.174\t-52.735\t8.19036\t\r\n-79.1306\t-146.28\t7.43292\t\r\n-28.8126\t97.7898\t15.1547\t\r\n-15.1152\t80.6276\t6.8035\t\r\n-19.1816\t151.844\t39.751\t\r\n72.0808\t103.49\t7.95172\t\r\n154.647\t-75.9804\t27.0404\t\r\n"},function(t,e,r){"use strict";r.r(e),e.default="DISK version 1\r\n237.372\r\n51\r\n-33.384\t16.2532\t35.7658\t\r\n3.39568\t49.5662\t13.8578\t\r\n-23.8772\t74.0036\t22.762\t\r\n-43.9596\t-26.681\t8.45176\t\r\n-31.5672\t-37.3088\t6.01942\t\r\n-47.1502\t-71.9364\t31.953\t\r\n-56.2232\t-18.8394\t6.10462\t\r\n-56.1348\t-34.8474\t6.20862\t\r\n7.37598\t70.8896\t7.83398\t\r\n-137.053\t107.579\t30.927\t\r\n-69.0192\t-39.2216\t7.39804\t\r\n63.5782\t-35.2868\t28.9014\t\r\n-65.9228\t-26.1462\t6.03906\t\r\n-78.0006\t-28.8338\t6.33416\t\r\n-44.0182\t125.312\t32.3582\t\r\n-77.9712\t-49.4532\t6.19696\t\r\n-67.4582\t-14.1256\t6.07916\t\r\n-117.004\t-70.0284\t37.927\t\r\n-34.1916\t-124.197\t21.8898\t\r\n36.0482\t-64.6546\t11.3522\t\r\n-91.6346\t149.995\t21.2754\t\r\n3.95176\t-149.082\t23.6534\t\r\n111.956\t-11.8413\t24.8582\t\r\n48.6354\t-85.098\t12.6554\t\r\n55.2634\t-132.954\t30.1332\t\r\n-85.1774\t-39.2374\t6.3047\t\r\n-79.1592\t-92.3302\t6.00052\t\r\n126.028\t15.6216\t6.00038\t\r\n72.37\t-76.0098\t12.7598\t\r\n-62.5698\t164.961\t11.416\t\r\n149.603\t9.418\t18.3768\t\r\n-129.603\t154.936\t17.0131\t\r\n147.565\t-20.735\t11.8449\t\r\n104.22\t-50.3844\t14.4537\t\r\n-102.417\t-27.9156\t6.00124\t\r\n-110.554\t186.915\t20.2094\t\r\n-43.4122\t-176.2\t30.9244\t\r\n131.671\t27.187\t6.86796\t\r\n82.511\t-94.7282\t8.52916\t\r\n-78.3804\t175.859\t7.78684\t\r\n121.772\t-119.266\t37.769\t\r\n86.8924\t-61.2744\t6.01144\t\r\n90.5124\t-82.137\t6.38936\t\r\n-84.3686\t188.291\t6.01186\t\r\n-96.6468\t-109.125\t6.15242\t\r\n-66.2632\t-117.528\t6.32496\t\r\n-14.242\t101.115\t6.01036\t\r\n-114.387\t-26.0688\t6.11048\t\r\n94.7282\t-70.4382\t6.04572\t\r\n90.7472\t-166.199\t18.4915\t\r\n-65.4754\t-135.062\t11.2271\t\r\n"},function(t,e,r){"use strict";r.r(e),e.default="#version 300 es\r\n\r\n// Input vertex data, different for all executions of this shader.\r\nlayout(location = 0) in vec3 a_vertex;\r\nlayout(location = 3) in vec3 a_vertex1;\r\n// Values that stay constant for the whole mesh.\r\nuniform mat4 model_view_projection_matrix;\r\nuniform float tween_factor;\r\nuniform bool tween_enabled;\r\n\r\nvoid main()\r\n{\r\n    vec3 new_vertex = a_vertex;\r\n\tif(tween_enabled)\r\n        new_vertex =  mix(a_vertex, a_vertex1, tween_factor);\r\n\r\n\tgl_Position =  model_view_projection_matrix * vec4(new_vertex, 1.0);\r\n}\r\n\r\n\r\n"},function(t,e,r){"use strict";r.r(e),e.default="#version 300 es\r\nprecision highp  float;\r\n// Ouput data\r\nlayout(location = 0) out float fragmentdepth;\r\n\r\nvoid main(){\r\n    // Not really needed, OpenGL does it anyway\r\n    fragmentdepth = gl_FragCoord.z;\r\n}"},function(t,e,r){"use strict";r.r(e),e.default="#version 300 es\r\n\r\n// Input vertex data, different for all executions of this shader.\r\nlayout(location = 0) in vec3 a_vertex;\r\n\r\n// Output data ; will be interpolated for each fragment.\r\nout vec2 tex_coord;\r\n\r\nvoid main()\r\n{\r\n\tgl_Position =  vec4(a_vertex,1);\r\n\ttex_coord = (a_vertex.xy + vec2(1.0,1.0)) / 2.0;\r\n}\r\n\r\n"},function(t,e,r){"use strict";r.r(e),e.default="#version 300 es\r\nprecision mediump  float;\r\n// Ouput data\r\nlayout(location = 0) out vec4 color;\r\n\r\nuniform sampler2D texture1;\r\n\r\nin vec2 tex_coord;\r\n\r\nvoid main()\r\n{\r\n\tfloat depth = texture(texture1, tex_coord).r;\r\n\tcolor = vec4(depth,depth,depth,1.0);\r\n}"},function(t,e,r){"use strict";r.r(e),e.default="#version 300 es\r\n\r\nuniform mat4 model_matrix;\r\nuniform mat4 view_matrix;\r\nuniform mat4 model_view_projection_matrix;\r\nuniform vec3 camera_pos;\r\n\r\nuniform bool tween_enabled;\r\nuniform float tween_factor;\r\n\r\nlayout (location = 0) in vec3 a_vertex;\r\nlayout (location = 1) in vec2 a_tex_coord;\r\nlayout (location = 2) in vec3 a_normal;\r\nlayout (location = 3) in vec3 a_vertex1;\r\nlayout (location = 4) in vec3 a_normal1;\r\n\r\nout vec3 position;\r\nout vec2 tex_coord;\r\nout vec3 normal;\r\nout vec3 to_camera;\r\n\r\nvoid main()\r\n{\r\n    vec3 new_normal = a_normal;\r\n    vec3 new_vertex = a_vertex;\r\n    if(tween_enabled)\r\n\t{\r\n\t\tnew_normal = mix(a_normal,a_normal1,tween_factor);      \r\n        new_vertex = mix(a_vertex,a_vertex1,tween_factor);\r\n        \r\n    }\r\n\t\r\n\tvec4 world_position = model_matrix * vec4(new_vertex, 1.0);\r\n\r\n\tposition   = world_position.xyz;\r\n\ttex_coord = a_tex_coord;\r\n\tnormal    = mat3(transpose(inverse(model_matrix))) * new_normal;\r\n\tto_camera  = normalize(camera_pos - world_position.xyz);\r\n\r\n\tgl_Position = model_view_projection_matrix * vec4(new_vertex, 1.0);\r\n}\r\n"},function(t,e,r){"use strict";r.r(e),e.default="#version 300 es\r\nprecision highp  float;\r\n\r\nconst int LIGHT_COUNT = 8;\r\n\r\nstruct Material {\r\n\r\n    //Textures\r\n    bool is_texture_active[6];\r\n    sampler2D transparency_texture;\r\n    sampler2D emission_texture;\r\n    sampler2D ambient_texture;\r\n    sampler2D diffuse_texture;\r\n    sampler2D specular_texture;\r\n    sampler2D shininess_texture;\r\n            \r\n    //Colors\r\n    float transparency;\r\n    vec3 emission_colour;\r\n    vec3 ambient_colour;\r\n    vec3 diffuse_colour;\r\n    vec3 specular_colour;\r\n    float shininess;\r\n    int transparency_channel;\r\n    int shininess_channel;\r\n\r\n}; \r\nuniform Material material;\r\n\r\n\r\nstruct Light{\r\n    bool is_enabled;\r\n    vec4 position;\r\n    vec3 ambient;\r\n    vec3 diffuse;\r\n    vec3 specular;\r\n    vec3 attenuation;\r\n};\r\n\r\nuniform Light lights[8];\r\n\r\nin vec3 position;\r\nin vec2 tex_coord;\r\nin vec3 normal;\r\nin vec3 to_camera;\r\n\r\nout vec4 FragColor;\r\n\r\nvoid main()\r\n{\r\n\r\n\r\n\tvec3 normalized_normal    = normalize(normal);\r\n\tvec3 normalized_to_camera = normalize(to_camera);\r\n\r\n\tfloat transparency_on_texture = texture(material.transparency_texture, tex_coord)[material.transparency_channel];\r\n\tvec3      emission_on_texture = texture(    material.emission_texture, tex_coord).rgb;\r\n\tvec3       ambient_on_texture = texture(     material.ambient_texture, tex_coord).rgb;\r\n\tvec3       diffuse_on_texture = texture(     material.diffuse_texture, tex_coord).rgb;\r\n\tvec3      specular_on_texture = texture(    material.specular_texture, tex_coord).rgb;\r\n\tfloat    shininess_on_texture = texture(   material.shininess_texture, tex_coord)[material.shininess_channel];\r\n\r\n\tfloat transparency2    = material.transparency;\r\n\tvec3  emission_surface = material.emission_colour;\r\n\tvec3   ambient_surface =  material.ambient_colour;\r\n\tvec3   diffuse_surface =  material.diffuse_colour;\r\n\tvec3  specular_surface = material.specular_colour;\r\n\tfloat shininess2       = material.shininess;\r\n\r\n\tif(material.is_texture_active[0]) transparency2    *= transparency_on_texture;\r\n\tif(material.is_texture_active[1]) emission_surface *=     emission_on_texture;\r\n\tif(material.is_texture_active[2])  ambient_surface *=      ambient_on_texture;\r\n\tif(material.is_texture_active[3])  diffuse_surface *=      diffuse_on_texture;\r\n\tif(material.is_texture_active[4]) specular_surface *=     specular_on_texture;\r\n\tif(material.is_texture_active[5]) shininess2       *=    shininess_on_texture;\r\n\r\n\tvec3 basic_colour      = emission_surface;\r\n\tvec4 separate_specular = vec4(0.0, 0.0, 0.0, 0.0);\r\n\r\n\t// calculate the effects of each light\r\n\r\n\tfor(int i = 0; i < LIGHT_COUNT; i++)\r\n\t\tif(lights[i].is_enabled)\r\n\t\t{\r\n\t\t\tvec3 light_direction_from;\r\n\t\t\tfloat attenuation = 1.0;\r\n\t\t\tif(lights[i].position.w == 0.0)\r\n\t\t\t\tlight_direction_from = normalize(lights[i].position.xyz);\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tvec3 offset_position = lights[i].position.xyz - position;\r\n\t\t\t\tlight_direction_from = normalize(offset_position);\r\n\t\t\t\tfloat light_distance = length(offset_position);\r\n\t\t\t\tattenuation = 1.0 / (lights[i].attenuation.x +\r\n\t\t\t\t                     lights[i].attenuation.y * light_distance +\r\n\t\t\t\t                     lights[i].attenuation.z * light_distance * light_distance);\r\n\t\t\t}\r\n\r\n\t\t\t//  Phong-Blinn shading\r\n\r\n\t\t\tvec3 half_angle_direction = normalize(normalized_to_camera + light_direction_from);\r\n            \r\n            float ambient_intensity = attenuation;\r\n\t\t\tfloat  diffuse_intensity = attenuation *     max(0.0, dot(normalized_normal, light_direction_from));\r\n\t\t\tfloat specular_intensity = attenuation * pow(max(0.0, dot(normalized_normal, half_angle_direction)), shininess2);\r\n\r\n\t\t\tbasic_colour += ambient_surface * lights[i].ambient * ambient_intensity +\r\n\t\t\t                diffuse_surface * lights[i].diffuse * diffuse_intensity + \r\n                            specular_surface * lights[i].specular * specular_intensity;\r\n\t\t}\r\n\r\n\t// calculate the final colour\r\n\r\n\tif(separate_specular.a > 1.0)\r\n\t\tseparate_specular.a = 1.0;\r\n\r\n\tfloat basic_transparency = transparency2 * (1.0 - separate_specular.a);\r\n\r\n\tif(basic_transparency + separate_specular.a <= 0.0)\r\n\t\tdiscard;\r\n\r\n\tFragColor = vec4(basic_colour, basic_transparency) + separate_specular;\r\n}\r\n"},function(t,e,r){"use strict";r.r(e),e.default="#version 300 es\r\nprecision highp  float;\r\n\r\nconst int LIGHT_COUNT = 8;\r\n\r\nlayout (location = 0) in vec3 a_vertex;\r\nlayout (location = 1) in vec2 a_tex_coord;\r\nlayout (location = 2) in vec3 a_normal;\r\nlayout (location = 3) in vec3 a_vertex1;\r\nlayout (location = 4) in vec3 a_normal1;\r\n\r\nuniform mat4 model_matrix;\r\nuniform mat4 view_matrix;\r\nuniform mat4 model_view_projection_matrix;\r\nuniform mat4 shadow_map_space_matrix;\r\nuniform vec3 camera_pos;\r\nuniform float shadow_distance;\r\n\r\nuniform bool tween_enabled;\r\nuniform float tween_factor;\r\n\r\nstruct Light{\r\n    bool is_enabled;\r\n    vec4 position;\r\n    vec3 ambient;\r\n    vec3 diffuse;\r\n    vec3 specular;\r\n    vec3 attenuation;\r\n};\r\n\r\nuniform Light lights[LIGHT_COUNT];\r\n\r\nout vec3 position;\r\nout vec2 tex_coord;\r\nout vec3 normal;\r\nout vec3 to_camera;\r\nout vec4 shadow_coord;\r\n\r\nconst float transition_distance = 2.0;\r\n\r\nvoid main()\r\n{\r\n    vec3 new_normal = a_normal;\r\n    vec3 new_vertex = a_vertex;\r\n    if(tween_enabled)\r\n\t{\r\n\t\tnew_normal = mix(a_normal,a_normal1,tween_factor);      \r\n        new_vertex = mix(a_vertex,a_vertex1,tween_factor);\r\n    }\r\n\t\r\n\tvec4 world_position = model_matrix * vec4(new_vertex, 1.0);\r\n\r\n\tposition   = world_position.xyz;\r\n\ttex_coord = a_tex_coord;\r\n\tnormal    = normalize(mat3(transpose(inverse(model_matrix))) * new_normal);\r\n\tto_camera  = normalize(camera_pos - world_position.xyz);\r\n\r\n\tgl_Position = model_view_projection_matrix * vec4(new_vertex, 1.0);\r\n\t\r\n    //(OUT) Calculate world space coords that map this vertex to the shadow_map\r\n    //The vertex may not appear in the shadow_map and will have no shadow\r\n\r\n    vec3 toLight = normalize(lights[0].position.xyz);\r\n    float cos_light_angle = dot(toLight, normal);\r\n    float slope_scale = clamp(1.0 - cos_light_angle, 0.0, 1.0);\r\n    float normal_offset_scale =  slope_scale * 0.4;\r\n    \r\n    vec4 shadow_offset = vec4(normal*normal_offset_scale,0.0);\r\n    \r\n    shadow_coord = shadow_map_space_matrix * (world_position + shadow_offset);\r\n    vec4 shadow_coord_xy = shadow_map_space_matrix * (world_position + shadow_offset);\r\n\r\n    //shadow_coord.xy = shadow_coord_xy.xy;\r\n    \t\r\n    //Shaodw_coord.w will be used to fade in and out shadows softly when they are far from camera\r\n    //vec4 to_camera_view_space = view_matrix * world_position;\r\n    float distance1 = length(camera_pos - world_position.xyz);\r\n\r\n    distance1 = distance1 - (shadow_distance - transition_distance);\r\n    distance1 = distance1 / transition_distance;\r\n    shadow_coord.w = clamp(1.0 - distance1, 0.0, 1.0);\r\n\r\n}\r\n"},function(t,e,r){"use strict";r.r(e),e.default="#version 300 es\r\nprecision highp  float;\r\nprecision lowp sampler2DShadow;\r\n\r\nconst int LIGHT_COUNT = 8;\r\n\r\nstruct Material {\r\n\r\n    //Textures\r\n    bool is_texture_active[6];\r\n    sampler2D transparency_texture;\r\n    sampler2D emission_texture;\r\n    sampler2D ambient_texture;\r\n    sampler2D diffuse_texture;\r\n    sampler2D specular_texture;\r\n    sampler2D shininess_texture;\r\n            \r\n    //Colors\r\n    float transparency;\r\n    vec3 emission_colour;\r\n    vec3 ambient_colour;\r\n    vec3 diffuse_colour;\r\n    vec3 specular_colour;\r\n    float shininess;\r\n    int transparency_channel;\r\n    int shininess_channel;\r\n\r\n}; \r\nuniform Material material;\r\nuniform sampler2DShadow shadow_map;\r\nuniform float shadow_map_size;\r\n\r\nstruct Light{\r\n    bool is_enabled;\r\n    vec4 position;\r\n    vec3 ambient;\r\n    vec3 diffuse;\r\n    vec3 specular;\r\n    vec3 attenuation;\r\n};\r\n\r\nuniform Light lights[LIGHT_COUNT];\r\n\r\nin vec3 position;\r\nin vec2 tex_coord;\r\nin vec3 normal;\r\nin vec3 to_camera;\r\nin vec4 shadow_coord;\r\n\r\nout vec4 FragColor;\r\n\r\nvoid main()\r\n{\r\n\tvec3 normalized_normal    = normalize(normal);\r\n\tvec3 normalized_to_camera = normalize(to_camera);\r\n\r\n\t//Objects not in shadow have full light\r\n\tfloat light_factor = 1.0;\r\n\r\n    //16 Samples of Percentage Closer Filtering\r\n    for(float y = -1.5; y <= 1.5; y += 1.0){    \r\n        for(float x = -1.5; x <= 1.5; x += 1.0) {\r\n            float vis = 1.0 - texture(shadow_map, vec3(shadow_coord.xy + vec2(x/shadow_map_size,y/shadow_map_size) ,  (shadow_coord.z)));\r\n\t\t    light_factor -= shadow_coord.w * vis * (1.0/16.0);\r\n        }\r\n    }\r\n\tfloat transparency_on_texture = texture(material.transparency_texture, tex_coord)[material.transparency_channel];\r\n\tvec3      emission_on_texture = texture(    material.emission_texture, tex_coord).rgb;\r\n\tvec3       ambient_on_texture = texture(     material.ambient_texture, tex_coord).rgb;\r\n\tvec3       diffuse_on_texture = texture(     material.diffuse_texture, tex_coord).rgb;\r\n\tvec3      specular_on_texture = texture(    material.specular_texture, tex_coord).rgb;\r\n\tfloat    shininess_on_texture = texture(   material.shininess_texture, tex_coord)[material.shininess_channel];\r\n\r\n\tfloat transparency2    = material.transparency;\r\n\tvec3  emission_surface = material.emission_colour;\r\n\tvec3   ambient_surface =  material.ambient_colour;\r\n\tvec3   diffuse_surface =  material.diffuse_colour;\r\n\tvec3  specular_surface = material.specular_colour;\r\n\tfloat shininess2       = material.shininess;\r\n\r\n\tif(material.is_texture_active[0]) transparency2    *= transparency_on_texture;\r\n\tif(material.is_texture_active[1]) emission_surface *=     emission_on_texture;\r\n\tif(material.is_texture_active[2])  ambient_surface *=      ambient_on_texture;\r\n\tif(material.is_texture_active[3])  diffuse_surface *=      diffuse_on_texture;\r\n\tif(material.is_texture_active[4]) specular_surface *=     specular_on_texture;\r\n\tif(material.is_texture_active[5]) shininess2       *=    shininess_on_texture;\r\n\r\n\tvec3 basic_colour      = emission_surface;\r\n\tvec4 separate_specular = vec4(0.0, 0.0, 0.0, 0.0);\r\n\r\n\t// calculate the effects of each light\r\n\r\n\tfor(int i = 0; i < LIGHT_COUNT; i++)\r\n\t\tif(lights[i].is_enabled)\r\n\t\t{\r\n\t\t\tvec3 light_direction_from;\r\n\t\t\tfloat attenuation = 1.0;\r\n\t\t\tif(lights[i].position.w == 0.0)\r\n\t\t\t\tlight_direction_from = normalize(lights[i].position.xyz);\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tvec3 offset_position = lights[i].position.xyz - position;\r\n\t\t\t\tlight_direction_from = normalize(offset_position);\r\n\t\t\t\tfloat light_distance = length(offset_position);\r\n\t\t\t\tattenuation = 1.0 / (lights[i].attenuation.x +\r\n\t\t\t\t                     lights[i].attenuation.y * light_distance +\r\n\t\t\t\t                     lights[i].attenuation.z * light_distance * light_distance);\r\n\t\t\t}\r\n\r\n\t\t\t//  Phong-Blinn shading\r\n\r\n\t\t\tvec3 half_angle_direction = normalize(normalized_to_camera + light_direction_from);\r\n            \r\n            float ambient_intensity = attenuation;\r\n\t\t\tfloat  diffuse_intensity = light_factor * attenuation *     max(0.0, dot(normalized_normal, light_direction_from));\r\n\t\t\tfloat specular_intensity = light_factor * attenuation * pow(max(0.0, dot(normalized_normal, half_angle_direction)), shininess2);\r\n\r\n\t\t\tbasic_colour += ambient_surface * lights[i].ambient * ambient_intensity +\r\n\t\t\t                diffuse_surface * lights[i].diffuse * diffuse_intensity + \r\n                            specular_surface * lights[i].specular * specular_intensity;\r\n\t\t}\r\n\r\n\t// calculate the final colour\r\n\r\n\tif(separate_specular.a > 1.0)\r\n\t\tseparate_specular.a = 1.0;\r\n\r\n\tfloat basic_transparency = transparency2 * (1.0 - separate_specular.a);\r\n\r\n\tif(basic_transparency + separate_specular.a <= 0.0)\r\n\t\tdiscard;\r\n\r\n\tFragColor = vec4(basic_colour, basic_transparency) + separate_specular;\r\n}\r\n"},function(t,e,r){var i,n;!function(s){var a,o,h,u,l=1e3/60,c=0,d=1,f=0,p=0,m=60,_=60,v=.9,g=500,y=0,w=0,M=0,x=0,b=0,E=!1,A=!1,T=!1,I="object"==typeof window?window:s,R=I.requestAnimationFrame||(u=Date.now(),function(t){return o=Date.now(),h=Math.max(0,l-(o-u)),u=o+h,setTimeout(function(){t(o+h)},h)}),S=I.cancelAnimationFrame||clearTimeout,D=function(){},k=D,L=D,O=D,F=D;function N(t){if(a=R(N),t<f+b)return;let e=t-f;for(p+=e,c+=e*=d,f=t,k(t,e),t>y+g&&(m=v*w*1e3/(t-y)+(1-v)*m,_=v*M*1e3/(t-y)+(1-v)*_,y=t,w=0,M=0),w++,x=0;c>=l;)if(L(l),M++,c-=l,++x>=240){T=!0;break}O(c/l),F(m,_,p,T),T=!1}s.MainLoop={getSimulationTimestep:function(){return l},setSimulationTimestep:function(t){return l=t,this},getFPS:function(){return m},getMaxAllowedFPS:function(){return 1e3/b},setTimeScale:function(t){d=t},setMaxAllowedFPS:function(t){return void 0===t&&(t=1/0),0===t?this.stop():b=1e3/t,this},resetFrameDelta:function(){var t=c;return c=0,t},setBegin:function(t){return k=t||k,this},setUpdate:function(t){return L=t||L,this},setDraw:function(t){return O=t||O,this},setEnd:function(t){return F=t||F,this},start:function(){return A||(A=!0,a=R(function(t){O(1),E=!0,f=t,y=t,w=0,M=0,a=R(N)})),this},stop:function(){return E=!1,A=!1,S(a),this},isRunning:function(){return E}},i=s.MainLoop,void 0===(n="function"==typeof i?i.call(e,r,e,t):i)||(t.exports=n)}(this)},function(t,e,r){"use strict";r.r(e);var i={};r.r(i),r.d(i,"EPSILON",function(){return u}),r.d(i,"ARRAY_TYPE",function(){return l}),r.d(i,"RANDOM",function(){return c}),r.d(i,"setMatrixArrayType",function(){return d}),r.d(i,"toRadian",function(){return p}),r.d(i,"equals",function(){return m});var n={};r.r(n),r.d(n,"create",function(){return _}),r.d(n,"clone",function(){return v}),r.d(n,"copy",function(){return g}),r.d(n,"fromValues",function(){return y}),r.d(n,"set",function(){return w}),r.d(n,"identity",function(){return M}),r.d(n,"transpose",function(){return x}),r.d(n,"invert",function(){return b}),r.d(n,"adjoint",function(){return E}),r.d(n,"determinant",function(){return A}),r.d(n,"multiply",function(){return T}),r.d(n,"translate",function(){return I}),r.d(n,"scale",function(){return R}),r.d(n,"rotate",function(){return S}),r.d(n,"rotateX",function(){return D}),r.d(n,"rotateY",function(){return k}),r.d(n,"rotateZ",function(){return L}),r.d(n,"fromTranslation",function(){return O}),r.d(n,"fromScaling",function(){return F}),r.d(n,"fromRotation",function(){return N}),r.d(n,"fromXRotation",function(){return P}),r.d(n,"fromYRotation",function(){return B}),r.d(n,"fromZRotation",function(){return C}),r.d(n,"fromRotationTranslation",function(){return U}),r.d(n,"fromQuat2",function(){return z}),r.d(n,"getTranslation",function(){return j}),r.d(n,"getScaling",function(){return q}),r.d(n,"getRotation",function(){return V}),r.d(n,"fromRotationTranslationScale",function(){return X}),r.d(n,"fromRotationTranslationScaleOrigin",function(){return Y}),r.d(n,"fromQuat",function(){return H}),r.d(n,"frustum",function(){return K}),r.d(n,"perspective",function(){return G}),r.d(n,"perspectiveFromFieldOfView",function(){return W}),r.d(n,"ortho",function(){return $}),r.d(n,"lookAt",function(){return Q}),r.d(n,"targetTo",function(){return Z}),r.d(n,"str",function(){return J}),r.d(n,"frob",function(){return tt}),r.d(n,"add",function(){return et}),r.d(n,"subtract",function(){return rt}),r.d(n,"multiplyScalar",function(){return it}),r.d(n,"multiplyScalarAndAdd",function(){return nt}),r.d(n,"exactEquals",function(){return st}),r.d(n,"equals",function(){return at}),r.d(n,"mul",function(){return ot}),r.d(n,"sub",function(){return ht});var s={};r.r(s),r.d(s,"create",function(){return ut}),r.d(s,"clone",function(){return lt}),r.d(s,"length",function(){return ct}),r.d(s,"fromValues",function(){return dt}),r.d(s,"copy",function(){return ft}),r.d(s,"set",function(){return pt}),r.d(s,"add",function(){return mt}),r.d(s,"subtract",function(){return _t}),r.d(s,"multiply",function(){return vt}),r.d(s,"divide",function(){return gt}),r.d(s,"ceil",function(){return yt}),r.d(s,"floor",function(){return wt}),r.d(s,"min",function(){return Mt}),r.d(s,"max",function(){return xt}),r.d(s,"round",function(){return bt}),r.d(s,"scale",function(){return Et}),r.d(s,"scaleAndAdd",function(){return At}),r.d(s,"distance",function(){return Tt}),r.d(s,"squaredDistance",function(){return It}),r.d(s,"squaredLength",function(){return Rt}),r.d(s,"negate",function(){return St}),r.d(s,"inverse",function(){return Dt}),r.d(s,"normalize",function(){return kt}),r.d(s,"dot",function(){return Lt}),r.d(s,"cross",function(){return Ot}),r.d(s,"lerp",function(){return Ft}),r.d(s,"hermite",function(){return Nt}),r.d(s,"bezier",function(){return Pt}),r.d(s,"random",function(){return Bt}),r.d(s,"transformMat4",function(){return Ct}),r.d(s,"transformMat3",function(){return Ut}),r.d(s,"transformQuat",function(){return zt}),r.d(s,"rotateX",function(){return jt}),r.d(s,"rotateY",function(){return qt}),r.d(s,"rotateZ",function(){return Vt}),r.d(s,"angle",function(){return Xt}),r.d(s,"zero",function(){return Yt}),r.d(s,"str",function(){return Ht}),r.d(s,"exactEquals",function(){return Kt}),r.d(s,"equals",function(){return Gt}),r.d(s,"sub",function(){return $t}),r.d(s,"mul",function(){return Qt}),r.d(s,"div",function(){return Zt}),r.d(s,"dist",function(){return Jt}),r.d(s,"sqrDist",function(){return te}),r.d(s,"len",function(){return ee}),r.d(s,"sqrLen",function(){return re}),r.d(s,"forEach",function(){return ie});var a={};r.r(a),r.d(a,"create",function(){return ne}),r.d(a,"clone",function(){return se}),r.d(a,"fromValues",function(){return ae}),r.d(a,"copy",function(){return oe}),r.d(a,"set",function(){return he}),r.d(a,"add",function(){return ue}),r.d(a,"subtract",function(){return le}),r.d(a,"multiply",function(){return ce}),r.d(a,"divide",function(){return de}),r.d(a,"ceil",function(){return fe}),r.d(a,"floor",function(){return pe}),r.d(a,"min",function(){return me}),r.d(a,"max",function(){return _e}),r.d(a,"round",function(){return ve}),r.d(a,"scale",function(){return ge}),r.d(a,"scaleAndAdd",function(){return ye}),r.d(a,"distance",function(){return we}),r.d(a,"squaredDistance",function(){return Me}),r.d(a,"length",function(){return xe}),r.d(a,"squaredLength",function(){return be}),r.d(a,"negate",function(){return Ee}),r.d(a,"inverse",function(){return Ae}),r.d(a,"normalize",function(){return Te}),r.d(a,"dot",function(){return Ie}),r.d(a,"cross",function(){return Re}),r.d(a,"lerp",function(){return Se}),r.d(a,"random",function(){return De}),r.d(a,"transformMat4",function(){return ke}),r.d(a,"transformQuat",function(){return Le}),r.d(a,"zero",function(){return Oe}),r.d(a,"str",function(){return Fe}),r.d(a,"exactEquals",function(){return Ne}),r.d(a,"equals",function(){return Pe}),r.d(a,"sub",function(){return Be}),r.d(a,"mul",function(){return Ce}),r.d(a,"div",function(){return Ue}),r.d(a,"dist",function(){return ze}),r.d(a,"sqrDist",function(){return je}),r.d(a,"len",function(){return qe}),r.d(a,"sqrLen",function(){return Ve}),r.d(a,"forEach",function(){return Xe});var o={};r.r(o),r.d(o,"create",function(){return Ye}),r.d(o,"identity",function(){return He}),r.d(o,"setAxisAngle",function(){return Ke}),r.d(o,"getAxisAngle",function(){return Ge}),r.d(o,"multiply",function(){return We}),r.d(o,"rotateX",function(){return $e}),r.d(o,"rotateY",function(){return Qe}),r.d(o,"rotateZ",function(){return Ze}),r.d(o,"calculateW",function(){return Je}),r.d(o,"slerp",function(){return tr}),r.d(o,"random",function(){return er}),r.d(o,"invert",function(){return rr}),r.d(o,"conjugate",function(){return ir}),r.d(o,"fromMat3",function(){return nr}),r.d(o,"fromEuler",function(){return sr}),r.d(o,"str",function(){return ar}),r.d(o,"clone",function(){return pr}),r.d(o,"fromValues",function(){return mr}),r.d(o,"copy",function(){return _r}),r.d(o,"set",function(){return vr}),r.d(o,"add",function(){return gr}),r.d(o,"mul",function(){return yr}),r.d(o,"scale",function(){return wr}),r.d(o,"dot",function(){return Mr}),r.d(o,"lerp",function(){return xr}),r.d(o,"length",function(){return br}),r.d(o,"len",function(){return Er}),r.d(o,"squaredLength",function(){return Ar}),r.d(o,"sqrLen",function(){return Tr}),r.d(o,"normalize",function(){return Ir}),r.d(o,"exactEquals",function(){return Rr}),r.d(o,"equals",function(){return Sr}),r.d(o,"rotationTo",function(){return Dr}),r.d(o,"sqlerp",function(){return kr}),r.d(o,"setAxes",function(){return Lr});var h={};r.r(h),r.d(h,"create",function(){return Or}),r.d(h,"clone",function(){return Fr}),r.d(h,"fromValues",function(){return Nr}),r.d(h,"copy",function(){return Pr}),r.d(h,"set",function(){return Br}),r.d(h,"add",function(){return Cr}),r.d(h,"subtract",function(){return Ur}),r.d(h,"multiply",function(){return zr}),r.d(h,"divide",function(){return jr}),r.d(h,"ceil",function(){return qr}),r.d(h,"floor",function(){return Vr}),r.d(h,"min",function(){return Xr}),r.d(h,"max",function(){return Yr}),r.d(h,"round",function(){return Hr}),r.d(h,"scale",function(){return Kr}),r.d(h,"scaleAndAdd",function(){return Gr}),r.d(h,"distance",function(){return Wr}),r.d(h,"squaredDistance",function(){return $r}),r.d(h,"length",function(){return Qr}),r.d(h,"squaredLength",function(){return Zr}),r.d(h,"negate",function(){return Jr}),r.d(h,"inverse",function(){return ti}),r.d(h,"normalize",function(){return ei}),r.d(h,"dot",function(){return ri}),r.d(h,"cross",function(){return ii}),r.d(h,"lerp",function(){return ni}),r.d(h,"random",function(){return si}),r.d(h,"transformMat2",function(){return ai}),r.d(h,"transformMat2d",function(){return oi}),r.d(h,"transformMat3",function(){return hi}),r.d(h,"transformMat4",function(){return ui}),r.d(h,"rotate",function(){return li}),r.d(h,"angle",function(){return ci}),r.d(h,"zero",function(){return di}),r.d(h,"str",function(){return fi}),r.d(h,"exactEquals",function(){return pi}),r.d(h,"equals",function(){return mi}),r.d(h,"len",function(){return vi}),r.d(h,"sub",function(){return gi}),r.d(h,"mul",function(){return yi}),r.d(h,"div",function(){return wi}),r.d(h,"dist",function(){return Mi}),r.d(h,"sqrDist",function(){return xi}),r.d(h,"sqrLen",function(){return bi}),r.d(h,"forEach",function(){return Ei});var u=1e-6,l="undefined"!=typeof Float32Array?Float32Array:Array,c=Math.random;function d(t){l=t}var f=Math.PI/180;function p(t){return t*f}function m(t,e){return Math.abs(t-e)<=u*Math.max(1,Math.abs(t),Math.abs(e))}function _(){var t=new l(16);return l!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function v(t){var e=new l(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function g(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function y(t,e,r,i,n,s,a,o,h,u,c,d,f,p,m,_){var v=new l(16);return v[0]=t,v[1]=e,v[2]=r,v[3]=i,v[4]=n,v[5]=s,v[6]=a,v[7]=o,v[8]=h,v[9]=u,v[10]=c,v[11]=d,v[12]=f,v[13]=p,v[14]=m,v[15]=_,v}function w(t,e,r,i,n,s,a,o,h,u,l,c,d,f,p,m,_){return t[0]=e,t[1]=r,t[2]=i,t[3]=n,t[4]=s,t[5]=a,t[6]=o,t[7]=h,t[8]=u,t[9]=l,t[10]=c,t[11]=d,t[12]=f,t[13]=p,t[14]=m,t[15]=_,t}function M(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function x(t,e){if(t===e){var r=e[1],i=e[2],n=e[3],s=e[6],a=e[7],o=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=i,t[9]=s,t[11]=e[14],t[12]=n,t[13]=a,t[14]=o}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function b(t,e){var r=e[0],i=e[1],n=e[2],s=e[3],a=e[4],o=e[5],h=e[6],u=e[7],l=e[8],c=e[9],d=e[10],f=e[11],p=e[12],m=e[13],_=e[14],v=e[15],g=r*o-i*a,y=r*h-n*a,w=r*u-s*a,M=i*h-n*o,x=i*u-s*o,b=n*u-s*h,E=l*m-c*p,A=l*_-d*p,T=l*v-f*p,I=c*_-d*m,R=c*v-f*m,S=d*v-f*_,D=g*S-y*R+w*I+M*T-x*A+b*E;return D?(D=1/D,t[0]=(o*S-h*R+u*I)*D,t[1]=(n*R-i*S-s*I)*D,t[2]=(m*b-_*x+v*M)*D,t[3]=(d*x-c*b-f*M)*D,t[4]=(h*T-a*S-u*A)*D,t[5]=(r*S-n*T+s*A)*D,t[6]=(_*w-p*b-v*y)*D,t[7]=(l*b-d*w+f*y)*D,t[8]=(a*R-o*T+u*E)*D,t[9]=(i*T-r*R-s*E)*D,t[10]=(p*x-m*w+v*g)*D,t[11]=(c*w-l*x-f*g)*D,t[12]=(o*A-a*I-h*E)*D,t[13]=(r*I-i*A+n*E)*D,t[14]=(m*y-p*M-_*g)*D,t[15]=(l*M-c*y+d*g)*D,t):null}function E(t,e){var r=e[0],i=e[1],n=e[2],s=e[3],a=e[4],o=e[5],h=e[6],u=e[7],l=e[8],c=e[9],d=e[10],f=e[11],p=e[12],m=e[13],_=e[14],v=e[15];return t[0]=o*(d*v-f*_)-c*(h*v-u*_)+m*(h*f-u*d),t[1]=-(i*(d*v-f*_)-c*(n*v-s*_)+m*(n*f-s*d)),t[2]=i*(h*v-u*_)-o*(n*v-s*_)+m*(n*u-s*h),t[3]=-(i*(h*f-u*d)-o*(n*f-s*d)+c*(n*u-s*h)),t[4]=-(a*(d*v-f*_)-l*(h*v-u*_)+p*(h*f-u*d)),t[5]=r*(d*v-f*_)-l*(n*v-s*_)+p*(n*f-s*d),t[6]=-(r*(h*v-u*_)-a*(n*v-s*_)+p*(n*u-s*h)),t[7]=r*(h*f-u*d)-a*(n*f-s*d)+l*(n*u-s*h),t[8]=a*(c*v-f*m)-l*(o*v-u*m)+p*(o*f-u*c),t[9]=-(r*(c*v-f*m)-l*(i*v-s*m)+p*(i*f-s*c)),t[10]=r*(o*v-u*m)-a*(i*v-s*m)+p*(i*u-s*o),t[11]=-(r*(o*f-u*c)-a*(i*f-s*c)+l*(i*u-s*o)),t[12]=-(a*(c*_-d*m)-l*(o*_-h*m)+p*(o*d-h*c)),t[13]=r*(c*_-d*m)-l*(i*_-n*m)+p*(i*d-n*c),t[14]=-(r*(o*_-h*m)-a*(i*_-n*m)+p*(i*h-n*o)),t[15]=r*(o*d-h*c)-a*(i*d-n*c)+l*(i*h-n*o),t}function A(t){var e=t[0],r=t[1],i=t[2],n=t[3],s=t[4],a=t[5],o=t[6],h=t[7],u=t[8],l=t[9],c=t[10],d=t[11],f=t[12],p=t[13],m=t[14],_=t[15];return(e*a-r*s)*(c*_-d*m)-(e*o-i*s)*(l*_-d*p)+(e*h-n*s)*(l*m-c*p)+(r*o-i*a)*(u*_-d*f)-(r*h-n*a)*(u*m-c*f)+(i*h-n*o)*(u*p-l*f)}function T(t,e,r){var i=e[0],n=e[1],s=e[2],a=e[3],o=e[4],h=e[5],u=e[6],l=e[7],c=e[8],d=e[9],f=e[10],p=e[11],m=e[12],_=e[13],v=e[14],g=e[15],y=r[0],w=r[1],M=r[2],x=r[3];return t[0]=y*i+w*o+M*c+x*m,t[1]=y*n+w*h+M*d+x*_,t[2]=y*s+w*u+M*f+x*v,t[3]=y*a+w*l+M*p+x*g,y=r[4],w=r[5],M=r[6],x=r[7],t[4]=y*i+w*o+M*c+x*m,t[5]=y*n+w*h+M*d+x*_,t[6]=y*s+w*u+M*f+x*v,t[7]=y*a+w*l+M*p+x*g,y=r[8],w=r[9],M=r[10],x=r[11],t[8]=y*i+w*o+M*c+x*m,t[9]=y*n+w*h+M*d+x*_,t[10]=y*s+w*u+M*f+x*v,t[11]=y*a+w*l+M*p+x*g,y=r[12],w=r[13],M=r[14],x=r[15],t[12]=y*i+w*o+M*c+x*m,t[13]=y*n+w*h+M*d+x*_,t[14]=y*s+w*u+M*f+x*v,t[15]=y*a+w*l+M*p+x*g,t}function I(t,e,r){var i,n,s,a,o,h,u,l,c,d,f,p,m=r[0],_=r[1],v=r[2];return e===t?(t[12]=e[0]*m+e[4]*_+e[8]*v+e[12],t[13]=e[1]*m+e[5]*_+e[9]*v+e[13],t[14]=e[2]*m+e[6]*_+e[10]*v+e[14],t[15]=e[3]*m+e[7]*_+e[11]*v+e[15]):(i=e[0],n=e[1],s=e[2],a=e[3],o=e[4],h=e[5],u=e[6],l=e[7],c=e[8],d=e[9],f=e[10],p=e[11],t[0]=i,t[1]=n,t[2]=s,t[3]=a,t[4]=o,t[5]=h,t[6]=u,t[7]=l,t[8]=c,t[9]=d,t[10]=f,t[11]=p,t[12]=i*m+o*_+c*v+e[12],t[13]=n*m+h*_+d*v+e[13],t[14]=s*m+u*_+f*v+e[14],t[15]=a*m+l*_+p*v+e[15]),t}function R(t,e,r){var i=r[0],n=r[1],s=r[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*s,t[9]=e[9]*s,t[10]=e[10]*s,t[11]=e[11]*s,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function S(t,e,r,i){var n,s,a,o,h,l,c,d,f,p,m,_,v,g,y,w,M,x,b,E,A,T,I,R,S=i[0],D=i[1],k=i[2],L=Math.sqrt(S*S+D*D+k*k);return L<u?null:(S*=L=1/L,D*=L,k*=L,n=Math.sin(r),a=1-(s=Math.cos(r)),o=e[0],h=e[1],l=e[2],c=e[3],d=e[4],f=e[5],p=e[6],m=e[7],_=e[8],v=e[9],g=e[10],y=e[11],w=S*S*a+s,M=D*S*a+k*n,x=k*S*a-D*n,b=S*D*a-k*n,E=D*D*a+s,A=k*D*a+S*n,T=S*k*a+D*n,I=D*k*a-S*n,R=k*k*a+s,t[0]=o*w+d*M+_*x,t[1]=h*w+f*M+v*x,t[2]=l*w+p*M+g*x,t[3]=c*w+m*M+y*x,t[4]=o*b+d*E+_*A,t[5]=h*b+f*E+v*A,t[6]=l*b+p*E+g*A,t[7]=c*b+m*E+y*A,t[8]=o*T+d*I+_*R,t[9]=h*T+f*I+v*R,t[10]=l*T+p*I+g*R,t[11]=c*T+m*I+y*R,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function D(t,e,r){var i=Math.sin(r),n=Math.cos(r),s=e[4],a=e[5],o=e[6],h=e[7],u=e[8],l=e[9],c=e[10],d=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=s*n+u*i,t[5]=a*n+l*i,t[6]=o*n+c*i,t[7]=h*n+d*i,t[8]=u*n-s*i,t[9]=l*n-a*i,t[10]=c*n-o*i,t[11]=d*n-h*i,t}function k(t,e,r){var i=Math.sin(r),n=Math.cos(r),s=e[0],a=e[1],o=e[2],h=e[3],u=e[8],l=e[9],c=e[10],d=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*n-u*i,t[1]=a*n-l*i,t[2]=o*n-c*i,t[3]=h*n-d*i,t[8]=s*i+u*n,t[9]=a*i+l*n,t[10]=o*i+c*n,t[11]=h*i+d*n,t}function L(t,e,r){var i=Math.sin(r),n=Math.cos(r),s=e[0],a=e[1],o=e[2],h=e[3],u=e[4],l=e[5],c=e[6],d=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*n+u*i,t[1]=a*n+l*i,t[2]=o*n+c*i,t[3]=h*n+d*i,t[4]=u*n-s*i,t[5]=l*n-a*i,t[6]=c*n-o*i,t[7]=d*n-h*i,t}function O(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function F(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function N(t,e,r){var i,n,s,a=r[0],o=r[1],h=r[2],l=Math.sqrt(a*a+o*o+h*h);return l<u?null:(a*=l=1/l,o*=l,h*=l,i=Math.sin(e),s=1-(n=Math.cos(e)),t[0]=a*a*s+n,t[1]=o*a*s+h*i,t[2]=h*a*s-o*i,t[3]=0,t[4]=a*o*s-h*i,t[5]=o*o*s+n,t[6]=h*o*s+a*i,t[7]=0,t[8]=a*h*s+o*i,t[9]=o*h*s-a*i,t[10]=h*h*s+n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function P(t,e){var r=Math.sin(e),i=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i,t[6]=r,t[7]=0,t[8]=0,t[9]=-r,t[10]=i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function B(t,e){var r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=0,t[2]=-r,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=r,t[9]=0,t[10]=i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function C(t,e){var r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=r,t[2]=0,t[3]=0,t[4]=-r,t[5]=i,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function U(t,e,r){var i=e[0],n=e[1],s=e[2],a=e[3],o=i+i,h=n+n,u=s+s,l=i*o,c=i*h,d=i*u,f=n*h,p=n*u,m=s*u,_=a*o,v=a*h,g=a*u;return t[0]=1-(f+m),t[1]=c+g,t[2]=d-v,t[3]=0,t[4]=c-g,t[5]=1-(l+m),t[6]=p+_,t[7]=0,t[8]=d+v,t[9]=p-_,t[10]=1-(l+f),t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function z(t,e){var r=new l(3),i=-e[0],n=-e[1],s=-e[2],a=e[3],o=e[4],h=e[5],u=e[6],c=e[7],d=i*i+n*n+s*s+a*a;return d>0?(r[0]=2*(o*a+c*i+h*s-u*n)/d,r[1]=2*(h*a+c*n+u*i-o*s)/d,r[2]=2*(u*a+c*s+o*n-h*i)/d):(r[0]=2*(o*a+c*i+h*s-u*n),r[1]=2*(h*a+c*n+u*i-o*s),r[2]=2*(u*a+c*s+o*n-h*i)),U(t,e,r),t}function j(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function q(t,e){var r=e[0],i=e[1],n=e[2],s=e[4],a=e[5],o=e[6],h=e[8],u=e[9],l=e[10];return t[0]=Math.sqrt(r*r+i*i+n*n),t[1]=Math.sqrt(s*s+a*a+o*o),t[2]=Math.sqrt(h*h+u*u+l*l),t}function V(t,e){var r=e[0]+e[5]+e[10],i=0;return r>0?(i=2*Math.sqrt(r+1),t[3]=.25*i,t[0]=(e[6]-e[9])/i,t[1]=(e[8]-e[2])/i,t[2]=(e[1]-e[4])/i):e[0]>e[5]&&e[0]>e[10]?(i=2*Math.sqrt(1+e[0]-e[5]-e[10]),t[3]=(e[6]-e[9])/i,t[0]=.25*i,t[1]=(e[1]+e[4])/i,t[2]=(e[8]+e[2])/i):e[5]>e[10]?(i=2*Math.sqrt(1+e[5]-e[0]-e[10]),t[3]=(e[8]-e[2])/i,t[0]=(e[1]+e[4])/i,t[1]=.25*i,t[2]=(e[6]+e[9])/i):(i=2*Math.sqrt(1+e[10]-e[0]-e[5]),t[3]=(e[1]-e[4])/i,t[0]=(e[8]+e[2])/i,t[1]=(e[6]+e[9])/i,t[2]=.25*i),t}function X(t,e,r,i){var n=e[0],s=e[1],a=e[2],o=e[3],h=n+n,u=s+s,l=a+a,c=n*h,d=n*u,f=n*l,p=s*u,m=s*l,_=a*l,v=o*h,g=o*u,y=o*l,w=i[0],M=i[1],x=i[2];return t[0]=(1-(p+_))*w,t[1]=(d+y)*w,t[2]=(f-g)*w,t[3]=0,t[4]=(d-y)*M,t[5]=(1-(c+_))*M,t[6]=(m+v)*M,t[7]=0,t[8]=(f+g)*x,t[9]=(m-v)*x,t[10]=(1-(c+p))*x,t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function Y(t,e,r,i,n){var s=e[0],a=e[1],o=e[2],h=e[3],u=s+s,l=a+a,c=o+o,d=s*u,f=s*l,p=s*c,m=a*l,_=a*c,v=o*c,g=h*u,y=h*l,w=h*c,M=i[0],x=i[1],b=i[2],E=n[0],A=n[1],T=n[2],I=(1-(m+v))*M,R=(f+w)*M,S=(p-y)*M,D=(f-w)*x,k=(1-(d+v))*x,L=(_+g)*x,O=(p+y)*b,F=(_-g)*b,N=(1-(d+m))*b;return t[0]=I,t[1]=R,t[2]=S,t[3]=0,t[4]=D,t[5]=k,t[6]=L,t[7]=0,t[8]=O,t[9]=F,t[10]=N,t[11]=0,t[12]=r[0]+E-(I*E+D*A+O*T),t[13]=r[1]+A-(R*E+k*A+F*T),t[14]=r[2]+T-(S*E+L*A+N*T),t[15]=1,t}function H(t,e){var r=e[0],i=e[1],n=e[2],s=e[3],a=r+r,o=i+i,h=n+n,u=r*a,l=i*a,c=i*o,d=n*a,f=n*o,p=n*h,m=s*a,_=s*o,v=s*h;return t[0]=1-c-p,t[1]=l+v,t[2]=d-_,t[3]=0,t[4]=l-v,t[5]=1-u-p,t[6]=f+m,t[7]=0,t[8]=d+_,t[9]=f-m,t[10]=1-u-c,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function K(t,e,r,i,n,s,a){var o=1/(r-e),h=1/(n-i),u=1/(s-a);return t[0]=2*s*o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*s*h,t[6]=0,t[7]=0,t[8]=(r+e)*o,t[9]=(n+i)*h,t[10]=(a+s)*u,t[11]=-1,t[12]=0,t[13]=0,t[14]=a*s*2*u,t[15]=0,t}function G(t,e,r,i,n){var s,a=1/Math.tan(e/2);return t[0]=a/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=n&&n!==1/0?(s=1/(i-n),t[10]=(n+i)*s,t[14]=2*n*i*s):(t[10]=-1,t[14]=-2*i),t}function W(t,e,r,i){var n=Math.tan(e.upDegrees*Math.PI/180),s=Math.tan(e.downDegrees*Math.PI/180),a=Math.tan(e.leftDegrees*Math.PI/180),o=Math.tan(e.rightDegrees*Math.PI/180),h=2/(a+o),u=2/(n+s);return t[0]=h,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=u,t[6]=0,t[7]=0,t[8]=-(a-o)*h*.5,t[9]=(n-s)*u*.5,t[10]=i/(r-i),t[11]=-1,t[12]=0,t[13]=0,t[14]=i*r/(r-i),t[15]=0,t}function $(t,e,r,i,n,s,a){var o=1/(e-r),h=1/(i-n),u=1/(s-a);return t[0]=-2*o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*h,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*u,t[11]=0,t[12]=(e+r)*o,t[13]=(n+i)*h,t[14]=(a+s)*u,t[15]=1,t}function Q(t,e,r,i){var n,s,a,o,h,l,c,d,f,p,m=e[0],_=e[1],v=e[2],g=i[0],y=i[1],w=i[2],x=r[0],b=r[1],E=r[2];return Math.abs(m-x)<u&&Math.abs(_-b)<u&&Math.abs(v-E)<u?M(t):(c=m-x,d=_-b,f=v-E,n=y*(f*=p=1/Math.sqrt(c*c+d*d+f*f))-w*(d*=p),s=w*(c*=p)-g*f,a=g*d-y*c,(p=Math.sqrt(n*n+s*s+a*a))?(n*=p=1/p,s*=p,a*=p):(n=0,s=0,a=0),o=d*a-f*s,h=f*n-c*a,l=c*s-d*n,(p=Math.sqrt(o*o+h*h+l*l))?(o*=p=1/p,h*=p,l*=p):(o=0,h=0,l=0),t[0]=n,t[1]=o,t[2]=c,t[3]=0,t[4]=s,t[5]=h,t[6]=d,t[7]=0,t[8]=a,t[9]=l,t[10]=f,t[11]=0,t[12]=-(n*m+s*_+a*v),t[13]=-(o*m+h*_+l*v),t[14]=-(c*m+d*_+f*v),t[15]=1,t)}function Z(t,e,r,i){var n=e[0],s=e[1],a=e[2],o=i[0],h=i[1],u=i[2],l=n-r[0],c=s-r[1],d=a-r[2],f=l*l+c*c+d*d;f>0&&(l*=f=1/Math.sqrt(f),c*=f,d*=f);var p=h*d-u*c,m=u*l-o*d,_=o*c-h*l;return(f=p*p+m*m+_*_)>0&&(p*=f=1/Math.sqrt(f),m*=f,_*=f),t[0]=p,t[1]=m,t[2]=_,t[3]=0,t[4]=c*_-d*m,t[5]=d*p-l*_,t[6]=l*m-c*p,t[7]=0,t[8]=l,t[9]=c,t[10]=d,t[11]=0,t[12]=n,t[13]=s,t[14]=a,t[15]=1,t}function J(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function tt(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2)+Math.pow(t[9],2)+Math.pow(t[10],2)+Math.pow(t[11],2)+Math.pow(t[12],2)+Math.pow(t[13],2)+Math.pow(t[14],2)+Math.pow(t[15],2))}function et(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t[9]=e[9]+r[9],t[10]=e[10]+r[10],t[11]=e[11]+r[11],t[12]=e[12]+r[12],t[13]=e[13]+r[13],t[14]=e[14]+r[14],t[15]=e[15]+r[15],t}function rt(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t[9]=e[9]-r[9],t[10]=e[10]-r[10],t[11]=e[11]-r[11],t[12]=e[12]-r[12],t[13]=e[13]-r[13],t[14]=e[14]-r[14],t[15]=e[15]-r[15],t}function it(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t[9]=e[9]*r,t[10]=e[10]*r,t[11]=e[11]*r,t[12]=e[12]*r,t[13]=e[13]*r,t[14]=e[14]*r,t[15]=e[15]*r,t}function nt(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t[4]=e[4]+r[4]*i,t[5]=e[5]+r[5]*i,t[6]=e[6]+r[6]*i,t[7]=e[7]+r[7]*i,t[8]=e[8]+r[8]*i,t[9]=e[9]+r[9]*i,t[10]=e[10]+r[10]*i,t[11]=e[11]+r[11]*i,t[12]=e[12]+r[12]*i,t[13]=e[13]+r[13]*i,t[14]=e[14]+r[14]*i,t[15]=e[15]+r[15]*i,t}function st(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function at(t,e){var r=t[0],i=t[1],n=t[2],s=t[3],a=t[4],o=t[5],h=t[6],l=t[7],c=t[8],d=t[9],f=t[10],p=t[11],m=t[12],_=t[13],v=t[14],g=t[15],y=e[0],w=e[1],M=e[2],x=e[3],b=e[4],E=e[5],A=e[6],T=e[7],I=e[8],R=e[9],S=e[10],D=e[11],k=e[12],L=e[13],O=e[14],F=e[15];return Math.abs(r-y)<=u*Math.max(1,Math.abs(r),Math.abs(y))&&Math.abs(i-w)<=u*Math.max(1,Math.abs(i),Math.abs(w))&&Math.abs(n-M)<=u*Math.max(1,Math.abs(n),Math.abs(M))&&Math.abs(s-x)<=u*Math.max(1,Math.abs(s),Math.abs(x))&&Math.abs(a-b)<=u*Math.max(1,Math.abs(a),Math.abs(b))&&Math.abs(o-E)<=u*Math.max(1,Math.abs(o),Math.abs(E))&&Math.abs(h-A)<=u*Math.max(1,Math.abs(h),Math.abs(A))&&Math.abs(l-T)<=u*Math.max(1,Math.abs(l),Math.abs(T))&&Math.abs(c-I)<=u*Math.max(1,Math.abs(c),Math.abs(I))&&Math.abs(d-R)<=u*Math.max(1,Math.abs(d),Math.abs(R))&&Math.abs(f-S)<=u*Math.max(1,Math.abs(f),Math.abs(S))&&Math.abs(p-D)<=u*Math.max(1,Math.abs(p),Math.abs(D))&&Math.abs(m-k)<=u*Math.max(1,Math.abs(m),Math.abs(k))&&Math.abs(_-L)<=u*Math.max(1,Math.abs(_),Math.abs(L))&&Math.abs(v-O)<=u*Math.max(1,Math.abs(v),Math.abs(O))&&Math.abs(g-F)<=u*Math.max(1,Math.abs(g),Math.abs(F))}var ot=T,ht=rt;function ut(){var t=new l(3);return l!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function lt(t){var e=new l(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function ct(t){var e=t[0],r=t[1],i=t[2];return Math.sqrt(e*e+r*r+i*i)}function dt(t,e,r){var i=new l(3);return i[0]=t,i[1]=e,i[2]=r,i}function ft(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function pt(t,e,r,i){return t[0]=e,t[1]=r,t[2]=i,t}function mt(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t}function _t(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t}function vt(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t}function gt(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t}function yt(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t}function wt(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t}function Mt(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t}function xt(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t}function bt(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t}function Et(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t}function At(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t}function Tt(t,e){var r=e[0]-t[0],i=e[1]-t[1],n=e[2]-t[2];return Math.sqrt(r*r+i*i+n*n)}function It(t,e){var r=e[0]-t[0],i=e[1]-t[1],n=e[2]-t[2];return r*r+i*i+n*n}function Rt(t){var e=t[0],r=t[1],i=t[2];return e*e+r*r+i*i}function St(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function Dt(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function kt(t,e){var r=e[0],i=e[1],n=e[2],s=r*r+i*i+n*n;return s>0&&(s=1/Math.sqrt(s)),t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s,t}function Lt(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Ot(t,e,r){var i=e[0],n=e[1],s=e[2],a=r[0],o=r[1],h=r[2];return t[0]=n*h-s*o,t[1]=s*a-i*h,t[2]=i*o-n*a,t}function Ft(t,e,r,i){var n=e[0],s=e[1],a=e[2];return t[0]=n+i*(r[0]-n),t[1]=s+i*(r[1]-s),t[2]=a+i*(r[2]-a),t}function Nt(t,e,r,i,n,s){var a=s*s,o=a*(2*s-3)+1,h=a*(s-2)+s,u=a*(s-1),l=a*(3-2*s);return t[0]=e[0]*o+r[0]*h+i[0]*u+n[0]*l,t[1]=e[1]*o+r[1]*h+i[1]*u+n[1]*l,t[2]=e[2]*o+r[2]*h+i[2]*u+n[2]*l,t}function Pt(t,e,r,i,n,s){var a=1-s,o=a*a,h=s*s,u=o*a,l=3*s*o,c=3*h*a,d=h*s;return t[0]=e[0]*u+r[0]*l+i[0]*c+n[0]*d,t[1]=e[1]*u+r[1]*l+i[1]*c+n[1]*d,t[2]=e[2]*u+r[2]*l+i[2]*c+n[2]*d,t}function Bt(t,e){e=e||1;var r=2*c()*Math.PI,i=2*c()-1,n=Math.sqrt(1-i*i)*e;return t[0]=Math.cos(r)*n,t[1]=Math.sin(r)*n,t[2]=i*e,t}function Ct(t,e,r){var i=e[0],n=e[1],s=e[2],a=r[3]*i+r[7]*n+r[11]*s+r[15];return a=a||1,t[0]=(r[0]*i+r[4]*n+r[8]*s+r[12])/a,t[1]=(r[1]*i+r[5]*n+r[9]*s+r[13])/a,t[2]=(r[2]*i+r[6]*n+r[10]*s+r[14])/a,t}function Ut(t,e,r){var i=e[0],n=e[1],s=e[2];return t[0]=i*r[0]+n*r[3]+s*r[6],t[1]=i*r[1]+n*r[4]+s*r[7],t[2]=i*r[2]+n*r[5]+s*r[8],t}function zt(t,e,r){var i=r[0],n=r[1],s=r[2],a=r[3],o=e[0],h=e[1],u=e[2],l=n*u-s*h,c=s*o-i*u,d=i*h-n*o,f=n*d-s*c,p=s*l-i*d,m=i*c-n*l,_=2*a;return l*=_,c*=_,d*=_,f*=2,p*=2,m*=2,t[0]=o+l+f,t[1]=h+c+p,t[2]=u+d+m,t}function jt(t,e,r,i){var n=[],s=[];return n[0]=e[0]-r[0],n[1]=e[1]-r[1],n[2]=e[2]-r[2],s[0]=n[0],s[1]=n[1]*Math.cos(i)-n[2]*Math.sin(i),s[2]=n[1]*Math.sin(i)+n[2]*Math.cos(i),t[0]=s[0]+r[0],t[1]=s[1]+r[1],t[2]=s[2]+r[2],t}function qt(t,e,r,i){var n=[],s=[];return n[0]=e[0]-r[0],n[1]=e[1]-r[1],n[2]=e[2]-r[2],s[0]=n[2]*Math.sin(i)+n[0]*Math.cos(i),s[1]=n[1],s[2]=n[2]*Math.cos(i)-n[0]*Math.sin(i),t[0]=s[0]+r[0],t[1]=s[1]+r[1],t[2]=s[2]+r[2],t}function Vt(t,e,r,i){var n=[],s=[];return n[0]=e[0]-r[0],n[1]=e[1]-r[1],n[2]=e[2]-r[2],s[0]=n[0]*Math.cos(i)-n[1]*Math.sin(i),s[1]=n[0]*Math.sin(i)+n[1]*Math.cos(i),s[2]=n[2],t[0]=s[0]+r[0],t[1]=s[1]+r[1],t[2]=s[2]+r[2],t}function Xt(t,e){var r=dt(t[0],t[1],t[2]),i=dt(e[0],e[1],e[2]);kt(r,r),kt(i,i);var n=Lt(r,i);return n>1?0:n<-1?Math.PI:Math.acos(n)}function Yt(t){return t[0]=0,t[1]=0,t[2]=0,t}function Ht(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"}function Kt(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function Gt(t,e){var r=t[0],i=t[1],n=t[2],s=e[0],a=e[1],o=e[2];return Math.abs(r-s)<=u*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(i-a)<=u*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(n-o)<=u*Math.max(1,Math.abs(n),Math.abs(o))}var Wt,$t=_t,Qt=vt,Zt=gt,Jt=Tt,te=It,ee=ct,re=Rt,ie=(Wt=ut(),function(t,e,r,i,n,s){var a,o;for(e||(e=3),r||(r=0),o=i?Math.min(i*e+r,t.length):t.length,a=r;a<o;a+=e)Wt[0]=t[a],Wt[1]=t[a+1],Wt[2]=t[a+2],n(Wt,Wt,s),t[a]=Wt[0],t[a+1]=Wt[1],t[a+2]=Wt[2];return t});function ne(){var t=new l(4);return l!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function se(t){var e=new l(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function ae(t,e,r,i){var n=new l(4);return n[0]=t,n[1]=e,n[2]=r,n[3]=i,n}function oe(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function he(t,e,r,i,n){return t[0]=e,t[1]=r,t[2]=i,t[3]=n,t}function ue(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t}function le(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}function ce(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t[3]=e[3]*r[3],t}function de(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t[3]=e[3]/r[3],t}function fe(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t}function pe(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t}function me(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t[3]=Math.min(e[3],r[3]),t}function _e(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t[3]=Math.max(e[3],r[3]),t}function ve(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t}function ge(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t}function ye(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t}function we(t,e){var r=e[0]-t[0],i=e[1]-t[1],n=e[2]-t[2],s=e[3]-t[3];return Math.sqrt(r*r+i*i+n*n+s*s)}function Me(t,e){var r=e[0]-t[0],i=e[1]-t[1],n=e[2]-t[2],s=e[3]-t[3];return r*r+i*i+n*n+s*s}function xe(t){var e=t[0],r=t[1],i=t[2],n=t[3];return Math.sqrt(e*e+r*r+i*i+n*n)}function be(t){var e=t[0],r=t[1],i=t[2],n=t[3];return e*e+r*r+i*i+n*n}function Ee(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function Ae(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t}function Te(t,e){var r=e[0],i=e[1],n=e[2],s=e[3],a=r*r+i*i+n*n+s*s;return a>0&&(a=1/Math.sqrt(a)),t[0]=r*a,t[1]=i*a,t[2]=n*a,t[3]=s*a,t}function Ie(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function Re(t,e,r,i){var n=r[0]*i[1]-r[1]*i[0],s=r[0]*i[2]-r[2]*i[0],a=r[0]*i[3]-r[3]*i[0],o=r[1]*i[2]-r[2]*i[1],h=r[1]*i[3]-r[3]*i[1],u=r[2]*i[3]-r[3]*i[2],l=e[0],c=e[1],d=e[2],f=e[3];return t[0]=c*u-d*h+f*o,t[1]=-l*u+d*a-f*s,t[2]=l*h-c*a+f*n,t[3]=-l*o+c*s-d*n,t}function Se(t,e,r,i){var n=e[0],s=e[1],a=e[2],o=e[3];return t[0]=n+i*(r[0]-n),t[1]=s+i*(r[1]-s),t[2]=a+i*(r[2]-a),t[3]=o+i*(r[3]-o),t}function De(t,e){var r,i,n,s,a,o;e=e||1;do{a=(r=2*c()-1)*r+(i=2*c()-1)*i}while(a>=1);do{o=(n=2*c()-1)*n+(s=2*c()-1)*s}while(o>=1);var h=Math.sqrt((1-a)/o);return t[0]=e*r,t[1]=e*i,t[2]=e*n*h,t[3]=e*s*h,t}function ke(t,e,r){var i=e[0],n=e[1],s=e[2],a=e[3];return t[0]=r[0]*i+r[4]*n+r[8]*s+r[12]*a,t[1]=r[1]*i+r[5]*n+r[9]*s+r[13]*a,t[2]=r[2]*i+r[6]*n+r[10]*s+r[14]*a,t[3]=r[3]*i+r[7]*n+r[11]*s+r[15]*a,t}function Le(t,e,r){var i=e[0],n=e[1],s=e[2],a=r[0],o=r[1],h=r[2],u=r[3],l=u*i+o*s-h*n,c=u*n+h*i-a*s,d=u*s+a*n-o*i,f=-a*i-o*n-h*s;return t[0]=l*u+f*-a+c*-h-d*-o,t[1]=c*u+f*-o+d*-a-l*-h,t[2]=d*u+f*-h+l*-o-c*-a,t[3]=e[3],t}function Oe(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t}function Fe(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function Ne(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function Pe(t,e){var r=t[0],i=t[1],n=t[2],s=t[3],a=e[0],o=e[1],h=e[2],l=e[3];return Math.abs(r-a)<=u*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(i-o)<=u*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(n-h)<=u*Math.max(1,Math.abs(n),Math.abs(h))&&Math.abs(s-l)<=u*Math.max(1,Math.abs(s),Math.abs(l))}var Be=le,Ce=ce,Ue=de,ze=we,je=Me,qe=xe,Ve=be,Xe=function(){var t=ne();return function(e,r,i,n,s,a){var o,h;for(r||(r=4),i||(i=0),h=n?Math.min(n*r+i,e.length):e.length,o=i;o<h;o+=r)t[0]=e[o],t[1]=e[o+1],t[2]=e[o+2],t[3]=e[o+3],s(t,t,a),e[o]=t[0],e[o+1]=t[1],e[o+2]=t[2],e[o+3]=t[3];return e}}();function Ye(){var t=new l(4);return l!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function He(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function Ke(t,e,r){r*=.5;var i=Math.sin(r);return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=Math.cos(r),t}function Ge(t,e){var r=2*Math.acos(e[3]),i=Math.sin(r/2);return i>u?(t[0]=e[0]/i,t[1]=e[1]/i,t[2]=e[2]/i):(t[0]=1,t[1]=0,t[2]=0),r}function We(t,e,r){var i=e[0],n=e[1],s=e[2],a=e[3],o=r[0],h=r[1],u=r[2],l=r[3];return t[0]=i*l+a*o+n*u-s*h,t[1]=n*l+a*h+s*o-i*u,t[2]=s*l+a*u+i*h-n*o,t[3]=a*l-i*o-n*h-s*u,t}function $e(t,e,r){r*=.5;var i=e[0],n=e[1],s=e[2],a=e[3],o=Math.sin(r),h=Math.cos(r);return t[0]=i*h+a*o,t[1]=n*h+s*o,t[2]=s*h-n*o,t[3]=a*h-i*o,t}function Qe(t,e,r){r*=.5;var i=e[0],n=e[1],s=e[2],a=e[3],o=Math.sin(r),h=Math.cos(r);return t[0]=i*h-s*o,t[1]=n*h+a*o,t[2]=s*h+i*o,t[3]=a*h-n*o,t}function Ze(t,e,r){r*=.5;var i=e[0],n=e[1],s=e[2],a=e[3],o=Math.sin(r),h=Math.cos(r);return t[0]=i*h+n*o,t[1]=n*h-i*o,t[2]=s*h+a*o,t[3]=a*h-s*o,t}function Je(t,e){var r=e[0],i=e[1],n=e[2];return t[0]=r,t[1]=i,t[2]=n,t[3]=Math.sqrt(Math.abs(1-r*r-i*i-n*n)),t}function tr(t,e,r,i){var n,s,a,o,h,l=e[0],c=e[1],d=e[2],f=e[3],p=r[0],m=r[1],_=r[2],v=r[3];return(s=l*p+c*m+d*_+f*v)<0&&(s=-s,p=-p,m=-m,_=-_,v=-v),1-s>u?(n=Math.acos(s),a=Math.sin(n),o=Math.sin((1-i)*n)/a,h=Math.sin(i*n)/a):(o=1-i,h=i),t[0]=o*l+h*p,t[1]=o*c+h*m,t[2]=o*d+h*_,t[3]=o*f+h*v,t}function er(t){var e=c(),r=c(),i=c(),n=Math.sqrt(1-e),s=Math.sqrt(e);return t[0]=n*Math.sin(2*Math.PI*r),t[1]=n*Math.cos(2*Math.PI*r),t[2]=s*Math.sin(2*Math.PI*i),t[3]=s*Math.cos(2*Math.PI*i),t}function rr(t,e){var r=e[0],i=e[1],n=e[2],s=e[3],a=r*r+i*i+n*n+s*s,o=a?1/a:0;return t[0]=-r*o,t[1]=-i*o,t[2]=-n*o,t[3]=s*o,t}function ir(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function nr(t,e){var r,i=e[0]+e[4]+e[8];if(i>0)r=Math.sqrt(i+1),t[3]=.5*r,r=.5/r,t[0]=(e[5]-e[7])*r,t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r;else{var n=0;e[4]>e[0]&&(n=1),e[8]>e[3*n+n]&&(n=2);var s=(n+1)%3,a=(n+2)%3;r=Math.sqrt(e[3*n+n]-e[3*s+s]-e[3*a+a]+1),t[n]=.5*r,r=.5/r,t[3]=(e[3*s+a]-e[3*a+s])*r,t[s]=(e[3*s+n]+e[3*n+s])*r,t[a]=(e[3*a+n]+e[3*n+a])*r}return t}function sr(t,e,r,i){var n=.5*Math.PI/180;e*=n,r*=n,i*=n;var s=Math.sin(e),a=Math.cos(e),o=Math.sin(r),h=Math.cos(r),u=Math.sin(i),l=Math.cos(i);return t[0]=s*h*l-a*o*u,t[1]=a*o*l+s*h*u,t[2]=a*h*u-s*o*l,t[3]=a*h*l+s*o*u,t}function ar(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}var or,hr,ur,lr,cr,dr,fr,pr=se,mr=ae,_r=oe,vr=he,gr=ue,yr=We,wr=ge,Mr=Ie,xr=Se,br=xe,Er=br,Ar=be,Tr=Ar,Ir=Te,Rr=Ne,Sr=Pe,Dr=(or=ut(),hr=dt(1,0,0),ur=dt(0,1,0),function(t,e,r){var i=Lt(e,r);return i<-.999999?(Ot(or,hr,e),ee(or)<1e-6&&Ot(or,ur,e),kt(or,or),Ke(t,or,Math.PI),t):i>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(Ot(or,e,r),t[0]=or[0],t[1]=or[1],t[2]=or[2],t[3]=1+i,Ir(t,t))}),kr=(lr=Ye(),cr=Ye(),function(t,e,r,i,n,s){return tr(lr,e,n,s),tr(cr,r,i,s),tr(t,lr,cr,2*s*(1-s)),t}),Lr=(dr=new l(9),l!=Float32Array&&(dr[1]=0,dr[2]=0,dr[3]=0,dr[5]=0,dr[6]=0,dr[7]=0),dr[0]=1,dr[4]=1,dr[8]=1,fr=dr,function(t,e,r,i){return fr[0]=r[0],fr[3]=r[1],fr[6]=r[2],fr[1]=i[0],fr[4]=i[1],fr[7]=i[2],fr[2]=-e[0],fr[5]=-e[1],fr[8]=-e[2],Ir(t,nr(t,fr))});function Or(){var t=new l(2);return l!=Float32Array&&(t[0]=0,t[1]=0),t}function Fr(t){var e=new l(2);return e[0]=t[0],e[1]=t[1],e}function Nr(t,e){var r=new l(2);return r[0]=t,r[1]=e,r}function Pr(t,e){return t[0]=e[0],t[1]=e[1],t}function Br(t,e,r){return t[0]=e,t[1]=r,t}function Cr(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t}function Ur(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t}function zr(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t}function jr(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t}function qr(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t}function Vr(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t}function Xr(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t}function Yr(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t}function Hr(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t}function Kr(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t}function Gr(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t}function Wr(t,e){var r=e[0]-t[0],i=e[1]-t[1];return Math.sqrt(r*r+i*i)}function $r(t,e){var r=e[0]-t[0],i=e[1]-t[1];return r*r+i*i}function Qr(t){var e=t[0],r=t[1];return Math.sqrt(e*e+r*r)}function Zr(t){var e=t[0],r=t[1];return e*e+r*r}function Jr(t,e){return t[0]=-e[0],t[1]=-e[1],t}function ti(t,e){return t[0]=1/e[0],t[1]=1/e[1],t}function ei(t,e){var r=e[0],i=e[1],n=r*r+i*i;return n>0&&(n=1/Math.sqrt(n)),t[0]=e[0]*n,t[1]=e[1]*n,t}function ri(t,e){return t[0]*e[0]+t[1]*e[1]}function ii(t,e,r){var i=e[0]*r[1]-e[1]*r[0];return t[0]=t[1]=0,t[2]=i,t}function ni(t,e,r,i){var n=e[0],s=e[1];return t[0]=n+i*(r[0]-n),t[1]=s+i*(r[1]-s),t}function si(t,e){e=e||1;var r=2*c()*Math.PI;return t[0]=Math.cos(r)*e,t[1]=Math.sin(r)*e,t}function ai(t,e,r){var i=e[0],n=e[1];return t[0]=r[0]*i+r[2]*n,t[1]=r[1]*i+r[3]*n,t}function oi(t,e,r){var i=e[0],n=e[1];return t[0]=r[0]*i+r[2]*n+r[4],t[1]=r[1]*i+r[3]*n+r[5],t}function hi(t,e,r){var i=e[0],n=e[1];return t[0]=r[0]*i+r[3]*n+r[6],t[1]=r[1]*i+r[4]*n+r[7],t}function ui(t,e,r){var i=e[0],n=e[1];return t[0]=r[0]*i+r[4]*n+r[12],t[1]=r[1]*i+r[5]*n+r[13],t}function li(t,e,r,i){var n=e[0]-r[0],s=e[1]-r[1],a=Math.sin(i),o=Math.cos(i);return t[0]=n*o-s*a+r[0],t[1]=n*a+s*o+r[1],t}function ci(t,e){var r=t[0],i=t[1],n=e[0],s=e[1],a=r*r+i*i;a>0&&(a=1/Math.sqrt(a));var o=n*n+s*s;o>0&&(o=1/Math.sqrt(o));var h=(r*n+i*s)*a*o;return h>1?0:h<-1?Math.PI:Math.acos(h)}function di(t){return t[0]=0,t[1]=0,t}function fi(t){return"vec2("+t[0]+", "+t[1]+")"}function pi(t,e){return t[0]===e[0]&&t[1]===e[1]}function mi(t,e){var r=t[0],i=t[1],n=e[0],s=e[1];return Math.abs(r-n)<=u*Math.max(1,Math.abs(r),Math.abs(n))&&Math.abs(i-s)<=u*Math.max(1,Math.abs(i),Math.abs(s))}var _i,vi=Qr,gi=Ur,yi=zr,wi=jr,Mi=Wr,xi=$r,bi=Zr,Ei=function(){var t=Or();return function(e,r,i,n,s,a){var o,h;for(r||(r=2),i||(i=0),h=n?Math.min(n*r+i,e.length):e.length,o=i;o<h;o+=r)t[0]=e[o],t[1]=e[o+1],s(t,t,a),e[o]=t[0],e[o+1]=t[1];return e}}();!function(t){t.FOV=60,t.SHADOW_DISTANCE=30,t.keys=[],t.mouse_keys=[],t.mouse_x_total=0,t.mouse_y_total=0,t.is_mobile=!1,t.poor_performance=!1,t.toggled_performance=!1,t.TIME_SCALE_COUNT=10,t.TIME_SCALES=[50,20,10,4,2,1,.5,.25,.1,.05,.01],t.time_scale_id=5,t.shadow_factor=.4,t.shadow_offset=4,t.updateProgressText=async function(t){document.getElementById("loading-text").innerText=t+"..."},t.resetMousePosition=function(){t.mouse_x_total=0,t.mouse_y_total=0}}(_i||(_i={}));let Ai=r(1);class Ti{constructor(t,e=0,r=0){this.mesh=t,this.radius=e,this.half_height=r,this.initialized=!1,this.rotation_offset=0}init(t){this.VAO=t.createVertexArray(),Ai.initMeshBuffers(t,this.mesh),t.bindVertexArray(this.VAO),t.enableVertexAttribArray(0),t.bindBuffer(t.ARRAY_BUFFER,this.mesh.vertexBuffer),t.vertexAttribPointer(0,3,t.FLOAT,!1,0,0),t.enableVertexAttribArray(1),t.bindBuffer(t.ARRAY_BUFFER,this.mesh.textureBuffer),t.vertexAttribPointer(1,2,t.FLOAT,!0,0,0),t.enableVertexAttribArray(2),t.bindBuffer(t.ARRAY_BUFFER,this.mesh.normalBuffer),t.vertexAttribPointer(2,3,t.FLOAT,!1,0,0),this.initAllTextures(t),this.initialized=!0}initTexture(t,e){!e.image||e.image.failed||e.texture?e.texture=_i.EMPTY_TEXTURE:e.image.complete?e.texture=this.createTexture(t,e.image):(e.texture=_i.EMPTY_TEXTURE,e.image.addEventListener("load",()=>{e.texture=this.createTexture(t,e.image),delete e.image},{once:!0}))}initAllTextures(t){for(let e in this.mesh.materialsByIndex){let r=this.mesh.materialsByIndex[e];r.texturesInitialized||(r.mapDiffuse&&this.initTexture(t,r.mapDiffuse),r.mapAmbient&&this.initTexture(t,r.mapAmbient),r.mapEmissive&&this.initTexture(t,r.mapEmissive),r.mapTransparency&&this.initTexture(t,r.mapTransparency),r.mapSpecular&&this.initTexture(t,r.mapSpecular),r.mapSpecularExponent&&this.initTexture(t,r.mapSpecularExponent),r.texturesInitialized=!0)}}draw(t,e){this.activateBuffers(t);for(let r in this.mesh.materialsByIndex){let i=parseInt(r),n=this.mesh.vertexBuffer.itemSize,s=this.mesh.submesh[i];const a=2;this.activateMaterial(e,i),t.drawElements(t.TRIANGLES,n*s.numItems,t.UNSIGNED_SHORT,s.offset*n*a)}t.bindVertexArray(null)}activateBuffers(t){t.bindVertexArray(this.VAO),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.mesh.indexBuffer)}drawActivatedMaterial(t,e){let r=this.mesh.vertexBuffer.itemSize,i=this.mesh.submesh[e];t.drawElements(t.TRIANGLES,r*i.numItems,t.UNSIGNED_SHORT,i.offset*r*2)}activateMaterial(t,e){let r=this.mesh.materialsByIndex[e];t.activateMaterial(r)}createTexture(t,e,r=!0){let i=t.createTexture();return t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,i),r&&t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!0),t.texImage2D(t.TEXTURE_2D,0,t.RGB,t.RGB,t.UNSIGNED_BYTE,e),t.generateMipmap(t.TEXTURE_2D),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR_MIPMAP_LINEAR),i}}var Ii=r(1),Ri=r(2);let Si=r(1);class Di extends Ti{constructor(t,e,r=0,i=0){Ri(t.vertices.size==e.vertices.size,"Meshes must have same order of vertices."),super(t,r,i),this.mesh2=e}init(t){super.init(t),Si.initMeshBuffers(t,this.mesh2),t.enableVertexAttribArray(3),t.bindBuffer(t.ARRAY_BUFFER,this.mesh2.vertexBuffer),t.vertexAttribPointer(3,3,t.FLOAT,!1,0,0),t.enableVertexAttribArray(4),t.bindBuffer(t.ARRAY_BUFFER,this.mesh2.normalBuffer),t.vertexAttribPointer(4,3,t.FLOAT,!1,0,0)}draw(t,e,r=0){this.activateBuffers(t);for(let i in this.mesh.materialsByIndex){let n=parseInt(i),s=this.mesh.vertexBuffer.itemSize,a=this.mesh.submesh[n];this.activateMaterial(e,n),this.setTweenFactor(e,r);let o=2;t.drawElements(t.TRIANGLES,s*a.numItems,t.UNSIGNED_SHORT,a.offset*s*o)}e.setBoolByName("tween_enabled",!1),t.bindVertexArray(null)}setTweenFactor(t,e){e=Math.max(0,Math.min(e,1)),t.setBoolByName("tween_enabled",!0),t.setFloatByName("tween_factor",e)}}let ki=r(1);var Li,Oi,Fi,Ni;!function(t){t[t.Start=0]="Start",t[t.Run1=1]="Run1",t[t.Run2=2]="Run2",t[t.Run3=3]="Run3",t[t.Run4=4]="Run4",t[t.Run5=5]="Run5",t[t.StartReverse=6]="StartReverse"}(Li||(Li={})),function(t){t[t.Standing=0]="Standing",t[t.Jumping=1]="Jumping",t[t.Falling=2]="Falling",t[t.Running=3]="Running",t[t.Strafing=4]="Strafing",t[t.Reversing=5]="Reversing"}(Oi||(Oi={}));class Pi{constructor(){this.PLAYER_FOLDER="/assets/models/actors/cbabe/",this.state=Oi.Standing,this.time_into_frame=0,this.animation_rate=1,this.radius=.25,this.half_height=.8,this.model_run_offset=s.fromValues(0,-.075,0),this.run_frames=new Array(7);for(let t of this.run_frames)t={model:null,duration:null};this.run_frames[0]={model:null,duration:260},this.run_frames[1]={model:null,duration:260},this.run_frames[2]={model:null,duration:260},this.run_frames[3]={model:null,duration:350},this.run_frames[4]={model:null,duration:260},this.run_frames[5]={model:null,duration:260},this.run_frames[6]={model:null,duration:260},this.run_state=Li.Start}init(t){this.stand_model.init(t),this.jump_model.init(t),this.run_frames[0].model.init(t),this.run_frames[1].model.init(t),this.run_frames[2].model.init(t),this.run_frames[3].model.init(t),this.run_frames[4].model.init(t),this.run_frames[5].model.init(t),this.run_frames[6].model.init(t)}updateAnimation(t){let e=this.run_state;switch(this.state){case Oi.Running:case Oi.Strafing:this.time_into_frame+=t*this.animation_rate,this.time_into_frame>this.run_frames[e].duration&&(this.time_into_frame-=this.run_frames[e].duration,this.run_state=this.run_state+1,this.run_state>Li.Run5&&(this.run_state=Li.Run1));break;case Oi.Reversing:this.time_into_frame-=t*this.animation_rate,this.time_into_frame<0&&(this.run_state=this.run_state-1,this.run_state<Li.Run1&&(this.run_state=Li.Run5),e=this.run_state,this.time_into_frame+=this.run_frames[e].duration)}}draw(t,e,r,i,s,a){switch(this.state){case Oi.Running:case Oi.Strafing:case Oi.Reversing:n.translate(r,r,this.model_run_offset)}switch(e.setMVPMatrices(r,i,s,a),this.state){case Oi.Running:case Oi.Strafing:case Oi.Reversing:{let r=this.time_into_frame/this.run_frames[this.run_state].duration;this.run_frames[this.run_state].model.draw(t,e,r);break}case Oi.Standing:this.stand_model.draw(t,e);break;case Oi.Jumping:case Oi.Falling:this.jump_model.draw(t,e)}}setState(t){if(this.state!=t){switch(t){case Oi.Strafing:case Oi.Running:this.state!=Oi.Strafing&&this.state!=Oi.Running&&(this.time_into_frame=0,this.run_state=Li.Start);break;case Oi.Reversing:this.run_state=Li.StartReverse;let e=this.run_state.valueOf();this.time_into_frame=this.run_frames[e].duration}switch(t){case Oi.Reversing:case Oi.Strafing:this.animation_rate=.6;break;case Oi.Running:this.animation_rate=1}this.state=t}}async load(){let t=await ki.downloadModels([{name:"cbabe_stand",obj:this.PLAYER_FOLDER+"cbabe_stand.obj",downloadMtlTextures:!1},{name:"cbabe_jump",obj:this.PLAYER_FOLDER+"cbabe_jump.obj",downloadMtlTextures:!1},{name:"cbabe_run_start",obj:this.PLAYER_FOLDER+"cbabe_run_start.obj",downloadMtlTextures:!1},{name:"cbabe_run_loop0",obj:this.PLAYER_FOLDER+"cbabe_run_loop0.obj",downloadMtlTextures:!1},{name:"cbabe_run_loop1",obj:this.PLAYER_FOLDER+"cbabe_run_loop1.obj",downloadMtlTextures:!1},{name:"cbabe_run_loop2",obj:this.PLAYER_FOLDER+"cbabe_run_loop2.obj",downloadMtlTextures:!1},{name:"cbabe_run_loop3",obj:this.PLAYER_FOLDER+"cbabe_run_loop3.obj",downloadMtlTextures:!1},{name:"cbabe_run_loop4",obj:this.PLAYER_FOLDER+"cbabe_run_loop4.obj",downloadMtlTextures:!1}]),e=window.location.href.substr(0,window.location.href.lastIndexOf("/")),r=await(await fetch(e+this.PLAYER_FOLDER+"cbabe.mtl")).text(),i=new Ii.MaterialLibrary(r);await ki.downloadMtlTextures(i,e+this.PLAYER_FOLDER),t.cbabe_stand.addMaterialLibrary(i),t.cbabe_jump.addMaterialLibrary(i),t.cbabe_run_start.addMaterialLibrary(i),t.cbabe_run_loop0.addMaterialLibrary(i),t.cbabe_run_loop1.addMaterialLibrary(i),t.cbabe_run_loop2.addMaterialLibrary(i),t.cbabe_run_loop3.addMaterialLibrary(i),t.cbabe_run_loop4.addMaterialLibrary(i),this.stand_model=new Ti(t.cbabe_stand),this.jump_model=new Ti(t.cbabe_jump),this.run_frames[0].model=new Di(t.cbabe_run_start,t.cbabe_run_loop0),this.run_frames[1].model=new Di(t.cbabe_run_loop0,t.cbabe_run_loop1),this.run_frames[2].model=new Di(t.cbabe_run_loop1,t.cbabe_run_loop2),this.run_frames[3].model=new Di(t.cbabe_run_loop2,t.cbabe_run_loop3),this.run_frames[4].model=new Di(t.cbabe_run_loop3,t.cbabe_run_loop4),this.run_frames[5].model=new Di(t.cbabe_run_loop4,t.cbabe_run_loop0),this.run_frames[6].model=new Di(t.cbabe_run_loop0,t.cbabe_run_start)}}class Bi{static newGuid(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){let e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)})}}!function(t){t[t.BASIC=0]="BASIC",t[t.MESHLESS=1]="MESHLESS",t[t.ANIMATED=2]="ANIMATED"}(Fi||(Fi={}));class Ci{constructor(t,e,r=s.fromValues(0,0,0),i=s.fromValues(0,0,-1),n=s.fromValues(1,1,1)){this.up=s.fromValues(0,1,0),this.id=Bi.newGuid(),this.position=s.clone(r),this.scalar=s.clone(n),this.forward=s.clone(i),this.mesh_name=t,this.model_type=e}getRight(t){return s.cross(t,this.forward,this.up),t}}!function(t){let e=h.create(),r=h.create(),i=h.create(),n=h.create();t.barycentric=function(t,s,a,o,u){h.copy(r,e),h.copy(i,e),h.copy(n,e),h.sub(r,o,a),h.sub(i,u,a),h.sub(n,s,a);let l=h.dot(r,r),c=h.dot(r,i),d=h.dot(i,i),f=h.dot(n,r),p=h.dot(n,i),m=1/(l*d-c*c);return t[1]=(d*f-c*p)*m,t[2]=(l*p-c*f)*m,t[0]=1-t[1]-t[2],t},t.vec2_rotate=function(t,e,r){let i=Math.cos(r),n=Math.sin(r);return t[0]=i*e[0]-n*e[1],t[1]=n*e[0]+i*e[1],t},t.vec3_truncate=function(t,e,r){return t[0]=e[0],t[1]=e[1],t[2]=e[2],s.length(e)>r&&(s.normalize(t,t),t[0]*=r,t[1]*=r,t[2]*=r),t}}(Ni||(Ni={}));var Ui=Ni.vec2_rotate;const zi=12,ji=8,qi=3,Vi=25,Xi=10;let Yi=s.create(),Hi=s.create(),Ki=s.create(),Gi=h.create(),Wi=h.create(),$i=s.fromValues(0,-9.8,0),Qi=n.create(),Zi=o.create();class Ji extends Ci{constructor(){super("player",Fi.ANIMATED),this.velocity=s.create()}init(t){this.model.init(t)}getVelocity(){return this.velocity}draw(t,e,r,i,s){Ri(this.loaded),n.identity(Qi),o.identity(Zi),o.rotateY(Zi,Zi,Math.atan2(this.forward[0],this.forward[2])-Math.PI/2),n.fromRotationTranslation(Qi,Zi,this.position),this.model.draw(t,e,Qi,r,i,s)}updateAnimation(t){this.model.updateAnimation(t)}update(t,e){let r=e/1e3;s.copy(Yi,this.position),s.scaleAndAdd(Hi,this.position,this.velocity,r);let i=t.getHeightAtCirclePosition(Hi[0],Hi[2],this.model.radius),n=i+this.model.half_height;if(this.jumping)s.scaleAndAdd(this.velocity,this.velocity,$i,r),t.isCylinderCollisionWithDisk(Hi,this.model.radius,this.model.half_height)&&(t.isCylinderCollisionWithDisk(Yi,this.model.radius,this.model.half_height)?(this.jumping=!1,this.model.setState(Oi.Standing),this.velocity[1]=0,Hi[1]=n):(this.velocity[0]=this.velocity[2]=0,Hi[0]=Yi[0],Hi[2]=Yi[2]));else if(t.isOnDisk(Hi[0],Hi[2],this.model.radius)){Hi[1]=n,this.velocity[1]=0;let e=t.getFrictionAtPosition(Hi[0],Hi[2]);s.scale(this.velocity,this.velocity,Math.pow(e,r));let a=t.getSlopeFactorAtPosition(Hi[0],Hi[2]),o=i;h.set(Wi,0,0);for(let e=0;e<60;e++){h.set(Gi,1,0),Ui(Gi,Gi,2*Math.PI*(e/60));let r=t.getHeightAtPointPosition(Hi[0]+.01*Gi[0],Hi[2]+.01*Gi[1]);r<o&&(o=r,Wi=Gi)}let u=(i-o)/.01;if(u>a){let t=10*(u-a)*r;s.set(Ki,Wi[0],0,Wi[1]),s.scale(Ki,Ki,t),this.addAcceleration(Ki)}}else this.jumping=!0,this.model.setState(Oi.Falling);s.copy(this.position,Hi)}hitByBat(t){this.jumping?s.scaleAndAdd(this.velocity,this.velocity,s.normalize(t,t),7):(s.copy(this.velocity,t),this.velocity[1]=0,s.scale(this.velocity,s.normalize(this.velocity,this.velocity),5),this.velocity[1]=5,this.model.setState(Oi.Jumping),this.jumping=!0)}reset(t){s.copy(this.position,t.disks[0].position),this.position[1]=t.getHeightAtPointPosition(this.position[0],this.position[2])+this.model.half_height,s.set(this.velocity,0,0,0),this.jumping=!1}addAcceleration(t){this.jumping||s.add(this.velocity,this.velocity,t)}jump(){this.jumping||(s.set(this.velocity,0,zi,0),s.scaleAndAdd(this.velocity,this.velocity,this.forward,ji),this.model.setState(Oi.Jumping),this.jumping=!0)}rotate(t){s.rotateY(this.forward,this.forward,[0,0,0],2*t)}accelerateForward(t,e){s.copy(Ki,this.forward),s.scale(Ki,Ki,Vi*t/1e3*e),this.addAcceleration(Ki)}accelerateBackward(t,e){s.copy(Ki,this.forward),s.negate(Ki,Ki),s.scale(Ki,Ki,Vi*t/1e3*e),this.addAcceleration(Ki)}accelerateLeft(t,e){Ki=this.getRight(Ki),s.negate(Ki,Ki),s.scale(Ki,Ki,Xi*t/1e3*e),this.addAcceleration(Ki)}accelerateRight(t,e){Ki=this.getRight(Ki),s.scale(Ki,Ki,Xi*t/1e3*e),this.addAcceleration(Ki)}turnLeft(t){let e=qi*t/1e3;s.rotateY(this.forward,this.forward,[0,0,0],e)}turnRight(t){let e=qi*t/1e3;s.rotateY(this.forward,this.forward,[0,0,0],-e)}transitionAnimationTo(t){this.jumping||this.model.setState(t)}async loadAssets(){this.model=new Pi,await this.model.load(),this.loaded=!0,this.radius=this.model.radius,this.half_height=this.model.half_height}}class tn{constructor(t,e,r){this.data=t,this.indices=e,this.stride=8,this.name="height_map_model_"+gn.height_map_model_gen_count,this.material=r,Ri(this.material.texturesInitialized),this.rotation_offset=0}init(t){this.VAO=t.createVertexArray(),this.buffer=t.createBuffer(),this.index_buffer=t.createBuffer(),t.bindVertexArray(this.VAO),t.bindBuffer(t.ARRAY_BUFFER,this.buffer),t.bufferData(t.ARRAY_BUFFER,this.data,t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.index_buffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.indices,t.STATIC_DRAW),t.enableVertexAttribArray(0),t.vertexAttribPointer(0,3,t.FLOAT,!1,4*this.stride,0),t.enableVertexAttribArray(1),t.vertexAttribPointer(1,2,t.FLOAT,!0,4*this.stride,12),t.enableVertexAttribArray(2),t.vertexAttribPointer(2,3,t.FLOAT,!0,4*this.stride,20),t.bindBuffer(t.ARRAY_BUFFER,null),t.bindVertexArray(null),this.texture=this.material.mapDiffuse.texture,this.initialized=!0}activateBuffers(t){t.bindVertexArray(this.VAO),t.bindBuffer(t.ARRAY_BUFFER,this.buffer),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.index_buffer)}activateMaterial(t,e){e.activateMaterial(this.material)}draw(t,e){this.activateBuffers(t),this.activateMaterial(t,e),this.drawActivatedMaterial(t)}drawActivatedMaterial(t){t.drawElements(t.TRIANGLES,this.indices.length,t.UNSIGNED_SHORT,0)}}class en{constructor(t,e,r,i,n,s,a,o,h){this.GRID_SIZE=t,this.amplitude=e,this.SEED_X1=r,this.SEED_X2=i,this.SEED_Y1=n,this.SEED_Y2=s,this.SEED_Q0=a,this.SEED_Q1=o,this.SEED_Q2=h}pseudorandom(t,e){let r=this.SEED_X1*t+this.SEED_Y1*e;return this.SEED_Q2*r*r+this.SEED_Q1*r+this.SEED_Q0+this.SEED_X2*t+this.SEED_Y2*e}fade(t){return t*t*t*t*t*6-t*t*t*t*15+t*t*t*10}lattice(t,e){let r=2*this.pseudorandom(t,e)*Math.PI;return{x:Math.cos(r),y:Math.sin(r)}}perlineNoise(t,e){let r=Math.floor(t/this.GRID_SIZE),i=Math.floor(e/this.GRID_SIZE),n=t/this.GRID_SIZE-r,s=e/this.GRID_SIZE-i,a=r+1,o=i+1,h=this.lattice(r,i),u=this.lattice(r,o),l=this.lattice(a,i),c=this.lattice(a,o),d={x:-n,y:-s},f={x:-n,y:1-s},p={x:1-n,y:-s},m={x:1-n,y:1-s},_=this.dotProduct(h,d),v=this.dotProduct(u,f),g=this.dotProduct(l,p),y=this.dotProduct(c,m),w=this.fade(n),M=this.fade(s),x=1-M;return((_*x+v*M)*(1-w)+(g*x+y*M)*w)*this.amplitude}dotProduct(t,e){return t.x*e.x+t.y*e.y}}var rn,nn;!function(t){t.randi=function(t){return Math.floor(Math.random()*Math.floor(t))},t.randf=function(t,e){return Math.random()*(e-t)+t}}(rn||(rn={})),function(t){t[t.RED_ROCK=0]="RED_ROCK",t[t.LEAFY=1]="LEAFY",t[t.ICY=2]="ICY",t[t.SANDY=3]="SANDY",t[t.GREY_ROCK=4]="GREY_ROCK"}(nn||(nn={}));const sn=16,an=32,on=48,hn=64,un=80;let ln=s.create(),cn=s.create(),dn=s.create(),fn=s.create(),pn=h.create(),mn=h.create(),_n=h.create(),vn=h.create();class gn extends Ci{constructor(t,e,r,i,n,a){if(super(t.mesh.name,Fi.BASIC,s.fromValues(i,n,a),s.fromValues(0,0,0),s.fromValues(r,1,r)),!t.initialized)throw"DiskModel was not initialized";this.model=t,this.radius=r,this.type=e,this.initialized=!1}init(t){this.generateHeightMapModels(t),this.heightMapModel.init(t);let e=this.radius*Math.SQRT2/2,r=s.fromValues(2*e/this.heightMapSize,1,2*e/this.heightMapSize),i=s.fromValues(this.position[0],this.position[1]+1e-4,this.position[2]);this.heightMapEntity=new Ci(this.heightMapModel.name,Fi.MESHLESS,i,this.forward,r),gn.height_map_model_gen_count++,this.initialized=!0}generateHeightMapModels(t){switch(this.type){case nn.RED_ROCK:this.heightMapSize=sn,this.initRedRockHeightMap();break;case nn.LEAFY:this.heightMapSize=an,this.initLeafyHeightMap();break;case nn.ICY:this.heightMapSize=on,this.initIcyHeightMap();break;case nn.SANDY:this.heightMapSize=hn,this.initSandyHeightMap();break;case nn.GREY_ROCK:this.heightMapSize=un,this.initGreyRockHeightMap()}this.generateHeightMapModel(t)}generateHeightMapModel(t){let e=(this.heightMapSize+1)*(this.heightMapSize+1),r=new Float32Array(8*e),i=0;for(let t=0;t<this.heightMapSize+1;t++)for(let e=0;e<this.heightMapSize+1;e++)r[i++]=t-this.heightMapSize/2,r[i++]=this.heightMap[t][e]+1e-5,r[i++]=e-this.heightMapSize/2,r[i++]=t/16,r[i++]=e/16,r[i++]=0,r[i++]=0,r[i++]=0;let n=this.heightMapSize*this.heightMapSize*6,s=new Uint16Array(n);i=0;for(let t=0;t<e-(this.heightMapSize+1);t+=this.heightMapSize+1)for(let e=0;e<this.heightMapSize;e++){const r=t+e;s[i++]=r+(this.heightMapSize+1),s[i++]=r,s[i++]=r+(this.heightMapSize+1)+1,s[i++]=r+(this.heightMapSize+1)+1,s[i++]=r,s[i++]=r+1}for(let t=0;t<n-2;t+=3){const e=8*s[t],i=8*s[t+1],n=8*s[t+2];let a=new Array(3);const o=r[i]-r[e],h=r[i+1]-r[e+1],u=r[i+2]-r[e+2],l=r[n]-r[e],c=r[n+1]-r[e+1],d=r[n+2]-r[e+2];a[0]=h*d-u*c,a[1]=u*l-o*d,a[2]=o*c-h*l,r[e+5]+=a[0],r[e+6]+=a[1],r[e+7]+=a[2],r[i+5]+=a[0],r[i+6]+=a[1],r[i+7]+=a[2],r[n+5]+=a[0],r[n+6]+=a[1],r[n+7]+=a[2]}this.heightMapModel=new tn(r,s,this.model.mesh.materialsByIndex[2])}initRedRockHeightMap(){this.heightMap=[];let t=[];t.push(0,0);for(let e=2;e<=this.heightMapSize/2;e++){let r=t[e-1];t.push(Math.round(10*(r+3*Math.random()-1))/10)}for(let e=0;e<=this.heightMapSize;e++){this.heightMap[e]=[];let r=e>this.heightMapSize/2?this.heightMapSize-e:e;for(let i=0;i<=this.heightMapSize;i++){i>this.heightMapSize-r&&r--;let n=i;n>r&&(n=r),this.heightMap[e].push(t[n])}}}initSandyHeightMap(){this.heightMap=[];let t=new en(16,8,rn.randi(4294967295),rn.randi(4294967295),rn.randi(4294967295),rn.randi(4294967295),rn.randi(4294967295),rn.randi(4294967295),rn.randi(4294967295)),e=new Array(this.heightMapSize+1),r=1-Math.pow(.5,6);for(let t=0;t<=this.heightMapSize;t++){let r=t/this.heightMapSize;e[t]=Math.max(Math.pow(r,6),Math.pow(1-r,6))}for(let i=0;i<=this.heightMapSize;i++){this.heightMap[i]=[];for(let n=0;n<=this.heightMapSize;n++){let s=t.perlineNoise(n,i),a=(1-Math.max(e[i],e[n]))/r;this.heightMap[i].push(s*a)}}}initGreyRockHeightMap(){this.heightMap=[];let t=[new en(32,1,rn.randi(4294967295),rn.randi(4294967295),rn.randi(4294967295),rn.randi(4294967295),rn.randi(4294967295),rn.randi(4294967295),rn.randi(4294967295)),new en(16,7,rn.randi(4294967295),rn.randi(4294967295),rn.randi(4294967295),rn.randi(4294967295),rn.randi(4294967295),rn.randi(4294967295),rn.randi(4294967295)),new en(8,5,rn.randi(4294967295),rn.randi(4294967295),rn.randi(4294967295),rn.randi(4294967295),rn.randi(4294967295),rn.randi(4294967295),rn.randi(4294967295)),new en(4,3.5,rn.randi(4294967295),rn.randi(4294967295),rn.randi(4294967295),rn.randi(4294967295),rn.randi(4294967295),rn.randi(4294967295),rn.randi(4294967295)),new en(2,2.5,rn.randi(4294967295),rn.randi(4294967295),rn.randi(4294967295),rn.randi(4294967295),rn.randi(4294967295),rn.randi(4294967295),rn.randi(4294967295))];for(let e=0;e<=this.heightMapSize;e++){this.heightMap[e]=[];for(let r=0;r<=this.heightMapSize;r++){let i=t[0].perlineNoise(r,e)+t[1].perlineNoise(r,e)+t[2].perlineNoise(r,e)+t[3].perlineNoise(r,e)+t[4].perlineNoise(r,e),n=e/this.heightMapSize,s=r/this.heightMapSize,a=(1-Math.max(Math.max(Math.pow(n,6),Math.pow(1-n,6)),Math.max(Math.pow(s,6),Math.pow(1-s,6))))/(1-Math.pow(.5,6));this.heightMap[e].push(i*a)}}}initIcyHeightMap(){let t=[],e=this.heightMapSize/2;for(let r=0;r<200;r++){let r=Math.random()*e,i=Math.random()*e,n=Math.random()*e,s=Math.random()*e,a=Math.max(r,i,n,s),o=Math.random()*Math.PI*2,h=e+Math.cos(o)*a,u=e+Math.sin(o)*a,l=.7*(e-a),c=Math.random()*(l+l)-l;t.push([h,c,u])}this.heightMap=new Array(this.heightMapSize+1);for(let e=0;e<=this.heightMapSize;e++){this.heightMap[e]=new Array(this.heightMapSize+1);for(let r=0;r<=this.heightMapSize;r++){let i=0,n=0;for(let s=0;s<t.length;s++){let a=(t[s][0]-e)*(t[s][0]-e),o=(t[s][2]-r)*(t[s][2]-r),h=Math.sqrt(a+o);n=Math.max(n,t[s][1]-h),i=Math.min(i,t[s][1]+h)}this.heightMap[e][r]=n+i}}}initLeafyHeightMap(){let t=2*Math.random()-1,e=2*Math.random()-1,r=2*Math.random()-1,i=2*Math.random()-1,n=2*Math.random()-1,s=2*Math.random()-1,a=rn.randi(7),o=rn.randi(7),h=a<o?a:o,u=Math.random()*(2*Math.PI),l=Math.random(),c=Math.random(),d=Math.random();Math.random()>.5&&(l=-l,c=-c,d=-d),this.heightMap=new Array(this.heightMapSize+1);for(let a=0;a<=this.heightMapSize;a++){this.heightMap[a]=new Array(this.heightMapSize+1);for(let o=0;o<=this.heightMapSize;o++){let f=a/this.heightMapSize,p=2*f-1,m=2*(o/this.heightMapSize)-1,_=Math.min(Math.sqrt(p*p+m*m),1),v=Math.atan2(m,p),g=Math.pow(f,4)*(1-f)*12*t+.5*(Math.cos(Math.PI*p)+1)*e+Math.pow(1-f,4)*f*12*r,y=Math.pow(Math.max(1-_,0),2)*i+Math.sin(Math.PI*Math.min(Math.pow(_,.8)*(4/3),1))*n+Math.max(Math.sin(Math.PI*Math.pow(_,1.6)),0)*s,w=4*(Math.sqrt(_)-_)*l+Math.pow(_,2)*Math.pow(1-_,2)*16*c+4*(Math.sqrt(1-_)-(1-_))*d,M=g*y,x=v*h+u,b=.5*(Math.sin(x)+1)*w;this.heightMap[a][o]=5*M+3*b}}}getSpeedFactor(){switch(this.type){case nn.RED_ROCK:return 1;case nn.LEAFY:return.5;case nn.ICY:return.25;case nn.SANDY:return.75;case nn.GREY_ROCK:return 1}return 1}getAccelFactor(){switch(this.type){case nn.RED_ROCK:return 1;case nn.LEAFY:return.5;case nn.ICY:case nn.SANDY:return.25;case nn.GREY_ROCK:return 1}return 1}getFriction(){switch(this.type){case nn.RED_ROCK:return.005;case nn.LEAFY:return 1e-4;case nn.ICY:return.5;case nn.SANDY:return.2;case nn.GREY_ROCK:return.005}return 1e-4}getSlopeFactor(){switch(this.type){case nn.RED_ROCK:return.4;case nn.LEAFY:return 1;case nn.ICY:case nn.SANDY:return.2;case nn.GREY_ROCK:return.4}return 1}getHeightAtPosition(t,e){let r=(t-this.position[0])*(this.heightMapSize/2)/(this.radius*Math.SQRT1_2)+this.heightMapSize/2,i=(e-this.position[2])*(this.heightMapSize/2)/(this.radius*Math.SQRT1_2)+this.heightMapSize/2;if(r>this.heightMapSize||r<0||i>this.heightMapSize||i<0)return 0;let n,a=Math.floor(r),o=Math.floor(i),u=r-a,l=i-o;return s.set(ln,0,0,0),s.set(cn,a,this.heightMap[a][o],o),s.set(dn,a+1,this.heightMap[a+1][o+1],o+1),u>l?s.set(ln,a+1,this.heightMap[a+1][o],o):s.set(ln,a,this.heightMap[a][o+1],o+1),h.set(pn,r,i),h.set(mn,ln[0],ln[2]),h.set(_n,cn[0],cn[2]),h.set(vn,dn[0],dn[2]),Ni.barycentric(fn,pn,mn,_n,vn),n=fn[0]*ln[1]+fn[1]*cn[1]+fn[2]*dn[1]}}var yn;gn.height_map_model_gen_count=0,function(t){function e(t,e,r,i,n,s){let a=t-i,o=e-n;return a*a+o*o<=(r+s)*(r+s)}t.circleIntersection=e,t.pointCircleIntersection=function(t,r,i,n,s){return e(t,r,0,i,n,s)},t.cylinderIntersection=function(t,r,i,n,s,a){let o=i,h=a;return!(t[1]+o<n[1]-h||t[1]-o>n[1]+h)&&e(t[0],t[2],r,n[0],n[2],s)}}(yn||(yn={}));let wn=r(1);class Mn{constructor(t,e){if(this.disks=[],!Mn.loaded)throw"World loadAssets must be called before constructor.";Mn.world_meshes.DiskA.addMaterialLibrary(Mn.world_mat_lib),Mn.world_meshes.DiskB.addMaterialLibrary(Mn.world_mat_lib),Mn.world_meshes.DiskC.addMaterialLibrary(Mn.world_mat_lib),Mn.world_meshes.DiskD.addMaterialLibrary(Mn.world_mat_lib),Mn.world_meshes.DiskE.addMaterialLibrary(Mn.world_mat_lib),this.diskA_model=new Ti(Mn.world_meshes.DiskA),this.diskB_model=new Ti(Mn.world_meshes.DiskB),this.diskC_model=new Ti(Mn.world_meshes.DiskC),this.diskD_model=new Ti(Mn.world_meshes.DiskD),this.diskE_model=new Ti(Mn.world_meshes.DiskE),this.diskA_model.init(t),this.diskB_model.init(t),this.diskC_model.init(t),this.diskD_model.init(t),this.diskE_model.init(t),this.init(t,e)}init(t,e){let r=Date.now();const i=e.split("\n");-1==i[0].indexOf("version 1")&&console.warn("Can't read Disk World File"),this.world_radius=parseInt(i[1]);let n=parseInt(i[2]);i.splice(0,3);for(let e=0;e<n;e++){let r=i[e].split("\t"),n=parseFloat(r[0]),s=parseFloat(r[1]),a=parseFloat(r[2]),o=null,h=null;switch(!0){case a<8:o=this.diskA_model,h=nn.RED_ROCK;break;case a<=12:o=this.diskB_model,h=nn.LEAFY;break;case a<=20:o=this.diskC_model,h=nn.ICY;break;case a<=30:o=this.diskD_model,h=nn.SANDY;break;case a>30:o=this.diskE_model,h=nn.GREY_ROCK}if(!o)throw"No Disk Model found for radius: "+a;let u=new gn(o,h,a,n,0,s);u.init(t),this.disks.push(u)}console.log("world gen time: "+(Date.now()-r)/1e3+"s")}destroy(){this.disks=[]}getSpeedFactorAtPosition(t,e,r=0){for(let i=0;i<this.disks.length;i++)if(yn.circleIntersection(t,e,r,this.disks[i].position[0],this.disks[i].position[2],this.disks[i].radius))return this.disks[i].getSpeedFactor();return 1}getAccelFactorAtPosition(t,e,r=0){for(let i=0;i<this.disks.length;i++)if(yn.circleIntersection(t,e,r,this.disks[i].position[0],this.disks[i].position[2],this.disks[i].radius))return this.disks[i].getAccelFactor();return 1}getRandomDiskPosition(){if(0===this.disks.length)throw"There are no disks???";let t=rn.randi(this.disks.length-1);return this.disks[t].position}getRandomXZPosition(t){let e=Math.sqrt(rn.randf(0,1))*this.world_radius,r=rn.randf(0,2*Math.PI);return t[0]=e*Math.cos(r),t[1]=0,t[2]=e*Math.sin(r),t}getHeightAtPointPosition(t,e){return this.getHeightAtCirclePosition(t,e,0)}getHeightAtCirclePosition(t,e,r){for(let i=0;i<this.disks.length;i++)if(yn.circleIntersection(t,e,r,this.disks[i].position[0],this.disks[i].position[2],this.disks[i].radius))return this.disks[i].getHeightAtPosition(t,e);return 0}getSlopeFactorAtPosition(t,e){for(let r of this.disks)if(yn.circleIntersection(t,e,0,r.position[0],r.position[2],r.radius))return r.getSlopeFactor();return 1e-4}getFrictionAtPosition(t,e){for(let r of this.disks)if(yn.circleIntersection(t,e,0,r.position[0],r.position[2],r.radius))return r.getFriction();return 1e-4}isOnDisk(t,e,r=0){for(let i of this.disks)if(yn.circleIntersection(t,e,r,i.position[0],i.position[2],i.radius))return!0}isCylinderCollisionWithDisk(t,e,r){for(let i of this.disks)if(yn.circleIntersection(t[0],t[2],e,i.position[0],i.position[2],i.radius)){let e=this.getHeightAtPointPosition(t[0],t[2]);if(t[1]-r<=e)return!0}return!1}static async loadAssets(){this.world_meshes=await this.loadWorldMeshes(),this.world_mat_lib=await this.loadWorldMat(),this.loaded=!0}static async loadWorldMeshes(){return wn.downloadModels([{name:"DiskA",obj:"/assets/models/environment/disks/DiskA.obj",downloadMtlTextures:!1},{name:"DiskB",obj:"/assets/models/environment/disks/DiskB.obj",downloadMtlTextures:!1},{name:"DiskC",obj:"/assets/models/environment/disks/DiskC.obj",downloadMtlTextures:!1},{name:"DiskD",obj:"/assets/models/environment/disks/DiskD.obj",downloadMtlTextures:!1},{name:"DiskE",obj:"/assets/models/environment/disks/DiskE.obj",downloadMtlTextures:!1}])}static async loadWorldMat(){let t=new Ii.MaterialLibrary(r(21).default);return await wn.downloadMtlTextures(t,window.location.href.substr(0,window.location.href.lastIndexOf("/"))+"/assets/models/environment/disks/"),t}}let xn=s.create(),bn=s.create(),En=s.create(),An=s.create(),Tn=s.create();class In extends Ci{constructor(t,e,r,i){super(i.mesh.name,Fi.BASIC),this.radius=.7,this.half_height=.1,this.picked_up=!1,this.index=t,this.world=e,this.world_graph=r,this.curr_node_id=rn.randi(this.world_graph.getNodeList().length-1),this.target_node_id=this.curr_node_id,this.target_position=s.clone(this.world_graph.getNodeList()[this.target_node_id].pos),this.position=s.clone(this.target_position),this.path=[],this.radius=i.radius,this.half_height=i.half_height}update(t){s.sub(xn,this.target_position,this.position),s.normalize(xn,xn);let e=this.world.getSpeedFactorAtPosition(this.position[0],this.position[2])/1e3,r=In.speed*t*e,i=this.world_graph.getNodeList();if(i[this.curr_node_id].disk_id===i[this.target_node_id].disk_id){s.copy(bn,this.world.disks[i[this.curr_node_id].disk_id].position),s.sub(En,this.position,bn),s.sub(An,this.target_position,this.position),Tn=s.rotateY(Tn,En,[0,0,0],Math.PI/2);let t=s.angle(Tn,An),e=this.world.disks[i[this.curr_node_id].disk_id].radius-.7,n=r/e;t<Math.PI/2?s.rotateY(En,En,[0,0,0],n):s.rotateY(En,En,[0,0,0],-n),s.scaleAndAdd(this.position,bn,s.normalize(En,En),e)}else s.scaleAndAdd(this.position,this.position,xn,r);let n=In.rotation_speed*r;if(s.rotateY(this.forward,this.forward,[0,0,0],n),this.position[1]=this.world.getHeightAtCirclePosition(this.position[0],this.position[2],this.radius)+this.half_height,yn.pointCircleIntersection(this.target_position[0],this.target_position[2],this.position[0],this.position[2],.2)){if(this.curr_node_id=this.target_node_id,0==this.path.length){let t=rn.randi(i.length-1);for(;t==this.curr_node_id;)t=rn.randi(i.length-1);0===this.index?(this.path=this.world_graph.mmSearch(this.curr_node_id,t),this.world_graph.memorizeLastSearch()):this.path=this.world_graph.mmSearch(this.curr_node_id,t)}this.target_node_id=this.path.shift(),s.copy(this.target_position,i[this.target_node_id].pos)}}}In.point_value=1,In.speed=2.5,In.rotation_speed=1.3;class Rn extends Ci{constructor(t,e,r){super(t.mesh.name,Fi.BASIC,e),this.picked_up=!1,this.radius=.1,this.half_height=1,this.position=e,this.point_value=r,this.radius=t.radius,this.half_height=t.half_height}update(t){}}class Sn{constructor(t,e,r,i){this.rod_model=r,this.ring_model=i,this.init(t,e)}init(t,e){this.score=0,this.rings=[],this.rods=[];for(let r of t.disks){let i=s.clone(r.position);i[1]=t.getHeightAtPointPosition(i[0],i[2]),this.addRod(i,r.type+1),this.addRing(t,e)}}update(t){for(let e of this.rings)e.picked_up||e.update(t)}checkForPickupsCylinderIntersection(t,e,r,i){for(let n of this.rings)n.picked_up||yn.cylinderIntersection(t,e,r,n.position,n.radius,n.half_height)&&(n.picked_up=!0,this.score+=In.point_value,i.removeEntity(n));for(let n of this.rods)n.picked_up||yn.cylinderIntersection(t,e,r,n.position,n.radius,n.half_height)&&(n.picked_up=!0,this.score+=n.point_value,i.removeEntity(n))}addRod(t,e){this.rods.push(new Rn(this.rod_model,t,e))}addRing(t,e){this.rings.push(new In(this.rings.length,t,e,this.ring_model))}getScore(){return this.score}}const Dn=90,kn=0,Ln=20,On=.1,Fn=65;var Nn;!function(t){t[t.FORWARD=0]="FORWARD",t[t.BACKWARD=1]="BACKWARD",t[t.LEFT=2]="LEFT",t[t.RIGHT=3]="RIGHT"}(Nn||(Nn={}));let Pn=s.create();class Bn{constructor(t=s.fromValues(0,0,0),e=s.fromValues(0,1,0),r=Dn,i=kn){this.position=t,this.front=s.fromValues(0,0,-1),this.worldUp=e,this.right=s.create(),this.up=s.create(),this.movementSpeed=Ln,this.mouseSensitivity=On,this.zoom=Fn,this.yaw=r,this.pitch=i,this.updateCameraVectors()}getViewMatrix(t){return s.add(Pn,this.position,this.front),n.lookAt(t,this.position,Pn,this.up),t}lookAt(t){s.subtract(this.front,t,this.position),s.normalize(this.front,this.front)}getInverseViewMatrix(t){return s.add(Pn,this.position,this.front),n.lookAt(t,this.position,Pn,this.up),n.invert(t,t),t}processKeyboard(t,e){let r=this.movementSpeed*e,i=this.front,n=this.right;if(t==Nn.FORWARD){let t=s.create();s.scale(t,i,r),s.add(this.position,this.position,t)}if(t==Nn.BACKWARD){let t=s.create();s.scale(t,i,-r),s.add(this.position,this.position,t)}if(t==Nn.LEFT){let t=s.create();s.scale(t,n,-r),s.add(this.position,this.position,t)}if(t==Nn.RIGHT){let t=s.create();s.scale(t,n,r),s.add(this.position,this.position,t)}}processMouseMovement(t,e,r,i,n=!0){this.mouseSensitivity,i*=this.mouseSensitivity,this.pitch+=i;let s=Math.atan2(t[0],t[2]);s+=Math.PI,s=360-(s*=360/(2*Math.PI))-90,n&&(this.pitch>20&&(this.pitch=20),this.pitch<-20&&(this.pitch=-20),this.yaw>s+0&&(this.yaw=s+0),this.yaw<s-0&&(this.yaw=s-0)),this.updateCameraVectors()}updateCameraVectors(){let t=Math.cos(i.toRadian(this.yaw))*Math.cos(i.toRadian(this.pitch)),e=Math.sin(i.toRadian(this.pitch)),r=Math.sin(i.toRadian(this.yaw))*Math.cos(i.toRadian(this.pitch));s.normalize(this.front,s.set(this.front,t,e,r)),s.normalize(this.right,s.cross(this.right,this.front,this.worldUp)),s.normalize(this.up,s.cross(this.up,this.right,this.front))}}var Cn=r(6);const Un=Number.MAX_VALUE,zn=-1;class jn{constructor(){this.init()}init(){this.visited=!1,this.path_node=zn,this.given_cost=Un,this.heuristic=0,this.priority=Un}copy(t){this.visited=t.visited,this.path_node=t.path_node,this.given_cost=t.given_cost,this.heuristic=t.heuristic,this.priority=t.priority}}class qn{constructor(t=new jn,e=new jn){this.start=t,this.end=e}copy(t){this.start.copy(t.start),this.end.copy(t.end)}}class Vn{constructor(t,e){this.id=t,this.priority=e}}function Xn(t,e){return t.priority<e.priority?1:t.priority>e.priority?-1:0}class Yn{constructor(t,e,r,i){this.source_node_id=t,this.dest_node_id=e,this.disk_id=r,this.weight=i}}class Hn{constructor(t){this.collision_offset=.1,this.node_offset=.7,this.search_data=[],this.a_star_visits=0,this.dijkstra_visits=0,this.mm_visits=0,this.node_link_count=0,this.memorized_search_data=[],this.memorized_a_star_visits=0,this.memorized_dijkstra_visits=0,this.memorized_mm_visits=0,this.disk_node_list=[],this.node_list=[];let e=t.length;Ri(e>0),this.node_list=[],this.disk_node_list=Array(...Array(e)).map(()=>Array(0)),this.queue_start=new Cn.PriorityQueue(Xn),this.queue_end=new Cn.PriorityQueue(Xn);for(let r=0;r<e;r++)for(let i=r+1;i<e;i++){let e=t[r],n=t[i];if(!yn.circleIntersection(e.position[0],e.position[2],e.radius+this.collision_offset,n.position[0],n.position[2],n.radius+this.collision_offset))continue;let s=this.calculateNodePosition(e,n),a=this.calculateNodePosition(n,e),o=this.addNode(s,r),h=this.addNode(a,i);const u=this.calculateWeightBetweenDisks(t,o,h);this.addLink(r,o,i,h,u);for(let e of this.disk_node_list[r]){const i=this.calculateWeightSameDisk(t,o,e);this.addLink(r,o,this.node_list[e].disk_id,e,i)}for(let e of this.disk_node_list[i]){const r=this.calculateWeightSameDisk(t,h,e);this.addLink(i,h,this.node_list[e].disk_id,e,r)}this.disk_node_list[r].push(o),this.disk_node_list[i].push(h)}this.search_data=Array.from({length:this.node_list.length},t=>new qn),this.memorized_search_data=Array.from({length:this.node_list.length},t=>new qn)}dijkstraSearch(t,e){for(this.resetSearchData(),this.dijkstra_visits=0,this.queue_start.clear(),this.search_data[t].start.path_node=t,this.search_data[t].start.given_cost=0,this.search_data[t].start.priority=this.search_data[t].start.given_cost+this.search_data[t].start.heuristic,this.queue_start.enqueue(new Vn(t,this.search_data[t].start.priority));!this.queue_start.isEmpty();){const t=this.queue_start.dequeue().id;if(!this.search_data[t].start.visited){if(t==e)break;this.search_data[t].start.visited=!0,this.dijkstra_visits++;for(let e of this.node_list[t].node_links){if(this.search_data[e.dest_node_id].start.visited)continue;const r=this.search_data[t].start.given_cost+e.weight;r<this.search_data[e.dest_node_id].start.given_cost&&(this.search_data[e.dest_node_id].start.given_cost=r,this.search_data[e.dest_node_id].start.priority=r+this.search_data[e.dest_node_id].start.heuristic,this.search_data[e.dest_node_id].start.path_node=t,this.queue_start.enqueue(new Vn(e.dest_node_id,this.search_data[e.dest_node_id].start.priority)))}}}return this.getPath(t,e)}aStarSearch(t,e){for(this.resetSearchDataWithHeuristics(t,e),this.a_star_visits=0,this.queue_start.clear(),this.search_data[t].start.path_node=t,this.search_data[t].start.given_cost=0,this.search_data[t].start.priority=this.search_data[t].start.given_cost+this.search_data[t].start.heuristic,this.queue_start.enqueue(new Vn(t,this.search_data[t].start.priority));!this.queue_start.isEmpty();){const t=this.queue_start.dequeue().id;if(!this.search_data[t].start.visited){if(t==e)break;this.search_data[t].start.visited=!0,this.a_star_visits++;for(let e of this.node_list[t].node_links){if(this.search_data[e.dest_node_id].start.visited)continue;const r=this.search_data[t].start.given_cost+e.weight;r<this.search_data[e.dest_node_id].start.given_cost&&(this.search_data[e.dest_node_id].start.given_cost=r,this.search_data[e.dest_node_id].start.priority=r+this.search_data[e.dest_node_id].start.heuristic,this.search_data[e.dest_node_id].start.path_node=t,this.queue_start.enqueue(new Vn(e.dest_node_id,this.search_data[e.dest_node_id].start.priority)))}}}return this.getPath(t,e)}mmSearch(t,e){this.resetSearchDataWithHeuristics(t,e),this.mm_visits=0,this.queue_start.clear(),this.queue_end.clear();let r=zn;for(this.search_data[t].start.path_node=t,this.search_data[t].start.given_cost=0,this.search_data[t].start.priority=this.search_data[t].start.given_cost+this.search_data[t].start.heuristic,this.queue_start.enqueue(new Vn(t,this.search_data[t].start.priority)),this.search_data[e].end.path_node=e,this.search_data[e].end.given_cost=0,this.search_data[e].end.priority=this.search_data[e].end.given_cost+this.search_data[e].end.heuristic,this.queue_end.enqueue(new Vn(e,this.search_data[e].end.priority));!this.queue_start.isEmpty()&&!this.queue_end.isEmpty();){let t,e,i=Un,n=Un;if(this.queue_start.isEmpty()||(i=this.queue_start.peek().priority),this.queue_end.isEmpty()||(n=this.queue_end.peek().priority),i<=n){if(r=this.queue_start.dequeue().id,this.search_data[r].start.visited)continue;if(this.search_data[r].end.visited)break;e=this.search_data[r].start,t=!0}else{if(r=this.queue_end.dequeue().id,this.search_data[r].end.visited)continue;if(this.search_data[r].start.visited)break;e=this.search_data[r].end,t=!1}e.visited=!0,this.mm_visits++;for(let i of this.node_list[r].node_links){let n=t?this.search_data[i.dest_node_id].start:this.search_data[i.dest_node_id].end;if(n.visited)continue;const s=e.given_cost+i.weight;s<n.given_cost&&(n.given_cost=s,n.priority=s+n.heuristic,n.path_node=r,t?this.queue_start.enqueue(new Vn(i.dest_node_id,n.priority)):this.queue_end.enqueue(new Vn(i.dest_node_id,n.priority)))}}return this.search_data[r].end.visited=!0,this.search_data[r].start.visited=!0,this.getmmPath(t,r,e)}getPathCost(t){let e=0;for(let r=0;r<t.length-1;r++)for(let i of this.node_list[t[r]].node_links)i.dest_node_id==t[r+1]&&(e+=i.weight);return e}memorizeLastSearch(){this.memorized_a_star_visits=this.a_star_visits,this.memorized_dijkstra_visits=this.dijkstra_visits,this.memorized_mm_visits=this.mm_visits;for(let t=0;t<this.search_data.length;t++)this.memorized_search_data[t].copy(this.search_data[t])}getMemorizedSearchData(){return this.memorized_search_data}getMemorized_a_star_visits(){return this.memorized_a_star_visits}getMemorizedDijsktraVisits(){return this.memorized_dijkstra_visits}getMemorizedmmVisits(){return this.memorized_mm_visits}getNodeList(){return this.node_list}getNodeCount(){return this.node_list.length}getNodeLinkCount(){return this.node_link_count}getPath(t,e){let r=[];for(;e!=t;)r.unshift(e),e=this.search_data[e].start.path_node;return r}getmmPath(t,e,r){let i=[],n=e;for(;n!=t;)i.unshift(n),n=this.search_data[n].start.path_node;for((n=e)!=r&&(n=this.search_data[n].end.path_node);n!=r;)i.push(n),n=this.search_data[n].end.path_node;return i.push(r),i}resetSearchData(){for(let t of this.search_data)t.start.init(),t.end.init()}resetSearchDataWithHeuristics(t,e){this.resetSearchData();for(let[r,i]of this.search_data.entries())i.start.priority=i.start.heuristic=this.heuristicCostEstimate(r,e),i.end.priority=i.end.heuristic=this.heuristicCostEstimate(r,t)}heuristicCostEstimate(t,e){return s.distance(this.node_list[t].pos,this.node_list[e].pos)}addNode(t,e){let r=this.node_list.length,i={};return i.pos=s.clone(t),i.node_id=r,i.disk_id=e,i.node_links=[],this.node_list.push(i),r}addLink(t,e,r,i,n){this.node_list[e].node_links.push(new Yn(e,i,r,n)),this.node_list[i].node_links.push(new Yn(i,e,t,n)),this.node_link_count++}static getCostFactor(t){return 1/t.getSpeedFactor()}calculateNodePosition(t,e){let r=s.sub(s.create(),e.position,t.position);return s.normalize(r,r),s.scaleAndAdd(s.create(),t.position,r,t.radius-this.node_offset)}calculateWeightBetweenDisks(t,e,r){let i=t[this.node_list[e].disk_id],n=t[this.node_list[r].disk_id];return s.distance(this.node_list[e].pos,this.node_list[r].pos)*((Hn.getCostFactor(i)+Hn.getCostFactor(n))/2)}calculateWeightSameDisk(t,e,r){let i=t[this.node_list[e].disk_id],n=this.node_list[e],a=this.node_list[r];Ri(n.disk_id===a.disk_id);let o=s.clone(i.position),h=s.sub(s.create(),n.pos,o),u=s.sub(s.create(),a.pos,o);return s.angle(h,u)*(i.radius-this.node_offset)*Hn.getCostFactor(i)}}class Kn{}let Gn=s.fromValues(0,0,0);class Wn{constructor(t,e,r){this.gl=t,this.mvp_matrix=n.create();let i=$n(t,e,t.VERTEX_SHADER),s=$n(t,r,t.FRAGMENT_SHADER);this.ID=t.createProgram(),t.attachShader(this.ID,i),t.attachShader(this.ID,s),t.linkProgram(this.ID),t.getProgramParameter(this.ID,t.LINK_STATUS)||alert("Could not initialize shaders"),this.uniforms=new Kn,this.uniforms.model_matrix=this.getUniformLocation("model_matrix"),this.uniforms.view_matrix=this.getUniformLocation("view_matrix"),this.uniforms.model_view_projection_matrix=this.getUniformLocation("model_view_projection_matrix"),this.uniforms.camera_pos=this.getUniformLocation("camera_pos")}use(){this.gl.useProgram(this.ID)}prepare(){this.gl.useProgram(this.ID)}activateMaterial(t){}setMVPMatrices(t,e,r,i=Gn){n.identity(this.mvp_matrix),n.mul(this.mvp_matrix,e,t),n.mul(this.mvp_matrix,r,this.mvp_matrix),this.setMat4(this.uniforms.model_matrix,t),this.setMat4(this.uniforms.model_view_projection_matrix,this.mvp_matrix),this.setVec3(this.uniforms.camera_pos,i)}setBoolByName(t,e){this.gl.uniform1i(this.getUniformLocation(t),e?1:0)}setBool(t,e){this.gl.uniform1i(t,e?1:0)}setInt(t,e){this.gl.uniform1i(t,e)}setIntByName(t,e){this.gl.uniform1i(this.getUniformLocation(t),e)}setIntV(t,e){this.gl.uniform1iv(t,e)}setIntVByName(t,e){this.gl.uniform1iv(this.getUniformLocation(t),e)}setFloat(t,e){this.gl.uniform1f(t,e)}setFloatByName(t,e){this.gl.uniform1f(this.getUniformLocation(t),e)}getUniformLocation(t){return this.gl.getUniformLocation(this.ID,t)}setMat4(t,e){this.gl.uniformMatrix4fv(t,!1,e)}setMat4ByName(t,e){this.gl.uniformMatrix4fv(this.getUniformLocation(t),!1,e)}setVec3(t,e){this.gl.uniform3fv(t,e)}setVec3ByName(t,e){this.gl.uniform3fv(this.getUniformLocation(t),e)}setVec4(t,e){this.gl.uniform4fv(t,e)}setVec4ByName(t,e){this.gl.uniform4fv(this.getUniformLocation(t),e)}}function $n(t,e,r){let i;return i=t.createShader(r),t.shaderSource(i,e),t.compileShader(i),t.getShaderParameter(i,t.COMPILE_STATUS)?i:(alert(t.getShaderInfoLog(i)),null)}class Qn{constructor(){this.data=[],this.counter=0,this.data=[]}pushAlloc(t,e){this.data.push(...t,...e),this.counter+=Qn.floats_per_point}push(t){this.counter>=this.data.length?this.pushAlloc(t.pos,t.color):(this.data[this.counter++]=t.pos[0],this.data[this.counter++]=t.pos[1],this.data[this.counter++]=t.pos[2],this.data[this.counter++]=t.color[0],this.data[this.counter++]=t.color[1],this.data[this.counter++]=t.color[2],this.data[this.counter++]=t.color[3])}pushRaw(t,e){this.counter>=this.data.length?this.pushAlloc(t,e):(this.data[this.counter++]=t[0],this.data[this.counter++]=t[1],this.data[this.counter++]=t[2],this.data[this.counter++]=e[0],this.data[this.counter++]=e[1],this.data[this.counter++]=e[2],this.data[this.counter++]=e[3])}static stride(){return 4*this.floats_per_point}static positionOffset(){return 0}static colorOffset(){return 12}getArrayView(){return this.arrayView&&this.arrayView.length===this.counter||(this.arrayView=new Float32Array(this.data)),this.arrayView}clear(){this.data=[],this.counter=0}allocate(t){this.data=new Array(t*Qn.floats_per_point),this.counter=0}size(){return this.counter/Qn.floats_per_point}}Qn.floats_per_point=7;class Zn{constructor(t){this.gl=t,this.points=new Qn,this.shader=new Wn(t,r(29).default,r(30).default),this.mvp_id=this.shader.uniforms.model_view_projection_matrix,this.VAO=t.createVertexArray(),t.bindVertexArray(this.VAO),this.VBO=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.VBO),t.enableVertexAttribArray(0),t.vertexAttribPointer(0,3,t.FLOAT,!1,Qn.stride(),Qn.positionOffset()),t.enableVertexAttribArray(1),t.vertexAttribPointer(1,4,t.FLOAT,!0,Qn.stride(),Qn.colorOffset()),t.bindVertexArray(null)}drawPointList(t,e){let r=this.gl;r.bufferData(r.ARRAY_BUFFER,t.getArrayView(),r.STREAM_DRAW),this.shader.setMat4(this.mvp_id,e),r.drawArrays(r.LINES,0,t.size()),r.bindVertexArray(null)}preAllocatePointLine(t){this.points.allocate(t)}addLine(t,e,r){this.points.pushRaw(t,r),this.points.pushRaw(e,r)}drawAndClear(t){if(0===this.points.size())return;let e=this.gl;e.bufferData(e.ARRAY_BUFFER,this.points.getArrayView(),e.STREAM_DRAW),this.shader.setMat4(this.mvp_id,t),e.drawArrays(e.LINES,0,this.points.size()),e.bindVertexArray(null),this.points.clear()}clear(){this.points.clear()}prepare(){let t=this.gl;this.shader.use(),t.bindVertexArray(this.VAO),t.bindBuffer(t.ARRAY_BUFFER,this.VBO)}drawLine(t,e,r,i){let n=new Qn;n.allocate(2),n.pushRaw(t,r),n.pushRaw(e,r),this.drawPointList(n,i)}}var Jn,ts=Ni.vec3_truncate;!function(t){t[t.DEAD=0]="DEAD",t[t.PURSUE=1]="PURSUE",t[t.EXPLORE=2]="EXPLORE"}(Jn||(Jn={}));let es=s.create(),rs=s.create(),is=s.create(),ns=s.create(),ss=s.create(),as=s.create();class os extends Ci{constructor(t,e,r){super(t.mesh.name,Fi.BASIC),this.radius=.7,this.half_height=.1,this.ignore_timer=0,this.S_MAX=5,this.S_MIN=1,this.A_MAX=8,this.player=e,this.world=r,this.radius=t.radius,this.half_height=t.half_height,this.state=Jn.EXPLORE,this.velocity=s.fromValues(rn.randf(0,this.S_MAX),0,rn.randf(0,this.S_MAX)),s.normalize(this.forward,this.velocity),this.position=this.world.getRandomXZPosition(s.create()),this.position[1]=15,this.target_position=this.world.getRandomXZPosition(s.create()),this.target_position[1]=15}update(t){let e=t/1e3;if(this.state!=Jn.DEAD){if(this.ignore_timer-=e,this.ignore_timer<0&&(this.ignore_timer=0),this.world.isCylinderCollisionWithDisk(this.position,this.radius,0))return this.state=Jn.DEAD,void(this.ignore_timer=1);switch(yn.cylinderIntersection(this.position,this.radius+20,this.half_height+20,this.player.position,this.player.radius,this.player.half_height)?this.state=Jn.PURSUE:this.state=Jn.EXPLORE,this.state){case Jn.EXPLORE:this.explore(e);break;case Jn.PURSUE:this.pursue(e)}}}explore(t){yn.cylinderIntersection(this.position,this.radius,this.half_height,this.target_position,2,1)&&(this.target_position=this.world.getRandomXZPosition(this.target_position),this.target_position[1]=15),this.seek(t)}seek(t){s.sub(es,this.target_position,this.position),s.normalize(rs,es),s.scale(rs,rs,this.S_MAX),s.sub(is,rs,this.velocity),s.scale(ns,is,1/t),ts(ss,ns,this.A_MAX),ts(this.velocity,s.scaleAndAdd(this.velocity,this.velocity,ss,t),this.S_MAX),s.scaleAndAdd(this.position,this.position,this.velocity,t),s.normalize(this.forward,this.velocity)}pursue(t){s.sub(rs,this.player.position,this.position);let e=.3*s.length(rs);s.scaleAndAdd(as,this.player.position,this.player.getVelocity(),e),this.target_position=s.copy(this.target_position,as),this.seek(t)}}class hs{constructor(t){this._value=t}set value(t){this._value=t}get value(){return this._value}}let us,ls,cs=r(1),ds=_i.keys,fs=_i.mouse_keys;const ps=s.fromValues(0,.8,0),ms=a.fromValues(.34,.83,.44,0);let _s=n.create(),vs=n.create(),gs=n.create();class ys{constructor(t){this.ROD_FILENAME="/assets/models/environment/rod/Rod",this.RING_FILENAME="/assets/models/environment/ring/Ring",this.BAT_FILENAME="/assets/models/actors/bat/BrownBat",this.SKYBOX_FILENAME="/assets/models/environment/skybox/Skybox",this.bats=[],this.player_camera=new Bn(s.fromValues(0,1.6,0),s.fromValues(0,1,0),0),this.overview_camera=new Bn(s.fromValues(100,190,10),s.fromValues(0,1,0),0,0),this.active_camera=new hs(this.player_camera),this.camera_lock=!1,this.current_map=0,this.show_path=!0,us=t,this.player=new Ji}async init(){await this.loadAssets(),await _i.updateProgressText("Initializing world"),this.player.init(us),this.ring_model.init(us),this.rod_model.init(us),this.skybox_model.init(us),this.bat_model.init(us);let t=Date.now();this.world=new Mn(us,ys.maps[this.current_map++]),this.world_graph=new Hn(this.world.disks),this.initWorldGraphPointLine(),console.log("world gen time: "+(Date.now()-t)/1e3+"s"),this.pickup_manager=new Sn(this.world,this.world_graph,this.rod_model,this.ring_model),this.player.reset(this.world),this.initBats(),this.overview_camera.lookAt(s.fromValues(0,0,0)),await this.initRenderer(),await this.addAllGameEntitiesToRenderer()}initBats(){this.bats=[];for(let t of this.world.disks)this.bats.push(new os(this.bat_model,this.player,this.world))}initWorldGraphPointLine(){let t=s.fromValues(0,.2,0);this.world_graph_point_list=new Qn,this.world_graph_point_list.allocate(2*this.world_graph.getNodeLinkCount()*2);let e=s.create();for(let r of this.world_graph.getNodeList())for(let i of r.node_links){let n=a.fromValues(.25+i.weight/50,1-i.weight/150,0,1);this.world_graph_point_list.pushRaw(s.add(e,r.pos,t),n),this.world_graph_point_list.pushRaw(s.add(e,this.world_graph.getNodeList()[i.dest_node_id].pos,t),n)}}displayMovementGraph(t,e){this.active_camera.value===this.overview_camera&&us.disable(us.DEPTH_TEST);let r=n.multiply(n.create(),e,t);_i.line_renderer.prepare(),_i.line_renderer.drawPointList(this.world_graph_point_list,r),us.enable(us.DEPTH_TEST)}displayRingZeroPath(t,e){let r=this.pickup_manager.rings[0],i=r.path,o=s.fromValues(0,1,0),h=a.fromValues(1,1,1,1),u=s.create(),l=s.create(),c=this.world_graph.getNodeList();if(_i.line_renderer.prepare(),_i.line_renderer.preAllocatePointLine(2*i.length+6),_i.line_renderer.addLine(r.position,s.add(u,r.position,o),h),_i.line_renderer.addLine(s.add(u,r.position,o),s.add(l,r.target_position,o),h),i.length){_i.line_renderer.addLine(s.add(u,c[r.target_node_id].pos,o),s.add(l,c[i[0]].pos,o),h);for(let t=0;t<i.length-1;t++)_i.line_renderer.addLine(s.add(u,c[i[t]].pos,o),s.add(l,c[i[t+1]].pos,o),h)}us.disable(us.DEPTH_TEST);let d=n.mul(n.create(),e,t);_i.line_renderer.drawAndClear(d),us.enable(us.DEPTH_TEST)}initRenderer(){(ls=_i.renderer).initShadows(ms,this.active_camera),ls.removeAllModels(),ls.addBasicModel(this.world.diskA_model),ls.addBasicModel(this.world.diskB_model),ls.addBasicModel(this.world.diskC_model),ls.addBasicModel(this.world.diskD_model),ls.addBasicModel(this.world.diskE_model),ls.addBasicModel(this.ring_model),ls.addBasicModel(this.rod_model),ls.addBasicModel(this.bat_model);let t=ls.basic_model_shader;t.use(),t.setBoolByName("lights[0].is_enabled",!0),t.setVec4ByName("lights[0].position",ms),t.setVec3ByName("lights[0].ambient",[1.8,1.8,1.8]),t.setVec3ByName("lights[0].diffuse",[1.2,1.2,1.2]),t.setVec3ByName("lights[0].specular",[0,0,0]),(t=ls.basic_model_shader_shadow).use(),t.setBoolByName("lights[0].is_enabled",!0),t.setVec4ByName("lights[0].position",ms),t.setVec3ByName("lights[0].ambient",[1.8,1.8,1.8]),t.setVec3ByName("lights[0].diffuse",[1.2,1.2,1.2]),t.setVec3ByName("lights[0].specular",[0,0,0])}addAllGameEntitiesToRenderer(){ls.removeAllEntities();for(let t of this.world.disks)ls.addEntityToRenderList(t),ls.addMeshlessModel(t.heightMapModel),ls.addEntityToRenderList(t.heightMapEntity);for(let t of this.pickup_manager.rings)t.picked_up||ls.addEntityToRenderList(t);for(let t of this.pickup_manager.rods)t.picked_up||ls.addEntityToRenderList(t);for(let t of this.bats)ls.addEntityToRenderList(t)}updateAnimations(t){this.player.updateAnimation(t)}update(t){ds[77]&&(this.destroyIntoNewWorld(),this.initRenderer(),this.addAllGameEntitiesToRenderer(),ds[77]=!1),ds[80]&&(ds[80]=!1,this.show_path=!this.show_path),ds[76]&&(ds[76]=!1,_i.poor_performance=!_i.poor_performance),ds[82]&&this.player.reset(this.world),ds[79]?(this.active_camera.value=this.overview_camera,this.camera_lock=!1):this.camera_lock||(this.active_camera.value=this.player_camera),_i.poor_performance?ls.disableShadows():ls.enableShadows();let e=this.world.getAccelFactorAtPosition(this.player.position[0],this.player.position[2],this.player.model.radius);ds[40]||ds[83]?this.player.accelerateBackward(t,e):(ds[38]||ds[87]||fs[1]&&fs[3])&&this.player.accelerateForward(t,e),ds[65]?this.player.accelerateLeft(t,e):ds[68]&&this.player.accelerateRight(t,e),ds[40]||ds[83]?this.player.transitionAnimationTo(Oi.Reversing):ds[38]||ds[87]||fs[1]&&fs[3]?this.player.transitionAnimationTo(Oi.Running):ds[65]||ds[68]?this.player.transitionAnimationTo(Oi.Strafing):this.player.transitionAnimationTo(Oi.Standing),ds[37]&&this.player.turnLeft(t),ds[39]&&this.player.turnRight(t),ds[32]&&this.player.jump(),this.player.update(this.world,t);for(let e of this.bats)e.update(t);this.batPlayerCollisions(),this.player.rotate(-_i.mouse_x_total/600),this.player_camera.processMouseMovement(this.player.forward,this.player.position,_i.mouse_x_total,-_i.mouse_y_total,!0),_i.resetMousePosition(),this.pickup_manager.update(t),this.pickup_manager.checkForPickupsCylinderIntersection(this.player.position,this.player.model.radius,this.player.model.half_height,ls),this.player_camera.front[0]=this.player.forward[0],this.player_camera.front[2]=this.player.forward[2],this.player_camera.up=this.player.up,s.copy(this.player_camera.position,this.player.position),this.player_camera.position[0]-=3*this.player.forward[0],this.player_camera.position[2]-=3*this.player.forward[2],s.add(this.player_camera.position,this.player_camera.position,ps)}draw(){let t=this.active_camera.value.position;if(ls.shadow_enabled){let e=gs,r=vs;ls.getDepthProjMatrix(r),ls.getLightViewMatrix(e),ls.beginRenderDepth(),this.player.draw(us,ls.active_shader,e,r,t),ls.renderCull(e,r,t,2*_i.SHADOW_DISTANCE),ls.endRenderDepth(e,r)}n.identity(vs),n.identity(gs),n.identity(_s),this.active_camera.value.getViewMatrix(gs),n.perspective(vs,i.toRadian(_i.FOV),_i.canvas.clientWidth/_i.canvas.clientHeight,.1,2e3),ls.beginRender(),us.disable(us.DEPTH_TEST),n.translate(_s,_s,this.active_camera.value.position),ls.active_shader.setMVPMatrices(_s,gs,vs,t),this.skybox_model.draw(us,ls.active_shader),us.enable(us.DEPTH_TEST),this.active_camera.value==this.player_camera&&_i.poor_performance?ls.renderCull(gs,vs,t,100):ls.render(gs,vs,t),this.player.draw(us,ls.active_shader,gs,vs,t),this.show_path&&(this.displayMovementGraph(gs,vs),this.displaySearchPathSpheres(gs,vs),this.displayRingZeroPath(gs,vs))}toggleCamera(){this.active_camera.value==this.overview_camera?(this.camera_lock=!1,this.active_camera.value=this.player_camera):(this.camera_lock=!0,this.active_camera.value=this.overview_camera)}reset(){this.player.reset(this.world)}batPlayerCollisions(){for(let t of this.bats)t.ignore_timer>0||yn.cylinderIntersection(t.position,t.radius,t.half_height,this.player.position,this.player.radius,this.player.half_height)&&(this.player.hitByBat(t.velocity),s.set(t.velocity,0,t.S_MAX,0),t.ignore_timer=1)}displaySearchPathSpheres(t,e){_i.sphere_renderer.prepare();let r=this.world_graph.getMemorizedSearchData(),i=0,o=0,h=0;if(r.length&&this.active_camera.value===this.overview_camera){let u=0,l=Number.MAX_VALUE,c=0,d=Number.MAX_VALUE;for(let t=0;t<r.length;t++){let e=r[t].start,n=r[t].end;e.visited&&n.visited&&(h=t),n.visited&&(0===n.given_cost&&(o=t),c=Math.max(n.priority,c),d=Math.min(n.priority,d)),e.visited&&(0===e.given_cost&&(i=t),u=Math.max(e.priority,u),l=Math.min(e.priority,l))}let f=(u=r[h].start.priority)-l,p=(c=r[h].end.priority)-d;for(let u=0;u<r.length;u++){let c=r[u].start,m=r[u].end;if(!c.visited&&!m.visited)continue;let _=a.create(),v=1.5;if(u!=i&&u!=o&&u!=h||(v=3),c.visited){let t=1-(c.priority-l)/f/2;_=a.set(_,0,t,1,1)}else if(m.visited){let t=1-(m.priority-d)/p;_=a.set(_,1,t,1,1)}u===i&&a.set(_,0,1,1,1),u===h&&a.set(_,.6,0,1,1),u===o&&a.set(_,1,1,1,1),n.identity(_s),n.translate(_s,_s,this.world_graph.getNodeList()[u].pos),n.scale(_s,_s,s.fromValues(v,v,v)),_i.sphere_renderer.draw(_,_s,t,e)}}}destroyIntoNewWorld(){this.current_map>=ys.maps.length&&(this.current_map=0),this.world.destroy(),this.world.init(us,ys.maps[this.current_map++]),this.world_graph=new Hn(this.world.disks),this.initBats(),this.initWorldGraphPointLine(),this.pickup_manager.init(this.world,this.world_graph),this.player.reset(this.world)}getScore(){return this.pickup_manager.getScore()}doDemo(t){this.world.getAccelFactorAtPosition(this.player.position[0],this.player.position[2],this.player.model.radius);this.player.rotate(t/5e3)}async loadAssets(){let t=Date.now();await _i.updateProgressText("Downloading world"),await Mn.loadAssets(),await this.loadWorldData(),await _i.updateProgressText("Downloading models"),await this.loadModels(),await _i.updateProgressText("Downloading player models"),await this.player.loadAssets();let e=Date.now();console.log("asset download time: "+(e-t)/1e3+"s")}async loadModels(){let t=await cs.downloadModels([{name:"Ring",obj:this.RING_FILENAME+".obj",mtl:this.RING_FILENAME+".mtl"}]);this.ring_model=new Ti(t.Ring,.7,.1),t=await cs.downloadModels([{name:"Rod",obj:this.ROD_FILENAME+".obj",mtl:this.ROD_FILENAME+".mtl"}]),this.rod_model=new Ti(t.Rod,.1,1),t=await cs.downloadModels([{name:"Bat",obj:this.BAT_FILENAME+".obj",mtl:this.BAT_FILENAME+".mtl"}]),this.bat_model=new Ti(t.Bat,.5,.05),this.bat_model.rotation_offset=-Math.PI/2,t=await cs.downloadModels([{name:"Skybox",obj:this.SKYBOX_FILENAME+".obj",mtl:this.SKYBOX_FILENAME+".mtl"}]),this.skybox_model=new Ti(t.Skybox)}async loadWorldData(){ys.maps=[];let t=r(31);t.keys().forEach(e=>ys.maps.push(t(e).default))}}class ws extends Wn{constructor(t){super(t,r(42).default,r(43).default)}setMVPMatrices(t,e,r,i=s.fromValues(0,0,0)){n.identity(this.mvp_matrix),n.mul(this.mvp_matrix,e,t),n.mul(this.mvp_matrix,r,this.mvp_matrix),this.setMat4(this.uniforms.model_view_projection_matrix,this.mvp_matrix)}}class Ms{constructor(t,e){if(this.texture_size=4096,this.quad_vertex_buffer_data=[-1,-1,0,1,-1,0,-1,1,0,-1,1,0,1,-1,0,1,1,0],this.gl=t,this.texture_size=e||this.texture_size,this.depth_shader=new ws(t),this.quad_shader=new Wn(t,r(44).default,r(45).default),this.depth_frame_buffer=t.createFramebuffer(),t.bindFramebuffer(t.FRAMEBUFFER,this.depth_frame_buffer),this.depth_texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.depth_texture),t.texImage2D(t.TEXTURE_2D,0,t.DEPTH_COMPONENT16,this.texture_size,this.texture_size,0,t.DEPTH_COMPONENT,t.UNSIGNED_SHORT,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_COMPARE_FUNC,t.LEQUAL),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_COMPARE_MODE,t.COMPARE_REF_TO_TEXTURE),t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,this.depth_texture,0),t.checkFramebufferStatus(t.FRAMEBUFFER)!=t.FRAMEBUFFER_COMPLETE)throw"depth texture frame buffer error";this.quad_VAO=t.createVertexArray(),this.quad_VBO=t.createBuffer(),t.bindVertexArray(this.quad_VAO),t.bindBuffer(t.ARRAY_BUFFER,this.quad_VBO),t.bufferData(t.ARRAY_BUFFER,new Float32Array(this.quad_vertex_buffer_data),t.STATIC_DRAW),t.enableVertexAttribArray(0),t.vertexAttribPointer(0,3,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,null),t.bindVertexArray(null)}startRenderToDepthTexture(){let t=this.gl;t.bindFramebuffer(t.FRAMEBUFFER,this.depth_frame_buffer),t.viewport(0,0,this.texture_size,this.texture_size),t.clear(t.DEPTH_BUFFER_BIT),this.depth_shader.use()}renderDepthTextureToQuad(t,e,r,i){let n=this.gl;n.viewport(t,e,r,i),this.quad_shader.use(),n.bindVertexArray(this.quad_VAO),n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,this.depth_texture),this.quad_shader.setIntByName("texture1",0),n.bindBuffer(n.ARRAY_BUFFER,this.quad_VBO),n.drawArrays(n.TRIANGLES,0,6),n.bindVertexArray(null)}getTexture(){return this.depth_texture}}class xs{constructor(t,e,r,i=_i.SHADOW_DISTANCE){this.SHADOW_DISTANCE=_i.SHADOW_DISTANCE||45,this.FOV=_i.FOV||80,this.OFFSET=7,this.CLIP_NEAR=1,this.CLIP_FAR=96,this.TRANSITION_DISTANCE=5,this.SHADOW_DISTANCE=i,this.light_view_matrix=e,this.camera=r,this.calculateWidthsAndHeights(t)}update(){let t=s.clone(this.camera.value.front),e=s.clone(this.camera.value.up),r=s.scale(s.create(),t,this.SHADOW_DISTANCE),i=s.scale(s.create(),t,this.CLIP_NEAR),n=s.add(s.create(),i,this.camera.value.position),a=s.add(s.create(),r,this.camera.value.position),o=this.calculateFrustumVertices(e,t,n,a),h=!0;for(let t=0;t<8;t++)h?(this.min_x=o[t][0],this.max_x=o[t][0],this.min_y=o[t][1],this.max_y=o[t][1],this.min_z=o[t][2],this.max_z=o[t][2],h=!1):(o[t][0]>this.max_x?this.max_x=o[t][0]:o[t][0]<this.min_x&&(this.min_x=o[t][0]),o[t][1]>this.max_y?this.max_y=o[t][1]:o[t][1]<this.min_y&&(this.min_y=o[t][1]),o[t][2]>this.max_z?this.max_z=o[t][2]:o[t][2]<this.min_z&&(this.min_z=o[t][2]));this.max_z+=this.OFFSET}getCenter(){const t=(this.min_x+this.max_x)/2,e=(this.min_y+this.max_y)/2,r=(this.min_z+this.max_z)/2,i=s.fromValues(t,e,r),a=n.invert(n.create(),this.light_view_matrix);return s.transformMat4(s.create(),i,a)}getWidth(){return this.max_x-this.min_x}getHeight(){return this.max_y-this.min_y}getLength(){return this.max_z-this.min_z}calculateFrustumVertices(t,e,r,i){const n=s.cross(s.create(),e,t),a=s.negate(s.create(),t),o=s.negate(s.create(),n),h=s.scaleAndAdd(s.create(),i,t,this.far_height),u=s.scaleAndAdd(s.create(),i,a,this.far_height),l=s.scaleAndAdd(s.create(),r,t,this.near_height),c=s.scaleAndAdd(s.create(),r,a,this.near_height);let d=Array(8);return d[0]=this.calculateLightSpaceFrustumCorner(h,n,this.far_width),d[1]=this.calculateLightSpaceFrustumCorner(h,o,this.far_width),d[2]=this.calculateLightSpaceFrustumCorner(u,n,this.far_width),d[3]=this.calculateLightSpaceFrustumCorner(u,o,this.far_width),d[4]=this.calculateLightSpaceFrustumCorner(l,n,this.near_width),d[5]=this.calculateLightSpaceFrustumCorner(l,o,this.near_width),d[6]=this.calculateLightSpaceFrustumCorner(c,n,this.near_width),d[7]=this.calculateLightSpaceFrustumCorner(c,o,this.near_width),d}calculateLightSpaceFrustumCorner(t,e,r){const i=s.add(s.create(),t,s.fromValues(e[0]*r,e[1]*r,e[2]*r));let n=a.fromValues(i[0],i[1],i[2],1);return n=a.transformMat4(n,n,this.light_view_matrix)}calculateWidthsAndHeights(t){this.far_width=this.SHADOW_DISTANCE*Math.tan(i.toRadian(this.FOV)),this.near_width=this.CLIP_NEAR*Math.tan(i.toRadian(this.FOV)),this.far_height=this.far_width/(t.drawingBufferWidth/t.drawingBufferHeight),this.near_height=this.near_width/(t.drawingBufferWidth/t.drawingBufferHeight)}setShadowDistance(t){this.SHADOW_DISTANCE=t}getShadowDistance(){return this.SHADOW_DISTANCE}getShadowFadeDistance(){return 2*this.SHADOW_DISTANCE+this.TRANSITION_DISTANCE}}class bs extends Kn{constructor(){super(...arguments),this.lights=new Array(8).fill({})}}class Es extends bs{}class As extends Wn{constructor(t,e=r(46).default,i=r(47).default){super(t,e,i),this.gl.useProgram(this.ID),this.uniforms=new Es,this.uniforms.model_matrix=this.getUniformLocation("model_matrix"),this.uniforms.view_matrix=this.getUniformLocation("view_matrix"),this.uniforms.model_view_projection_matrix=this.getUniformLocation("model_view_projection_matrix"),this.uniforms.camera_pos=this.getUniformLocation("camera_pos"),this.uniforms.tween_enabled=this.getUniformLocation("tween_enabled"),this.uniforms.tween_factor=this.getUniformLocation("tween_factor"),this.uniforms.material_transparency_texture=this.getUniformLocation("material.transparency_texture"),this.uniforms.material_emission_texture=this.getUniformLocation("material.emission_texture"),this.uniforms.material_ambient_texture=this.getUniformLocation("material.ambient_texture"),this.uniforms.material_diffuse_texture=this.getUniformLocation("material.diffuse_texture"),this.uniforms.material_specular_texture=this.getUniformLocation("material.specular_texture"),this.uniforms.material_shininess_texture=this.getUniformLocation("material.shininess_texture"),this.uniforms.material_transparency_channel=this.getUniformLocation("material.transparency_channel"),this.uniforms.material_shininess_channel=this.getUniformLocation("material.shininess_channel"),this.uniforms.material_transparency=this.getUniformLocation("material.transparency"),this.uniforms.material_ambient_colour=this.getUniformLocation("material.ambient_colour"),this.uniforms.material_diffuse_colour=this.getUniformLocation("material.diffuse_colour"),this.uniforms.material_specular_colour=this.getUniformLocation("material.specular_colour"),this.uniforms.material_emissive_colour=this.getUniformLocation("material.emission_colour"),this.uniforms.material_shininess=this.getUniformLocation("material.shininess"),this.uniforms.material_is_texture_active=this.getUniformLocation("material.is_texture_active");for(let t=0;t<this.uniforms.lights.length;t++)this.uniforms.lights[t].is_enabled=this.getUniformLocation(`lights[${t}].is_enabled`),this.uniforms.lights[t].position=this.getUniformLocation(`lights[${t}].position`),this.uniforms.lights[t].ambient=this.getUniformLocation(`lights[${t}].ambient`),this.uniforms.lights[t].diffuse=this.getUniformLocation(`lights[${t}].diffuse`),this.uniforms.lights[t].specular=this.getUniformLocation(`lights[${t}].specular`),this.uniforms.lights[t].attenuation=this.getUniformLocation(`lights[${t}].attenuation`);t.bindAttribLocation(this.ID,0,"a_vertex"),t.bindAttribLocation(this.ID,1,"a_tex_coord"),t.bindAttribLocation(this.ID,2,"a_normal"),t.bindAttribLocation(this.ID,3,"a_vertex1"),t.bindAttribLocation(this.ID,4,"a_normal1"),this.setInt(this.uniforms.material_transparency_texture,0),this.setInt(this.uniforms.material_emission_texture,1),this.setInt(this.uniforms.material_ambient_texture,2),this.setInt(this.uniforms.material_diffuse_texture,3),this.setInt(this.uniforms.material_specular_texture,4),this.setInt(this.uniforms.material_shininess_texture,5)}prepare(){this.gl.useProgram(this.ID);let t=this.gl;t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,_i.EMPTY_TEXTURE),t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,_i.EMPTY_TEXTURE),t.activeTexture(t.TEXTURE2),t.bindTexture(t.TEXTURE_2D,_i.EMPTY_TEXTURE),t.activeTexture(t.TEXTURE3),t.bindTexture(t.TEXTURE_2D,_i.EMPTY_TEXTURE),t.activeTexture(t.TEXTURE4),t.bindTexture(t.TEXTURE_2D,_i.EMPTY_TEXTURE),t.activeTexture(t.TEXTURE5),t.bindTexture(t.TEXTURE_2D,_i.EMPTY_TEXTURE)}activateMaterial(t){let e=this.gl;t.isTextureActive[0]&&(e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,t.mapTransparency.texture)),t.isTextureActive[1]&&(e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,t.mapEmissive.texture)),t.isTextureActive[2]&&(e.activeTexture(e.TEXTURE2),e.bindTexture(e.TEXTURE_2D,t.mapAmbient.texture)),t.isTextureActive[3]&&(e.activeTexture(e.TEXTURE3),e.bindTexture(e.TEXTURE_2D,t.mapDiffuse.texture)),t.isTextureActive[4]&&(e.activeTexture(e.TEXTURE4),e.bindTexture(e.TEXTURE_2D,t.mapSpecular.texture)),t.isTextureActive[5]&&(e.activeTexture(e.TEXTURE5),e.bindTexture(e.TEXTURE_2D,t.mapSpecularExponent.texture)),this.setFloat(this.uniforms.material_transparency,t.transparency),this.setVec3(this.uniforms.material_ambient_colour,t.ambient),this.setVec3(this.uniforms.material_diffuse_colour,t.diffuse),this.setVec3(this.uniforms.material_specular_colour,t.specular),this.setVec3(this.uniforms.material_emissive_colour,t.emissive),this.setInt(this.uniforms.material_transparency_channel,0),this.setInt(this.uniforms.material_shininess_channel,0),this.setFloat(this.uniforms.material_shininess,t.specularExponent),this.setIntV(this.uniforms.material_is_texture_active,t.isTextureActive)}}class Ts extends As{constructor(t){super(t,r(48).default,r(49).default),this.uniforms.shadow_map=this.getUniformLocation("shadow_map"),this.uniforms.shadow_distance=this.getUniformLocation("shadow_distance"),this.uniforms.shadow_map_size=this.getUniformLocation("shadow_map_size"),this.uniforms.shadow_map_space_matrix=this.getUniformLocation("shadow_map_space_matrix")}setShadowMap(t){let e=this.gl;e.activeTexture(e.TEXTURE6),e.bindTexture(e.TEXTURE_2D,t)}prepare(){super.prepare();let t=this.gl;t.activeTexture(t.TEXTURE6),t.bindTexture(t.TEXTURE_2D,_i.EMPTY_TEXTURE),this.setInt(this.uniforms.shadow_map,6),this.setFloat(this.uniforms.shadow_distance,_i.SHADOW_DISTANCE)}}let Is=n.fromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),Rs=n.create(),Ss=n.create(),Ds=o.create();class ks{constructor(t){this.gl=t,this.models=new Map,this.materials=new Map,this.entities=[],this.meshless_models=new Map,this.basic_model_shader=new As(this.gl),this.basic_model_shader_shadow=new Ts(this.gl),this.active_shader=this.basic_model_shader,this.shadow_enabled=!0}initShadows(t,e){this.shadow_map_space_matrix=n.create(),this.light_view_matrix=n.create(),this.light_direction=a.normalize(a.create(),t),this.shadow_box=new xs(this.gl,this.light_view_matrix,e),this.depth_texture=new Ms(this.gl)}enableShadows(){this.shadow_enabled=!0}disableShadows(){this.shadow_enabled=!1}toggleShadows(){this.shadow_enabled=!this.shadow_enabled}addBasicModel(t){void 0===this.models.get(t.mesh.name)&&this.models.set(t.mesh.name,t);for(let e in t.mesh.materialNames)if(t.mesh.materialNames.hasOwnProperty(e)&&void 0===this.materials.get(t.mesh.materialNames[e])){if(void 0===t.mesh.materialsByIndex[e])throw"Missing material on model";this.materials.set(t.mesh.materialNames[e],t.mesh.materialsByIndex[e])}}addMeshlessModel(t){void 0===this.meshless_models.get(t.name)&&this.meshless_models.set(t.name,t),void 0===this.materials.get(t.material.name)&&this.materials.set(t.material.name,t.material)}addEntityToRenderList(t){let e=!1;for(let r=0;r<this.entities.length;r++)t.id==this.entities[r].id&&(e=!0);e||this.entities.push(t),t.model_type==Fi.BASIC?void 0===this.models.get(t.mesh_name)&&console.log("Basic Model Missing: "+t.mesh_name):t.model_type==Fi.MESHLESS&&void 0===this.meshless_models.get(t.mesh_name)&&console.log("Meshless Model Missing: "+t.mesh_name)}removeEntity(t){for(let e=0;e<this.entities.length;e++)t.id==this.entities[e].id&&this.entities.splice(e,1)}removeAllEntities(){this.entities=[]}removeAllModels(){this.meshless_models=new Map,this.models=new Map}beginRender(){let t=this.gl;t.bindFramebuffer(t.FRAMEBUFFER,null),t.viewport(0,0,t.drawingBufferWidth,t.drawingBufferHeight),this.shadow_enabled?(this.active_shader=this.basic_model_shader_shadow,this.active_shader.prepare(),this.basic_model_shader_shadow.setMat4(this.basic_model_shader_shadow.uniforms.shadow_map_space_matrix,this.shadow_map_space_matrix),this.basic_model_shader_shadow.setShadowMap(this.depth_texture.getTexture()),this.basic_model_shader_shadow.setFloat(this.basic_model_shader_shadow.uniforms.shadow_map_size,this.depth_texture.texture_size)):(this.active_shader=this.basic_model_shader,this.active_shader.prepare())}beginRenderDepth(){let t=this.gl;this.depth_texture.startRenderToDepthTexture(),this.active_shader=this.depth_texture.depth_shader,t.disable(t.CULL_FACE),t.enable(t.POLYGON_OFFSET_FILL),t.polygonOffset(_i.shadow_factor,_i.shadow_offset)}endRenderDepth(t,e){let r=this.gl;n.mul(Rs,e,t),this.shadow_map_space_matrix=n.mul(this.shadow_map_space_matrix,Is,Rs),r.disable(r.POLYGON_OFFSET_FILL),r.enable(r.CULL_FACE),r.cullFace(r.BACK)}getDepthProjMatrix(t){return this.shadow_box.update(),n.identity(t),t[0]=2/this.shadow_box.getWidth(),t[5]=2/this.shadow_box.getHeight(),t[10]=-2/this.shadow_box.getLength(),t[15]=1,t}getLightViewMatrix(t){this.shadow_box.update();let e=this.shadow_box.getCenter();s.negate(e,e);let r=s.fromValues(-this.light_direction[0],-this.light_direction[1],-this.light_direction[2]);n.identity(this.light_view_matrix);let i=Math.acos(h.length([r[0],r[2]]));n.rotateX(this.light_view_matrix,this.light_view_matrix,i);let a=Math.atan2(r[2],r[0]);return a=r[2]>0?a-Math.PI:a,n.rotateY(this.light_view_matrix,this.light_view_matrix,a+Math.PI/2),n.translate(this.light_view_matrix,this.light_view_matrix,e),n.copy(t,this.light_view_matrix),t}render(t,e,r){this.renderModels(this.entities,t,e,r)}renderCull(t,e,r,i){let n=[];for(let t of this.entities)yn.circleIntersection(t.position[0],t.position[2],0,r[0],r[2],i)&&n.push(t);this.renderModels(n,t,e,r)}renderModels(t,e,r,i){let s=[];for(const a of this.materials.keys()){let h=this.materials.get(a),u=!1;for(const l of this.models.keys()){let c=this.models.get(l);if(void 0===c.mesh.materialIndices[a])continue;s.length=0;for(let e of t)e.model_type==Fi.BASIC&&c.mesh.name==e.mesh_name&&s.push(e);if(0==s.length)continue;let d=c.mesh.materialIndices[a];u||(this.active_shader.activateMaterial(h),u=!0,0),c.activateBuffers(this.gl),0;for(let t of s)n.identity(Ss),o.identity(Ds),o.rotateY(Ds,Ds,Math.atan2(t.forward[0],t.forward[2])+c.rotation_offset),n.fromRotationTranslationScale(Ss,Ds,t.position,t.scalar),this.active_shader.setMVPMatrices(Ss,e,r,i),c.drawActivatedMaterial(this.gl,d),0}for(const a of this.meshless_models.keys()){let l=this.meshless_models.get(a);if(l.material.name===h.name){s.length=0;for(let e of t)e.model_type==Fi.MESHLESS&&l.name==e.mesh_name&&s.push(e);if(s.length>0){l.activateBuffers(this.gl),0,u||(this.active_shader.activateMaterial(h),u=!0,0);for(let t of s)n.identity(Ss),o.identity(Ds),o.rotateY(Ds,Ds,Math.atan2(t.forward[0],t.forward[2])+l.rotation_offset),n.fromRotationTranslationScale(Ss,Ds,t.position,t.scalar),this.active_shader.setMVPMatrices(Ss,e,r,i),l.drawActivatedMaterial(this.gl),0}}}}}}let Ls=r(1);class Os{constructor(t){this.gl=t,this.mat=new Ii.Material}prepare(){Ri(this.loaded),Ri(_i.renderer),_i.renderer.basic_model_shader.use(),this.sphere.activateBuffers(this.gl)}draw(t,e,r,i){this.mat.emissive=[t[0],t[1],t[2]],this.mat.ambient=[0,0,0],this.mat.diffuse=[0,0,0],this.mat.transparency=[t[3]],_i.renderer.basic_model_shader.setMVPMatrices(e,r,i),_i.renderer.basic_model_shader.activateMaterial(this.mat),this.sphere.drawActivatedMaterial(this.gl,0)}async load(){let t=await Ls.downloadModels([{name:"sphere",obj:"/assets/models/other/sphere.obj",downloadMtlTextures:!1}]);this.sphere=new Ti(t.sphere),this.sphere.init(this.gl),this.gl.disableVertexAttribArray(1),this.loaded=!0}}r.d(e,"Main",function(){return Ys});var Fs=_i.keys;let Ns,Ps=r(50),Bs=window.document,Cs=Bs.getElementById("fpscounter"),Us=Bs.getElementById("upscounter"),zs=Bs.getElementById("score"),js=Bs.getElementById("hq-toggle"),qs=Bs.getElementById("path-toggle"),Vs=Bs.getElementById("camera-toggle"),Xs=Bs.getElementById("reset");class Ys{constructor(){this.fullscreenChange=t=>{let e=window.document,r=_i.parent,i=_i.canvas;e.webkitFullscreenElement!==r&&e.mozFullscreenElement!==r&&e.mozFullScreenElement!==r&&e.fullscreenElement!==r||(i.requestPointerLock=i.requestPointerLock||i.mozRequestPointerLock||i.webkitRequestPointerLock,i.requestPointerLock())},this.pointerLockChange=t=>{let e=window.document;e.pointerLockElement===_i.canvas||e.mozPointerLockElement===_i.canvas||e.webkitPointerLockElement===_i.canvas?e.addEventListener("mousemove",this.moveCallback,!1):e.removeEventListener("mousemove",this.moveCallback,!1)},this.moveCallback=t=>{let e=t.movementX||t.mozMovementX||t.webkitMovementX||0,r=t.movementY||t.mozMovementY||t.webkitMovementY||0;_i.mouse_x_total+=e,_i.mouse_y_total+=r},_i.canvas=Bs.getElementById("canvas"),_i.parent=Bs.getElementById("parent"),this.initGL(),/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&(_i.is_mobile=!0),this.init()}async init(){_i.renderer=await new ks(Ns),_i.is_mobile?_i.renderer.disableShadows():_i.renderer.enableShadows(),_i.line_renderer=await new Zn(Ns),_i.sphere_renderer=await new Os(Ns),await _i.sphere_renderer.load(),this.game=new ys(Ns),await this.game.init(),Bs.getElementById("loading-container").remove(),js.addEventListener("click",function(){_i.poor_performance=!_i.poor_performance},!1),qs.addEventListener("click",t=>{this.game.show_path=!this.game.show_path},!1),Vs.addEventListener("click",t=>{this.game.toggleCamera()},!1),Xs.addEventListener("click",t=>{this.game.reset()},!1),this.initPointerLock(),Ps.setSimulationTimestep(1e3/60),Ps.setMaxAllowedFPS(1e3),Ps.setBegin(this.begin.bind(this)).setUpdate(this.update.bind(this)).setDraw(this.draw.bind(this)).setEnd(this.end.bind(this)).start()}initGL(){(Ns=_i.canvas.getContext("webgl2"))||alert("WebGL2 is not available on your browser."),_i.EMPTY_TEXTURE=Ns.createTexture(),Ns.activeTexture(Ns.TEXTURE0),Ns.bindTexture(Ns.TEXTURE_2D,_i.EMPTY_TEXTURE),Ns.texParameteri(Ns.TEXTURE_2D,Ns.TEXTURE_WRAP_S,Ns.REPEAT),Ns.texParameteri(Ns.TEXTURE_2D,Ns.TEXTURE_WRAP_T,Ns.REPEAT),Ns.texParameteri(Ns.TEXTURE_2D,Ns.TEXTURE_MAG_FILTER,Ns.LINEAR),Ns.texParameteri(Ns.TEXTURE_2D,Ns.TEXTURE_MIN_FILTER,Ns.LINEAR_MIPMAP_LINEAR);const t=new Uint8Array([255,0,255,255]);Ns.texImage2D(Ns.TEXTURE_2D,0,Ns.RGB,1,1,0,Ns.RGB,Ns.UNSIGNED_BYTE,t),this.resize(),Ns.clearColor(.2,.3,.3,1),Ns.clear(Ns.COLOR_BUFFER_BIT|Ns.DEPTH_BUFFER_BIT)}update(t){_i.is_mobile&&this.doDemo(t),this.game.update(t)}begin(t,e){Ps.setTimeScale(_i.TIME_SCALES[_i.time_scale_id]),this.game.updateAnimations(e)}draw(t){this.game.draw(),this.resize()}end(t,e,r,i){if(Cs.textContent=Math.round(t)+" FPS",Us.textContent=Math.round(e)+" UPS",zs.textContent="Score: "+this.game.getScore(),r>5e3&&Math.round(t)<20&&0==_i.toggled_performance&&(_i.poor_performance=!0,_i.toggled_performance=!0,_i.renderer.disableShadows()),i){let t=Math.round(Ps.resetFrameDelta());console.warn("Main loop panicked, probably because the browser tab was put in the background. Discarding "+t+"ms")}}static keyboard(t,e){if(e)switch(t){case 107:Fs[107]||(_i.time_scale_id--,_i.time_scale_id<0&&(_i.time_scale_id=0));break;case 109:Fs[109]||(_i.time_scale_id++,_i.time_scale_id>_i.TIME_SCALE_COUNT&&(_i.time_scale_id=_i.TIME_SCALE_COUNT))}Fs[t]=e}doDemo(t){this.game.doDemo(t)}resize(){_i.canvas.width=window.innerWidth,_i.canvas.height=window.innerHeight,Ns.viewport(0,0,Ns.drawingBufferWidth,Ns.drawingBufferHeight)}initPointerLock(){_i.canvas;_i.parent.addEventListener("click",_i.parent.requestFullscreen,!1),Bs.addEventListener("fullscreenchange",this.fullscreenChange,!1),Bs.addEventListener("mozfullscreenchange",this.fullscreenChange,!1),Bs.addEventListener("webkitfullscreenchange",this.fullscreenChange,!1),Bs.addEventListener("pointerlockchange",this.pointerLockChange,!1),Bs.addEventListener("mozpointerlockchange",this.pointerLockChange,!1),Bs.addEventListener("webkitpointerlockchange",this.pointerLockChange,!1)}}window.onkeydown=function(t){Ys.keyboard(t.which||t.keyCode||0,!0)},window.onkeyup=function(t){Ys.keyboard(t.which||t.keyCode||0,!1)},window.onmousedown=function(t){_i.mouse_keys[t.which]=!0},window.onmouseup=function(t){_i.mouse_keys[t.which]=!1};new Ys}]);
//# sourceMappingURL=bundle.js.map